#if __DESIGNER_DATA
#error Do not define __DESIGNER_DATA.
<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<om:MetaModel MajorVersion="1" MinorVersion="3" Core="2b131234-7959-458d-834f-2dc0769ce683" ScheduleModel="66366196-361d-448d-976f-cab5e87496d2" xmlns:om="http://schemas.microsoft.com/BizTalk/2003/DesignerData">
    <om:Element Type="Module" OID="8d1419e7-af23-4908-8743-fdbea5138fc0" LowerBound="1.1" HigherBound="109.1">
        <om:Property Name="ReportToAnalyst" Value="True" />
        <om:Property Name="Name" Value="Microsoft.Samples.BizTalk.SouthridgeVideo.CableOrderActions" />
        <om:Property Name="Signal" Value="False" />
        <om:Element Type="ServiceDeclaration" OID="7b3945af-1c98-439d-ab7a-0f0bb7fc21b9" ParentLink="Module_ServiceDeclaration" LowerBound="4.1" HigherBound="108.1">
            <om:Property Name="InitializedTransactionType" Value="True" />
            <om:Property Name="IsInvokable" Value="True" />
            <om:Property Name="TypeModifier" Value="Public" />
            <om:Property Name="ReportToAnalyst" Value="True" />
            <om:Property Name="AnalystComments" Value="// Microsoft.Samples.BizTalk.SouthridgeVideo.CableOrderActions.Validate&#xD;&#xA;// Validate orchestration in the end to end Business Process Management Scenario.&#xD;&#xA;// &#xD;&#xA;//&#xD;&#xA;// Copyright (c) Microsoft Corporation. All rights reserved.  &#xD;&#xA;// THIS CODE AND INFORMATION ARE PROVIDED &quot;AS IS&quot; WITHOUT WARRANTY OF ANY KIND, &#xD;&#xA;// EITHER EXPRESSED OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE IMPLIED WARRANTIES &#xD;&#xA;// OF MERCHANTABILITY AND/OR FITNESS FOR A PARTICULAR PURPOSE." />
            <om:Property Name="Name" Value="ValidateOrch" />
            <om:Property Name="Signal" Value="True" />
            <om:Element Type="VariableDeclaration" OID="ad197c8c-eed0-41e6-b0fc-09e934a9ac16" ParentLink="ServiceDeclaration_VariableDeclaration" LowerBound="9.1" HigherBound="10.1">
                <om:Property Name="InitialValue" Value="&quot;Validation failed&quot;" />
                <om:Property Name="UseDefaultConstructor" Value="False" />
                <om:Property Name="Type" Value="System.String" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="BadOrderReason" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="VariableDeclaration" OID="63261f0e-b487-4c90-bec8-1e67ad2b91f4" ParentLink="ServiceDeclaration_VariableDeclaration" LowerBound="10.1" HigherBound="11.1">
                <om:Property Name="InitialValue" Value="true" />
                <om:Property Name="UseDefaultConstructor" Value="False" />
                <om:Property Name="Type" Value="System.Boolean" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="IsInvalid" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="VariableDeclaration" OID="baea6f6a-4ec1-4eb4-94a6-8fd3e6a37aa7" ParentLink="ServiceDeclaration_VariableDeclaration" LowerBound="11.1" HigherBound="12.1">
                <om:Property Name="UseDefaultConstructor" Value="False" />
                <om:Property Name="Type" Value="System.String" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="ExceptionReason" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="VariableDeclaration" OID="f1a2496a-1c37-4262-a4fa-63d0825617f6" ParentLink="ServiceDeclaration_VariableDeclaration" LowerBound="12.1" HigherBound="13.1">
                <om:Property Name="InitialValue" Value="true" />
                <om:Property Name="UseDefaultConstructor" Value="False" />
                <om:Property Name="Type" Value="System.Boolean" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="IsNotBadOrder" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="LongRunningTransaction" OID="5740da70-a70f-40fb-9a11-65bac26f3def" ParentLink="ServiceDeclaration_Transaction" LowerBound="5.19" HigherBound="5.56">
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="ValidateTx" />
                <om:Property Name="Signal" Value="False" />
            </om:Element>
            <om:Element Type="MessageDeclaration" OID="12f77027-b93c-4245-8acf-e1da8976501e" ParentLink="ServiceDeclaration_MessageDeclaration" LowerBound="7.1" HigherBound="8.1">
                <om:Property Name="Type" Value="System.Xml.XmlDocument" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="BadXmlOrderMsg" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="MessageDeclaration" OID="958c0001-d5c0-4786-bc59-79773dc7a8a1" ParentLink="ServiceDeclaration_MessageDeclaration" LowerBound="8.1" HigherBound="9.1">
                <om:Property Name="Type" Value="System.Xml.XmlDocument" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="FixedXmlOrderMsg" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="ServiceBody" OID="5a07f0e7-e88a-4e52-92f0-9e0df7716755" ParentLink="ServiceDeclaration_ServiceBody">
                <om:Property Name="Signal" Value="False" />
                <om:Element Type="While" OID="96f9f817-8eb5-4080-85a0-a7fbc2835a7f" ParentLink="ServiceBody_Statement" LowerBound="19.1" HigherBound="106.1">
                    <om:Property Name="Expression" Value="IsInvalid" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="While Not Valid" />
                    <om:Property Name="Signal" Value="False" />
                    <om:Element Type="Scope" OID="c909b765-1635-490d-86e7-a1accd6a2372" ParentLink="ComplexStatement_Statement" LowerBound="22.1" HigherBound="105.1">
                        <om:Property Name="InitializedTransactionType" Value="True" />
                        <om:Property Name="IsSynchronized" Value="False" />
                        <om:Property Name="ReportToAnalyst" Value="True" />
                        <om:Property Name="Name" Value="Try Rules Engine Scope" />
                        <om:Property Name="Signal" Value="True" />
                        <om:Element Type="LongRunningTransaction" OID="97e3ec29-7d7f-474d-9441-0e829244268a" ParentLink="Scope_Transaction" LowerBound="23.22" HigherBound="23.63">
                            <om:Property Name="ReportToAnalyst" Value="True" />
                            <om:Property Name="Name" Value="TryRulesEngineTx" />
                            <om:Property Name="Signal" Value="False" />
                        </om:Element>
                        <om:Element Type="Scope" OID="032145fa-b8bb-4797-af73-9360abf9f3d1" ParentLink="ComplexStatement_Statement" LowerBound="27.1" HigherBound="59.1">
                            <om:Property Name="InitializedTransactionType" Value="True" />
                            <om:Property Name="IsSynchronized" Value="False" />
                            <om:Property Name="ReportToAnalyst" Value="True" />
                            <om:Property Name="AnalystComments" Value="This is an atomic scope because the calling the rules requires an atomic scope." />
                            <om:Property Name="Name" Value="Rules Engine Scope" />
                            <om:Property Name="Signal" Value="True" />
                            <om:Element Type="AtomicTransaction" OID="33308bbe-30f9-4fe9-b6a2-f467749149a5" ParentLink="Scope_Transaction" LowerBound="29.30" HigherBound="29.63">
                                <om:Property Name="ReportToAnalyst" Value="True" />
                                <om:Property Name="Name" Value="RulesEngineTx" />
                                <om:Property Name="Signal" Value="False" />
                            </om:Element>
                            <om:Element Type="CallRules" OID="d65d263e-31ff-438f-a7f1-acab9687a907" ParentLink="ComplexStatement_Statement" LowerBound="33.1" HigherBound="57.1">
                                <om:Property Name="PolicyName" Value="DecodeAndValidateOrder" />
                                <om:Property Name="PolicyVersion" Value="-1" />
                                <om:Property Name="ReportToAnalyst" Value="True" />
                                <om:Property Name="Name" Value="Validation Rules" />
                                <om:Property Name="Signal" Value="True" />
                                <om:Element Type="RulesParameterRef" OID="624df55d-df6c-4a37-a4cc-3db43eb69282" ParentLink="CallRules_RulesParameterRef">
                                    <om:Property Name="Reference" Value="OrderMsg" />
                                    <om:Property Name="Alias" Value="Microsoft.Samples.BizTalk.SouthridgeVideo.Schemas.OrderSchema" />
                                    <om:Property Name="ReportToAnalyst" Value="True" />
                                    <om:Property Name="Name" Value="RulesParameterRef_1" />
                                    <om:Property Name="Signal" Value="False" />
                                </om:Element>
                            </om:Element>
                            <om:Element Type="TransactionAttribute" OID="9ff8b929-d9cd-4f2a-8674-b9b62768d420" ParentLink="Statement_CLRAttribute" LowerBound="28.1" HigherBound="29.1">
                                <om:Property Name="Batch" Value="True" />
                                <om:Property Name="Retry" Value="True" />
                                <om:Property Name="Timeout" Value="60" />
                                <om:Property Name="Isolation" Value="Serializable" />
                                <om:Property Name="Signal" Value="False" />
                            </om:Element>
                        </om:Element>
                        <om:Element Type="VariableAssignment" OID="528ec710-3f3a-4d87-acbc-4adf550faf50" ParentLink="ComplexStatement_Statement" LowerBound="59.1" HigherBound="61.1">
                            <om:Property Name="Expression" Value="IsInvalid = (OrderMsg.OrderType == &quot;INVALID&quot;);" />
                            <om:Property Name="ReportToAnalyst" Value="True" />
                            <om:Property Name="Name" Value="Check Validity" />
                            <om:Property Name="Signal" Value="False" />
                        </om:Element>
                        <om:Element Type="Decision" OID="e27ccda9-95d1-4620-9a61-624a865254e1" ParentLink="ComplexStatement_Statement" LowerBound="61.1" HigherBound="79.1">
                            <om:Property Name="ReportToAnalyst" Value="True" />
                            <om:Property Name="Name" Value="Is Valid?" />
                            <om:Property Name="Signal" Value="True" />
                            <om:Element Type="DecisionBranch" OID="87901d78-7447-42d3-b055-c18af1197048" ParentLink="ReallyComplexStatement_Branch" LowerBound="62.25" HigherBound="79.1">
                                <om:Property Name="Expression" Value="IsInvalid" />
                                <om:Property Name="IsGhostBranch" Value="True" />
                                <om:Property Name="ReportToAnalyst" Value="True" />
                                <om:Property Name="Name" Value="Invalid" />
                                <om:Property Name="Signal" Value="False" />
                                <om:Element Type="Construct" OID="b219fd98-80bf-4428-a31d-f1946fbdb750" ParentLink="ComplexStatement_Statement" LowerBound="64.1" HigherBound="70.1">
                                    <om:Property Name="ReportToAnalyst" Value="True" />
                                    <om:Property Name="Name" Value="Construct BadXmlOrderMsg" />
                                    <om:Property Name="Signal" Value="True" />
                                    <om:Element Type="MessageRef" OID="13ccec19-9e74-4684-a09d-c35cc7bced66" ParentLink="Construct_MessageRef" LowerBound="65.39" HigherBound="65.53">
                                        <om:Property Name="Ref" Value="BadXmlOrderMsg" />
                                        <om:Property Name="ReportToAnalyst" Value="True" />
                                        <om:Property Name="Signal" Value="False" />
                                    </om:Element>
                                    <om:Element Type="MessageAssignment" OID="67f99bb2-c7c7-476e-9dff-1710429d96c0" ParentLink="ComplexStatement_Statement" LowerBound="67.1" HigherBound="69.1">
                                        <om:Property Name="Expression" Value="BadXmlOrderMsg = OrderMsg;" />
                                        <om:Property Name="ReportToAnalyst" Value="False" />
                                        <om:Property Name="Name" Value="Convert OrderMsg" />
                                        <om:Property Name="Signal" Value="False" />
                                    </om:Element>
                                </om:Element>
                                <om:Element Type="Call" OID="d6dbc3ea-cfd1-41f0-bf3e-b7d0c9cf68be" ParentLink="ComplexStatement_Statement" LowerBound="70.1" HigherBound="72.1">
                                    <om:Property Name="Identifier" Value="CallErrorHandler_Validate" />
                                    <om:Property Name="Invokee" Value="Microsoft.Samples.BizTalk.SouthridgeVideo.OrderManager.ErrorHandlerOrch" />
                                    <om:Property Name="ReportToAnalyst" Value="True" />
                                    <om:Property Name="Name" Value="Call Error Handler" />
                                    <om:Property Name="Signal" Value="False" />
                                    <om:Element Type="Parameter" OID="87d5c4d6-56ce-4885-b9fc-742886d02b3f" ParentLink="InvokeStatement_Parameter">
                                        <om:Property Name="Direction" Value="In" />
                                        <om:Property Name="Name" Value="BadXmlOrderMsg" />
                                        <om:Property Name="Type" Value="System.Xml.XmlDocument" />
                                        <om:Property Name="Signal" Value="False" />
                                    </om:Element>
                                    <om:Element Type="Parameter" OID="0b8353ae-4671-4db9-a841-84a1a29f1487" ParentLink="InvokeStatement_Parameter">
                                        <om:Property Name="Direction" Value="In" />
                                        <om:Property Name="Name" Value="BadOrderReason" />
                                        <om:Property Name="Type" Value="System.String" />
                                        <om:Property Name="Signal" Value="False" />
                                    </om:Element>
                                    <om:Element Type="Parameter" OID="fe7ffd40-f479-4400-97c7-eb569e9aa21c" ParentLink="InvokeStatement_Parameter">
                                        <om:Property Name="Direction" Value="Out" />
                                        <om:Property Name="Name" Value="FixedXmlOrderMsg" />
                                        <om:Property Name="Type" Value="System.Xml.XmlDocument" />
                                        <om:Property Name="Signal" Value="False" />
                                    </om:Element>
                                    <om:Element Type="Parameter" OID="52a54615-5fcb-47fd-9cb0-8ade9382563a" ParentLink="InvokeStatement_Parameter">
                                        <om:Property Name="Direction" Value="In" />
                                        <om:Property Name="Name" Value="IsInvalid" />
                                        <om:Property Name="Type" Value="System.Boolean" />
                                        <om:Property Name="Signal" Value="False" />
                                    </om:Element>
                                    <om:Element Type="Parameter" OID="127d16ac-301f-4134-9438-037f8099cda0" ParentLink="InvokeStatement_Parameter">
                                        <om:Property Name="Direction" Value="In" />
                                        <om:Property Name="Name" Value="RoutingInfo" />
                                        <om:Property Name="Type" Value="Microsoft.Samples.BizTalk.SouthridgeVideo.SchemaClasses.Routing" />
                                        <om:Property Name="Signal" Value="False" />
                                    </om:Element>
                                </om:Element>
                                <om:Element Type="Construct" OID="d82761b8-6fbf-41d1-8a4f-30d467ea9ff4" ParentLink="ComplexStatement_Statement" LowerBound="72.1" HigherBound="78.1">
                                    <om:Property Name="ReportToAnalyst" Value="True" />
                                    <om:Property Name="Name" Value="Construct OrderMsg" />
                                    <om:Property Name="Signal" Value="True" />
                                    <om:Element Type="MessageRef" OID="5cac054c-7b12-42bb-b68d-a13744b281ae" ParentLink="Construct_MessageRef" LowerBound="73.39" HigherBound="73.47">
                                        <om:Property Name="Ref" Value="OrderMsg" />
                                        <om:Property Name="ReportToAnalyst" Value="True" />
                                        <om:Property Name="Signal" Value="False" />
                                    </om:Element>
                                    <om:Element Type="MessageAssignment" OID="a57baa6e-3f07-4821-a7a3-a6c16dfb8419" ParentLink="ComplexStatement_Statement" LowerBound="75.1" HigherBound="77.1">
                                        <om:Property Name="Expression" Value="OrderMsg = FixedXmlOrderMsg;" />
                                        <om:Property Name="ReportToAnalyst" Value="False" />
                                        <om:Property Name="Name" Value="Convert OrderMsg" />
                                        <om:Property Name="Signal" Value="False" />
                                    </om:Element>
                                </om:Element>
                            </om:Element>
                            <om:Element Type="DecisionBranch" OID="6b538a03-1f69-4f01-b760-902ce286f173" ParentLink="ReallyComplexStatement_Branch">
                                <om:Property Name="IsGhostBranch" Value="True" />
                                <om:Property Name="ReportToAnalyst" Value="True" />
                                <om:Property Name="Name" Value="Else" />
                                <om:Property Name="Signal" Value="False" />
                            </om:Element>
                        </om:Element>
                        <om:Element Type="Catch" OID="d9c6ef8b-48e4-4ff2-aa55-13eced02ca0d" ParentLink="Scope_Catch" LowerBound="82.1" HigherBound="103.1">
                            <om:Property Name="ExceptionName" Value="RulesEngineEx" />
                            <om:Property Name="ExceptionType" Value="System.Exception" />
                            <om:Property Name="IsFaultMessage" Value="False" />
                            <om:Property Name="ReportToAnalyst" Value="True" />
                            <om:Property Name="Name" Value="Catch Exception" />
                            <om:Property Name="Signal" Value="True" />
                            <om:Element Type="VariableAssignment" OID="2dece74b-f6a5-46e0-ba72-f33aa0ce2f23" ParentLink="Catch_Statement" LowerBound="85.1" HigherBound="88.1">
                                <om:Property Name="Expression" Value="ExceptionReason = RulesEngineEx.ToString();&#xD;&#xA;Microsoft.Samples.BizTalk.SouthridgeVideo.Utilities.ErrorHandler.PostError( ExceptionReason );" />
                                <om:Property Name="ReportToAnalyst" Value="True" />
                                <om:Property Name="Name" Value="Get Exception" />
                                <om:Property Name="Signal" Value="True" />
                            </om:Element>
                            <om:Element Type="Construct" OID="8f076f89-e056-4475-811c-491c15286676" ParentLink="Catch_Statement" LowerBound="88.1" HigherBound="94.1">
                                <om:Property Name="ReportToAnalyst" Value="True" />
                                <om:Property Name="Name" Value="Construct BadXmlOrderMsg" />
                                <om:Property Name="Signal" Value="True" />
                                <om:Element Type="MessageRef" OID="2734aa13-29f0-4af9-8e6b-7de39e4a5ccd" ParentLink="Construct_MessageRef" LowerBound="89.39" HigherBound="89.53">
                                    <om:Property Name="Ref" Value="BadXmlOrderMsg" />
                                    <om:Property Name="ReportToAnalyst" Value="True" />
                                    <om:Property Name="Signal" Value="False" />
                                </om:Element>
                                <om:Element Type="MessageAssignment" OID="a37f5779-b700-44ee-9fbc-a7174c12d08a" ParentLink="ComplexStatement_Statement" LowerBound="91.1" HigherBound="93.1">
                                    <om:Property Name="Expression" Value="BadXmlOrderMsg = OrderMsg;" />
                                    <om:Property Name="ReportToAnalyst" Value="False" />
                                    <om:Property Name="Name" Value="Convert OrderMsg" />
                                    <om:Property Name="Signal" Value="False" />
                                </om:Element>
                            </om:Element>
                            <om:Element Type="Call" OID="40cbaf15-8494-4f33-ab3a-c5d88e2bccf8" ParentLink="Catch_Statement" LowerBound="94.1" HigherBound="96.1">
                                <om:Property Name="Identifier" Value="CallErrorHandler" />
                                <om:Property Name="Invokee" Value="Microsoft.Samples.BizTalk.SouthridgeVideo.OrderManager.ErrorHandlerOrch" />
                                <om:Property Name="ReportToAnalyst" Value="True" />
                                <om:Property Name="Name" Value="Call ErrorHandler" />
                                <om:Property Name="Signal" Value="True" />
                                <om:Element Type="Parameter" OID="3f3b1ddf-ae3f-47c4-8511-c7c4b3733959" ParentLink="InvokeStatement_Parameter">
                                    <om:Property Name="Direction" Value="In" />
                                    <om:Property Name="Name" Value="BadXmlOrderMsg" />
                                    <om:Property Name="Type" Value="System.Xml.XmlDocument" />
                                    <om:Property Name="Signal" Value="False" />
                                </om:Element>
                                <om:Element Type="Parameter" OID="d7a8b5f2-f4d9-4db9-b3f7-a53282f3ea08" ParentLink="InvokeStatement_Parameter">
                                    <om:Property Name="Direction" Value="In" />
                                    <om:Property Name="Name" Value="ExceptionReason" />
                                    <om:Property Name="Type" Value="System.String" />
                                    <om:Property Name="Signal" Value="False" />
                                </om:Element>
                                <om:Element Type="Parameter" OID="2f6a9126-f82d-4f2c-84ae-f150fc03f1ba" ParentLink="InvokeStatement_Parameter">
                                    <om:Property Name="Direction" Value="Out" />
                                    <om:Property Name="Name" Value="FixedXmlOrderMsg" />
                                    <om:Property Name="Type" Value="System.Xml.XmlDocument" />
                                    <om:Property Name="Signal" Value="False" />
                                </om:Element>
                                <om:Element Type="Parameter" OID="729f31d8-1f49-485c-a789-bbad99c98191" ParentLink="InvokeStatement_Parameter">
                                    <om:Property Name="Direction" Value="In" />
                                    <om:Property Name="Name" Value="IsNotBadOrder" />
                                    <om:Property Name="Type" Value="System.Boolean" />
                                    <om:Property Name="Signal" Value="False" />
                                </om:Element>
                                <om:Element Type="Parameter" OID="27f9a955-18b3-464e-9f54-f102f0a1dccb" ParentLink="InvokeStatement_Parameter">
                                    <om:Property Name="Direction" Value="In" />
                                    <om:Property Name="Name" Value="RoutingInfo" />
                                    <om:Property Name="Type" Value="Microsoft.Samples.BizTalk.SouthridgeVideo.SchemaClasses.Routing" />
                                    <om:Property Name="Signal" Value="False" />
                                </om:Element>
                            </om:Element>
                            <om:Element Type="Construct" OID="c9eb64fb-9f04-45d4-b4f1-3d4f5b31ab5f" ParentLink="Catch_Statement" LowerBound="96.1" HigherBound="102.1">
                                <om:Property Name="ReportToAnalyst" Value="True" />
                                <om:Property Name="Name" Value="Construct OrderMsg" />
                                <om:Property Name="Signal" Value="True" />
                                <om:Element Type="MessageRef" OID="d0037907-3993-4e98-84e4-ccbb6781e3fd" ParentLink="Construct_MessageRef" LowerBound="97.39" HigherBound="97.47">
                                    <om:Property Name="Ref" Value="OrderMsg" />
                                    <om:Property Name="ReportToAnalyst" Value="True" />
                                    <om:Property Name="Signal" Value="False" />
                                </om:Element>
                                <om:Element Type="MessageAssignment" OID="bf2cc1f4-a4e8-4475-bb11-4fd4c77d97fe" ParentLink="ComplexStatement_Statement" LowerBound="99.1" HigherBound="101.1">
                                    <om:Property Name="Expression" Value="OrderMsg = FixedXmlOrderMsg;" />
                                    <om:Property Name="ReportToAnalyst" Value="False" />
                                    <om:Property Name="Name" Value="Convert OrderMsg" />
                                    <om:Property Name="Signal" Value="False" />
                                </om:Element>
                            </om:Element>
                        </om:Element>
                    </om:Element>
                </om:Element>
                <om:Element Type="MessageDeclaration" OID="cc0808e8-9b63-4029-a490-cb6dc3140fe9" ParentLink="ServiceBody_Declaration" LowerBound="13.15" HigherBound="13.97">
                    <om:Property Name="Type" Value="Microsoft.Samples.BizTalk.SouthridgeVideo.Schemas.OrderSchema" />
                    <om:Property Name="ParamDirection" Value="Ref" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="OrderMsg" />
                    <om:Property Name="Signal" Value="True" />
                </om:Element>
                <om:Element Type="VariableDeclaration" OID="f75d378c-7e55-4880-a929-424c8d339630" ParentLink="ServiceBody_Declaration" LowerBound="13.99" HigherBound="13.174">
                    <om:Property Name="UseDefaultConstructor" Value="True" />
                    <om:Property Name="Type" Value="Microsoft.Samples.BizTalk.SouthridgeVideo.SchemaClasses.Routing" />
                    <om:Property Name="ParamDirection" Value="In" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="RoutingInfo" />
                    <om:Property Name="Signal" Value="True" />
                </om:Element>
            </om:Element>
        </om:Element>
    </om:Element>
    <om:Element Type="PrintElement" OID="ff931302-5627-4a91-a077-45f98cb64709">
        <om:Property Name="Bottom" Value="0" />
        <om:Property Name="FooterBottom" Value="0" />
        <om:Property Name="FooterCenter" Value="0" />
        <om:Property Name="FooterMargin" Value="0" />
        <om:Property Name="FooterTop" Value="0" />
        <om:Property Name="HeaderBottom" Value="0" />
        <om:Property Name="HeaderCenter" Value="3" />
        <om:Property Name="HeaderMargin" Value="0" />
        <om:Property Name="HeaderTop" Value="0" />
        <om:Property Name="Left" Value="0" />
        <om:Property Name="PagesAcross" Value="0" />
        <om:Property Name="PagesDown" Value="0" />
        <om:Property Name="Right" Value="0" />
        <om:Property Name="Scaling" Value="100" />
        <om:Property Name="Top" Value="0" />
        <om:Property Name="Orientation" Value="Portrait" />
        <om:Property Name="Signal" Value="False" />
    </om:Element>
</om:MetaModel>
#endif // __DESIGNER_DATA
[Microsoft.XLANGs.BaseTypes.BPELExportable(false)]
module Microsoft.Samples.BizTalk.SouthridgeVideo.CableOrderActions
{
    [Microsoft.XLANGs.BaseTypes.BPELExportable(false)]
    public service longrunning transaction ValidateOrch
    {
        message System.Xml.XmlDocument BadXmlOrderMsg;
        message System.Xml.XmlDocument FixedXmlOrderMsg;
        System.String BadOrderReason;
        System.Boolean IsInvalid;
        System.String ExceptionReason;
        System.Boolean IsNotBadOrder;
        body (ref message Microsoft.Samples.BizTalk.SouthridgeVideo.Schemas.OrderSchema OrderMsg, Microsoft.Samples.BizTalk.SouthridgeVideo.SchemaClasses.Routing RoutingInfo)
        {
            BadOrderReason = "Validation failed";
            IsInvalid = true;
            ExceptionReason = "";
            IsNotBadOrder = true;
            [Microsoft.XLANGs.BaseTypes.DesignerPosition("96f9f817-8eb5-4080-85a0-a7fbc2835a7f")]
            while (IsInvalid)
            {
                [Microsoft.XLANGs.BaseTypes.DesignerPosition("c909b765-1635-490d-86e7-a1accd6a2372")]
                scope longrunning transaction TryRulesEngineTx
                {
                    body
                    {
                        [Microsoft.XLANGs.BaseTypes.DesignerPosition("032145fa-b8bb-4797-af73-9360abf9f3d1")]
                        [Microsoft.XLANGs.BaseTypes.Transaction(Retry=true,Batch=true,Timeout=60,TranIsolationLevel=System.Data.IsolationLevel.Serializable)]
                        scope atomic transaction RulesEngineTx
                        {
                            body
                            {

                                [Microsoft.XLANGs.BaseTypes.DesignerPosition("d65d263e-31ff-438f-a7f1-acab9687a907")]
                                scope
                                {
                                    Microsoft.RuleEngine.Policy  policy_3__;
                                    System.Xml.XmlDocument policyParam_3_3__;
                                    Microsoft.RuleEngine.TypedXmlDocument policyParamAsTXD_3_3__;

                                    body
                                    {
                                                                                policyParam_3_3__ = OrderMsg;
                                        policyParamAsTXD_3_3__ = new Microsoft.RuleEngine.TypedXmlDocument("Microsoft.Samples.BizTalk.SouthridgeVideo.Schemas.OrderSchema", policyParam_3_3__);

                                        policy_3__ = new Microsoft.RuleEngine.Policy("DecodeAndValidateOrder");
                                        policy_3__.Execute(
                                            policyParamAsTXD_3_3__);
                                        construct OrderMsg
                                        {
                                            OrderMsg = policyParamAsTXD_3_3__.Document;
                                        }

                                        policy_3__.Dispose();
                                    }
                                }
                            }
                        }
                        [Microsoft.XLANGs.BaseTypes.DesignerPosition("528ec710-3f3a-4d87-acbc-4adf550faf50")]
                        IsInvalid = (OrderMsg.OrderType == "INVALID");
                        [Microsoft.XLANGs.BaseTypes.DesignerPosition("e27ccda9-95d1-4620-9a61-624a865254e1")]
                        if (IsInvalid)
                        {
                            [Microsoft.XLANGs.BaseTypes.DesignerPosition("b219fd98-80bf-4428-a31d-f1946fbdb750")]
                            construct BadXmlOrderMsg
                            {
                                [Microsoft.XLANGs.BaseTypes.DesignerPosition("67f99bb2-c7c7-476e-9dff-1710429d96c0")]
                                BadXmlOrderMsg = OrderMsg;
                            }
                            [Microsoft.XLANGs.BaseTypes.DesignerPosition("d6dbc3ea-cfd1-41f0-bf3e-b7d0c9cf68be")]
                            call Microsoft.Samples.BizTalk.SouthridgeVideo.OrderManager.ErrorHandlerOrch (BadXmlOrderMsg, BadOrderReason, out FixedXmlOrderMsg, IsInvalid, RoutingInfo);
                            [Microsoft.XLANGs.BaseTypes.DesignerPosition("d82761b8-6fbf-41d1-8a4f-30d467ea9ff4")]
                            construct OrderMsg
                            {
                                [Microsoft.XLANGs.BaseTypes.DesignerPosition("a57baa6e-3f07-4821-a7a3-a6c16dfb8419")]
                                OrderMsg = FixedXmlOrderMsg;
                            }
                        }
                    }
                    exceptions
                    {
                        [Microsoft.XLANGs.BaseTypes.DesignerPosition("d9c6ef8b-48e4-4ff2-aa55-13eced02ca0d")]
                        catch (System.Exception RulesEngineEx)
                        {
                            [Microsoft.XLANGs.BaseTypes.DesignerPosition("2dece74b-f6a5-46e0-ba72-f33aa0ce2f23")]
                            ExceptionReason = RulesEngineEx.ToString();
                            Microsoft.Samples.BizTalk.SouthridgeVideo.Utilities.ErrorHandler.PostError( ExceptionReason );
                            [Microsoft.XLANGs.BaseTypes.DesignerPosition("8f076f89-e056-4475-811c-491c15286676")]
                            construct BadXmlOrderMsg
                            {
                                [Microsoft.XLANGs.BaseTypes.DesignerPosition("a37f5779-b700-44ee-9fbc-a7174c12d08a")]
                                BadXmlOrderMsg = OrderMsg;
                            }
                            [Microsoft.XLANGs.BaseTypes.DesignerPosition("40cbaf15-8494-4f33-ab3a-c5d88e2bccf8")]
                            call Microsoft.Samples.BizTalk.SouthridgeVideo.OrderManager.ErrorHandlerOrch (BadXmlOrderMsg, ExceptionReason, out FixedXmlOrderMsg, IsNotBadOrder, RoutingInfo);
                            [Microsoft.XLANGs.BaseTypes.DesignerPosition("c9eb64fb-9f04-45d4-b4f1-3d4f5b31ab5f")]
                            construct OrderMsg
                            {
                                [Microsoft.XLANGs.BaseTypes.DesignerPosition("bf2cc1f4-a4e8-4475-bb11-4fd4c77d97fe")]
                                OrderMsg = FixedXmlOrderMsg;
                            }
                        }
                    }
                }
            }
        }
    }
}

