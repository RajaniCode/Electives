#if __DESIGNER_DATA
#error Do not define __DESIGNER_DATA.
<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<om:MetaModel MajorVersion="1" MinorVersion="3" Core="2b131234-7959-458d-834f-2dc0769ce683" ScheduleModel="66366196-361d-448d-976f-cab5e87496d2" xmlns:om="http://schemas.microsoft.com/BizTalk/2003/DesignerData">
    <om:Element Type="Module" OID="39f6f712-aae1-49d8-aabe-318050ffe8f6" LowerBound="1.1" HigherBound="108.1">
        <om:Property Name="ReportToAnalyst" Value="True" />
        <om:Property Name="Name" Value="Microsoft.Samples.BizTalk.SouthridgeVideo.OrderManager" />
        <om:Property Name="Signal" Value="False" />
        <om:Element Type="ServiceDeclaration" OID="6d61a306-6a7c-433f-a66e-3adb098a13eb" ParentLink="Module_ServiceDeclaration" LowerBound="18.1" HigherBound="107.1">
            <om:Property Name="InitializedTransactionType" Value="True" />
            <om:Property Name="IsInvokable" Value="True" />
            <om:Property Name="TypeModifier" Value="Public" />
            <om:Property Name="ReportToAnalyst" Value="True" />
            <om:Property Name="AnalystComments" Value="// Microsoft.Samples.BizTalk.SouthridgeVideo.OrderManager.ErrorHandler&#xD;&#xA;// ErrorHandler orchestration in the end to end Business Process Management Scenario.&#xD;&#xA;// &#xD;&#xA;//&#xD;&#xA;// Copyright (c) Microsoft Corporation. All rights reserved.  &#xD;&#xA;// THIS CODE AND INFORMATION ARE PROVIDED &quot;AS IS&quot; WITHOUT WARRANTY OF ANY KIND, &#xD;&#xA;// EITHER EXPRESSED OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE IMPLIED WARRANTIES &#xD;&#xA;// OF MERCHANTABILITY AND/OR FITNESS FOR A PARTICULAR PURPOSE." />
            <om:Property Name="Name" Value="ErrorHandlerOrch" />
            <om:Property Name="Signal" Value="True" />
            <om:Element Type="VariableDeclaration" OID="4a506180-2929-4ccc-9abe-946fc6e596af" ParentLink="ServiceDeclaration_VariableDeclaration" LowerBound="33.1" HigherBound="34.1">
                <om:Property Name="UseDefaultConstructor" Value="True" />
                <om:Property Name="Type" Value="Microsoft.Samples.BizTalk.SouthridgeVideo.Utilities.InterruptException" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="interruptEx" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="CorrelationDeclaration" OID="f65aef9f-27ef-4526-a27f-ca7788b51af7" ParentLink="ServiceDeclaration_CorrelationDeclaration" LowerBound="29.1" HigherBound="30.1">
                <om:Property Name="Type" Value="Microsoft.Samples.BizTalk.SouthridgeVideo.OrderManager.OrderCorrelationType" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="OrderCorrelation" />
                <om:Property Name="Signal" Value="True" />
                <om:Element Type="StatementRef" OID="8d6856ea-ba1c-4256-a6d5-fb61a281c5ac" ParentLink="CorrelationDeclaration_StatementRef" LowerBound="97.71" HigherBound="97.87">
                    <om:Property Name="Initializes" Value="False" />
                    <om:Property Name="Ref" Value="67baac04-c735-4271-a4b3-bd3a483cf816" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="StatementRef_2" />
                    <om:Property Name="Signal" Value="False" />
                </om:Element>
                <om:Element Type="StatementRef" OID="3de8a144-bb46-4755-9863-a16046bff76f" ParentLink="CorrelationDeclaration_StatementRef" LowerBound="78.67" HigherBound="78.94">
                    <om:Property Name="Initializes" Value="True" />
                    <om:Property Name="Ref" Value="66269cde-75c4-4048-a898-1852dadf3519" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="StatementRef_3" />
                    <om:Property Name="Signal" Value="False" />
                </om:Element>
                <om:Element Type="StatementRef" OID="508f1fc4-ff7b-42d7-ab40-aac12cdd6519" ParentLink="CorrelationDeclaration_StatementRef" LowerBound="58.58" HigherBound="58.85">
                    <om:Property Name="Initializes" Value="True" />
                    <om:Property Name="Ref" Value="d1627557-989d-46c4-9e94-4165a26dd390" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="StatementRef_4" />
                    <om:Property Name="Signal" Value="False" />
                </om:Element>
                <om:Element Type="StatementRef" OID="50622e80-febe-43fe-a8d3-448c095ebb9a" ParentLink="CorrelationDeclaration_StatementRef" LowerBound="84.72" HigherBound="84.88">
                    <om:Property Name="Initializes" Value="False" />
                    <om:Property Name="Ref" Value="e59e3340-bb77-4279-a92a-e494b8521e2f" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="StatementRef_5" />
                    <om:Property Name="Signal" Value="False" />
                </om:Element>
            </om:Element>
            <om:Element Type="MessageDeclaration" OID="5e43ca8d-db71-4935-9587-064b8858f21c" ParentLink="ServiceDeclaration_MessageDeclaration" LowerBound="30.1" HigherBound="31.1">
                <om:Property Name="Type" Value="Microsoft.Samples.BizTalk.SouthridgeVideo.SchemaClasses.Interrupt" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="InterruptMsg" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="MessageDeclaration" OID="3a36add7-1698-4a81-9357-cca34ef533f0" ParentLink="ServiceDeclaration_MessageDeclaration" LowerBound="31.1" HigherBound="32.1">
                <om:Property Name="Type" Value="Microsoft.Samples.BizTalk.SouthridgeVideo.SchemaClasses.OrderStatus" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="OrderStatusMsg" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="MessageDeclaration" OID="f28432d5-9275-4524-b915-9e2953e4efd0" ParentLink="ServiceDeclaration_MessageDeclaration" LowerBound="32.1" HigherBound="33.1">
                <om:Property Name="Type" Value="Microsoft.Samples.BizTalk.SouthridgeVideo.SchemaClasses.OrderStatus" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="ResponseMsg" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="ServiceBody" OID="acf5f51e-ae5d-4ebd-bfb0-dd0d812f7677" ParentLink="ServiceDeclaration_ServiceBody">
                <om:Property Name="Signal" Value="False" />
                <om:Element Type="Decision" OID="c107538b-73b4-408b-92fd-3b8d7ce164ed" ParentLink="ServiceBody_Statement" LowerBound="37.1" HigherBound="80.1">
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="Operator or CSR" />
                    <om:Property Name="Signal" Value="True" />
                    <om:Element Type="DecisionBranch" OID="f1e53a58-fa28-4701-b78c-010c181426ba" ParentLink="ReallyComplexStatement_Branch" LowerBound="38.13" HigherBound="60.1">
                        <om:Property Name="Expression" Value="IsBadOrder" />
                        <om:Property Name="IsGhostBranch" Value="True" />
                        <om:Property Name="ReportToAnalyst" Value="True" />
                        <om:Property Name="Name" Value="Bad Order" />
                        <om:Property Name="Signal" Value="True" />
                        <om:Element Type="Construct" OID="966ee0cc-4ec6-4325-b460-3a2ebd279a6b" ParentLink="ComplexStatement_Statement" LowerBound="40.1" HigherBound="55.1">
                            <om:Property Name="ReportToAnalyst" Value="True" />
                            <om:Property Name="Name" Value="Construct OrderStatusMsg" />
                            <om:Property Name="Signal" Value="True" />
                            <om:Element Type="MessageRef" OID="a1ed35cb-6bb2-47b0-b5e0-8cd775220f4c" ParentLink="Construct_MessageRef" LowerBound="41.27" HigherBound="41.41">
                                <om:Property Name="Ref" Value="OrderStatusMsg" />
                                <om:Property Name="ReportToAnalyst" Value="True" />
                                <om:Property Name="Signal" Value="False" />
                            </om:Element>
                            <om:Element Type="MessageAssignment" OID="40b78426-08d0-437c-956e-ef1fd3cb4969" ParentLink="ComplexStatement_Statement" LowerBound="43.1" HigherBound="54.1">
                                <om:Property Name="Expression" Value="OrderStatusMsg = new Microsoft.Samples.BizTalk.SouthridgeVideo.SchemaClasses.OrderStatus();&#xD;&#xA;OrderStatusMsg.CustomerID = RoutingInfo.CustomerID;&#xD;&#xA;OrderStatusMsg.OrderID = RoutingInfo.OrderID;&#xD;&#xA;OrderStatusMsg.SeqNum = RoutingInfo.SeqNum;&#xD;&#xA;OrderStatusMsg.OriginalOrder = OriginalMsg.OuterXml;&#xD;&#xA;OrderStatusMsg.Status = &quot;BADORDER&quot;;&#xD;&#xA;// Error is a promoted property and should be less than 256 characters&#xD;&#xA;OrderStatusMsg.Error = Microsoft.Samples.BizTalk.SouthridgeVideo.Utilities.HelperMethods.Truncate(Reason);&#xD;&#xA;// if there error doesn't fit into the Error property then copy it to the ErrorComplete field&#xD;&#xA;OrderStatusMsg.ErrorComplete = Microsoft.Samples.BizTalk.SouthridgeVideo.Utilities.HelperMethods.GetIfLarge(Reason);&#xD;&#xA;" />
                                <om:Property Name="ReportToAnalyst" Value="False" />
                                <om:Property Name="Name" Value="Fill In Error" />
                                <om:Property Name="Signal" Value="True" />
                            </om:Element>
                        </om:Element>
                        <om:Element Type="VariableAssignment" OID="35b2ddbd-e783-43bd-bf88-b24d889542ce" ParentLink="ComplexStatement_Statement" LowerBound="55.1" HigherBound="57.1">
                            <om:Property Name="Expression" Value="BadOrderPort(Microsoft.XLANGs.BaseTypes.Address) = RoutingInfo.SourceSystem;" />
                            <om:Property Name="ReportToAnalyst" Value="True" />
                            <om:Property Name="Name" Value="Assign Destination" />
                            <om:Property Name="Signal" Value="False" />
                        </om:Element>
                        <om:Element Type="Send" OID="d1627557-989d-46c4-9e94-4165a26dd390" ParentLink="ComplexStatement_Statement" LowerBound="57.1" HigherBound="59.1">
                            <om:Property Name="PortName" Value="BadOrderPort" />
                            <om:Property Name="MessageName" Value="OrderStatusMsg" />
                            <om:Property Name="OperationName" Value="Send" />
                            <om:Property Name="OperationMessageName" Value="OrderStatus" />
                            <om:Property Name="ReportToAnalyst" Value="True" />
                            <om:Property Name="Name" Value="To CSR" />
                            <om:Property Name="Signal" Value="True" />
                        </om:Element>
                    </om:Element>
                    <om:Element Type="DecisionBranch" OID="775a1653-98bb-4936-bb54-da9b9158e9c1" ParentLink="ReallyComplexStatement_Branch">
                        <om:Property Name="IsGhostBranch" Value="True" />
                        <om:Property Name="ReportToAnalyst" Value="True" />
                        <om:Property Name="Name" Value="Else" />
                        <om:Property Name="Signal" Value="False" />
                        <om:Element Type="Construct" OID="3fd7a734-d4e7-4fec-85b2-f00452071819" ParentLink="ComplexStatement_Statement" LowerBound="62.1" HigherBound="77.1">
                            <om:Property Name="ReportToAnalyst" Value="True" />
                            <om:Property Name="Name" Value="Construct OrderStatusMsg" />
                            <om:Property Name="Signal" Value="True" />
                            <om:Element Type="MessageRef" OID="8e9aeeeb-1e12-441b-bd51-ea33e229e4cc" ParentLink="Construct_MessageRef" LowerBound="63.27" HigherBound="63.41">
                                <om:Property Name="Ref" Value="OrderStatusMsg" />
                                <om:Property Name="ReportToAnalyst" Value="True" />
                                <om:Property Name="Signal" Value="False" />
                            </om:Element>
                            <om:Element Type="MessageAssignment" OID="74fe60b7-2a91-484d-aaab-50bcd8c150ec" ParentLink="ComplexStatement_Statement" LowerBound="65.1" HigherBound="76.1">
                                <om:Property Name="Expression" Value="OrderStatusMsg = new Microsoft.Samples.BizTalk.SouthridgeVideo.SchemaClasses.OrderStatus();&#xD;&#xA;OrderStatusMsg.CustomerID = RoutingInfo.CustomerID;&#xD;&#xA;OrderStatusMsg.OrderID = RoutingInfo.OrderID;&#xD;&#xA;OrderStatusMsg.SeqNum = RoutingInfo.SeqNum;&#xD;&#xA;OrderStatusMsg.OriginalOrder = OriginalMsg.OuterXml;&#xD;&#xA;OrderStatusMsg.Status = &quot;BADORDER&quot;;&#xD;&#xA;// Error is a promoted property and should be less than 256 characters&#xD;&#xA;OrderStatusMsg.Error = Microsoft.Samples.BizTalk.SouthridgeVideo.Utilities.HelperMethods.Truncate(Reason);&#xD;&#xA;// if there error doesn't fit into the Error property then copy it to the ErrorComplete field&#xD;&#xA;OrderStatusMsg.ErrorComplete = Microsoft.Samples.BizTalk.SouthridgeVideo.Utilities.HelperMethods.GetIfLarge(Reason);&#xD;&#xA;" />
                                <om:Property Name="ReportToAnalyst" Value="False" />
                                <om:Property Name="Name" Value="Fill In Error" />
                                <om:Property Name="Signal" Value="False" />
                            </om:Element>
                        </om:Element>
                        <om:Element Type="Send" OID="66269cde-75c4-4048-a898-1852dadf3519" ParentLink="ComplexStatement_Statement" LowerBound="77.1" HigherBound="79.1">
                            <om:Property Name="PortName" Value="ErrorNotificationPort" />
                            <om:Property Name="MessageName" Value="OrderStatusMsg" />
                            <om:Property Name="OperationName" Value="Send" />
                            <om:Property Name="OperationMessageName" Value="OrderErrorMsg" />
                            <om:Property Name="ReportToAnalyst" Value="True" />
                            <om:Property Name="Name" Value="To Operator" />
                            <om:Property Name="Signal" Value="True" />
                        </om:Element>
                    </om:Element>
                </om:Element>
                <om:Element Type="Listen" OID="1c7d7b7e-69e2-4dca-8339-934a5b2513c1" ParentLink="ServiceBody_Statement" LowerBound="80.1" HigherBound="105.1">
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="Listen for Response or Terminate" />
                    <om:Property Name="Signal" Value="True" />
                    <om:Element Type="ListenBranch" OID="85bf2648-7122-4c66-b933-cff1c57adca2" ParentLink="ReallyComplexStatement_Branch" LowerBound="80.1" HigherBound="80.1">
                        <om:Property Name="IsGhostBranch" Value="True" />
                        <om:Property Name="ReportToAnalyst" Value="True" />
                        <om:Property Name="Name" Value="ListenBranch_1" />
                        <om:Property Name="Signal" Value="True" />
                        <om:Element Type="Receive" OID="e59e3340-bb77-4279-a92a-e494b8521e2f" ParentLink="ListenBranch_Statement" LowerBound="83.1" HigherBound="84.89">
                            <om:Property Name="Activate" Value="False" />
                            <om:Property Name="PortName" Value="ErrorResponsePort" />
                            <om:Property Name="MessageName" Value="ResponseMsg" />
                            <om:Property Name="OperationName" Value="Receive" />
                            <om:Property Name="OperationMessageName" Value="Response" />
                            <om:Property Name="ReportToAnalyst" Value="True" />
                            <om:Property Name="Name" Value="Response" />
                            <om:Property Name="Signal" Value="True" />
                        </om:Element>
                        <om:Element Type="Construct" OID="69a68011-57c0-442e-b628-73131198f61e" ParentLink="ComplexStatement_Statement" LowerBound="86.1" HigherBound="95.1">
                            <om:Property Name="ReportToAnalyst" Value="True" />
                            <om:Property Name="Name" Value="Construct ReturnedMsg" />
                            <om:Property Name="Signal" Value="True" />
                            <om:Element Type="MessageRef" OID="f964e333-6fba-4ed8-a6ca-655af8beb81e" ParentLink="Construct_MessageRef" LowerBound="87.31" HigherBound="87.42">
                                <om:Property Name="Ref" Value="ReturnedMsg" />
                                <om:Property Name="ReportToAnalyst" Value="True" />
                                <om:Property Name="Signal" Value="False" />
                            </om:Element>
                            <om:Element Type="MessageAssignment" OID="fa63d627-dde0-44e0-95b6-38e726a2f414" ParentLink="ComplexStatement_Statement" LowerBound="89.1" HigherBound="94.1">
                                <om:Property Name="Expression" Value="// Using XmlDocument here is OK for small messages&#xD;&#xA;// if you have large messages you should write a more efficient helper class to create the message using streams&#xD;&#xA;ReturnedMsg = new System.Xml.XmlDocument();&#xD;&#xA;ReturnedMsg.LoadXml(ResponseMsg.OriginalOrder);&#xD;&#xA;" />
                                <om:Property Name="ReportToAnalyst" Value="False" />
                                <om:Property Name="Name" Value="Insert Response" />
                                <om:Property Name="Signal" Value="False" />
                            </om:Element>
                        </om:Element>
                    </om:Element>
                    <om:Element Type="ListenBranch" OID="09ecb94e-a87a-4458-96cb-18e6603a06eb" ParentLink="ReallyComplexStatement_Branch" LowerBound="80.1" HigherBound="80.1">
                        <om:Property Name="IsGhostBranch" Value="True" />
                        <om:Property Name="ReportToAnalyst" Value="True" />
                        <om:Property Name="Name" Value="ListenBranch_3" />
                        <om:Property Name="Signal" Value="True" />
                        <om:Element Type="Send" OID="e1b6f42d-baa1-4b1d-be1c-f124c88d9cbb" ParentLink="ComplexStatement_Statement" LowerBound="99.1" HigherBound="101.1">
                            <om:Property Name="PortName" Value="InterruptPort" />
                            <om:Property Name="MessageName" Value="InterruptMsg" />
                            <om:Property Name="OperationName" Value="Interrupt" />
                            <om:Property Name="OperationMessageName" Value="Response" />
                            <om:Property Name="ReportToAnalyst" Value="True" />
                            <om:Property Name="Name" Value="Interrupted" />
                            <om:Property Name="Signal" Value="True" />
                        </om:Element>
                        <om:Element Type="Throw" OID="fa376539-8f73-4759-b1ed-f83d72bd81ff" ParentLink="ComplexStatement_Statement" LowerBound="101.1" HigherBound="103.1">
                            <om:Property Name="ThrownReference" Value="interruptEx" />
                            <om:Property Name="ReportToAnalyst" Value="True" />
                            <om:Property Name="Name" Value="Throw InterruptEx" />
                            <om:Property Name="Signal" Value="True" />
                        </om:Element>
                        <om:Element Type="Receive" OID="67baac04-c735-4271-a4b3-bd3a483cf816" ParentLink="ListenBranch_Statement" LowerBound="96.1" HigherBound="97.88">
                            <om:Property Name="Activate" Value="False" />
                            <om:Property Name="PortName" Value="InterruptPort" />
                            <om:Property Name="MessageName" Value="InterruptMsg" />
                            <om:Property Name="OperationName" Value="Interrupt" />
                            <om:Property Name="OperationMessageName" Value="Request" />
                            <om:Property Name="ReportToAnalyst" Value="True" />
                            <om:Property Name="Name" Value="Interrupt" />
                            <om:Property Name="Signal" Value="True" />
                        </om:Element>
                    </om:Element>
                </om:Element>
                <om:Element Type="MessageDeclaration" OID="bac51772-48ca-49b4-9983-799b699841cc" ParentLink="ServiceBody_Declaration" LowerBound="34.15" HigherBound="34.57">
                    <om:Property Name="Type" Value="System.Xml.XmlDocument" />
                    <om:Property Name="ParamDirection" Value="In" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="OriginalMsg" />
                    <om:Property Name="Signal" Value="True" />
                </om:Element>
                <om:Element Type="VariableDeclaration" OID="1b3ff25c-3134-4563-838b-81a32b792c91" ParentLink="ServiceBody_Declaration" LowerBound="34.59" HigherBound="34.79">
                    <om:Property Name="UseDefaultConstructor" Value="False" />
                    <om:Property Name="Type" Value="System.String" />
                    <om:Property Name="ParamDirection" Value="In" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="Reason" />
                    <om:Property Name="Signal" Value="True" />
                </om:Element>
                <om:Element Type="MessageDeclaration" OID="ce443e5b-1b29-4a47-b936-9b0368c594dc" ParentLink="ServiceBody_Declaration" LowerBound="34.81" HigherBound="34.127">
                    <om:Property Name="Type" Value="System.Xml.XmlDocument" />
                    <om:Property Name="ParamDirection" Value="Out" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="ReturnedMsg" />
                    <om:Property Name="Signal" Value="True" />
                </om:Element>
                <om:Element Type="VariableDeclaration" OID="21d36b66-36ee-4cae-bf1d-492b6a0cf517" ParentLink="ServiceBody_Declaration" LowerBound="34.129" HigherBound="34.154">
                    <om:Property Name="InitialValue" Value="true" />
                    <om:Property Name="UseDefaultConstructor" Value="False" />
                    <om:Property Name="Type" Value="System.Boolean" />
                    <om:Property Name="ParamDirection" Value="In" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="IsBadOrder" />
                    <om:Property Name="Signal" Value="True" />
                </om:Element>
                <om:Element Type="VariableDeclaration" OID="6acb8f67-fa37-427b-9b47-aa7d94b9bedc" ParentLink="ServiceBody_Declaration" LowerBound="34.156" HigherBound="34.231">
                    <om:Property Name="UseDefaultConstructor" Value="True" />
                    <om:Property Name="Type" Value="Microsoft.Samples.BizTalk.SouthridgeVideo.SchemaClasses.Routing" />
                    <om:Property Name="ParamDirection" Value="In" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="RoutingInfo" />
                    <om:Property Name="Signal" Value="True" />
                </om:Element>
            </om:Element>
            <om:Element Type="PortDeclaration" OID="23f29db3-64c2-4200-821d-14e06afa7459" ParentLink="ServiceDeclaration_PortDeclaration" LowerBound="21.1" HigherBound="23.1">
                <om:Property Name="PortModifier" Value="Uses" />
                <om:Property Name="Orientation" Value="Right" />
                <om:Property Name="PortIndex" Value="19" />
                <om:Property Name="IsWebPort" Value="False" />
                <om:Property Name="OrderedDelivery" Value="False" />
                <om:Property Name="DeliveryNotification" Value="None" />
                <om:Property Name="Type" Value="Microsoft.Samples.BizTalk.SouthridgeVideo.OrderManager.ErrorNotificationPortType" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="ErrorNotificationPort" />
                <om:Property Name="Signal" Value="False" />
                <om:Element Type="LogicalBindingAttribute" OID="491ccaa0-c3bd-4048-b9a4-41836c548772" ParentLink="PortDeclaration_CLRAttribute" LowerBound="21.1" HigherBound="22.1">
                    <om:Property Name="Signal" Value="False" />
                </om:Element>
            </om:Element>
            <om:Element Type="PortDeclaration" OID="fd4d501b-d60d-47e4-bd95-4c7eb5d76dab" ParentLink="ServiceDeclaration_PortDeclaration" LowerBound="23.1" HigherBound="25.1">
                <om:Property Name="PortModifier" Value="Implements" />
                <om:Property Name="Orientation" Value="Right" />
                <om:Property Name="PortIndex" Value="35" />
                <om:Property Name="IsWebPort" Value="False" />
                <om:Property Name="OrderedDelivery" Value="False" />
                <om:Property Name="DeliveryNotification" Value="None" />
                <om:Property Name="Type" Value="Microsoft.Samples.BizTalk.SouthridgeVideo.OrderManager.InterruptPortType" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="InterruptPort" />
                <om:Property Name="Signal" Value="True" />
                <om:Element Type="DirectBindingAttribute" OID="8a8db754-3403-486d-aae4-5cdb5c35561e" ParentLink="PortDeclaration_CLRAttribute" LowerBound="23.1" HigherBound="24.1">
                    <om:Property Name="PartnerPort" Value="InterruptPort" />
                    <om:Property Name="PartnerService" Value="Microsoft.Samples.BizTalk.SouthridgeVideo.OrderManager.InterrupterOrch" />
                    <om:Property Name="DirectBindingType" Value="PartnerPort" />
                    <om:Property Name="Signal" Value="False" />
                </om:Element>
            </om:Element>
            <om:Element Type="PortDeclaration" OID="4f4cbfbf-5347-4221-b346-7c6d6e8d12be" ParentLink="ServiceDeclaration_PortDeclaration" LowerBound="25.1" HigherBound="27.1">
                <om:Property Name="PortModifier" Value="Implements" />
                <om:Property Name="Orientation" Value="Left" />
                <om:Property Name="PortIndex" Value="34" />
                <om:Property Name="IsWebPort" Value="False" />
                <om:Property Name="OrderedDelivery" Value="False" />
                <om:Property Name="DeliveryNotification" Value="None" />
                <om:Property Name="Type" Value="Microsoft.Samples.BizTalk.SouthridgeVideo.OrderManager.ErrorResponsePortType" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="ErrorResponsePort" />
                <om:Property Name="Signal" Value="True" />
                <om:Element Type="LogicalBindingAttribute" OID="4b2d6111-fb27-46ff-9ee6-06fcd22879d0" ParentLink="PortDeclaration_CLRAttribute" LowerBound="25.1" HigherBound="26.1">
                    <om:Property Name="Signal" Value="False" />
                </om:Element>
            </om:Element>
            <om:Element Type="PortDeclaration" OID="7bb9db89-3b09-47f8-bd79-43e136e7e75f" ParentLink="ServiceDeclaration_PortDeclaration" LowerBound="27.1" HigherBound="29.1">
                <om:Property Name="PortModifier" Value="Uses" />
                <om:Property Name="Orientation" Value="Left" />
                <om:Property Name="PortIndex" Value="24" />
                <om:Property Name="IsWebPort" Value="False" />
                <om:Property Name="OrderedDelivery" Value="False" />
                <om:Property Name="DeliveryNotification" Value="None" />
                <om:Property Name="Type" Value="Microsoft.Samples.BizTalk.SouthridgeVideo.OrderManager.CSRPortType" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="BadOrderPort" />
                <om:Property Name="Signal" Value="True" />
                <om:Element Type="PhysicalBindingAttribute" OID="39df3c05-0f81-4b49-804e-dcf6c26f091b" ParentLink="PortDeclaration_CLRAttribute" LowerBound="27.1" HigherBound="28.1">
                    <om:Property Name="InPipeline" Value="Microsoft.BizTalk.DefaultPipelines.XMLReceive" />
                    <om:Property Name="OutPipeline" Value="Microsoft.BizTalk.DefaultPipelines.PassThruTransmit" />
                    <om:Property Name="TransportType" Value="HTTP" />
                    <om:Property Name="URI" Value="http://tempURI" />
                    <om:Property Name="IsDynamic" Value="True" />
                    <om:Property Name="Signal" Value="False" />
                </om:Element>
            </om:Element>
        </om:Element>
        <om:Element Type="PortType" OID="c60d5b67-a426-4d12-80b2-3f276bd2ea1d" ParentLink="Module_PortType" LowerBound="4.1" HigherBound="11.1">
            <om:Property Name="Synchronous" Value="False" />
            <om:Property Name="TypeModifier" Value="Public" />
            <om:Property Name="ReportToAnalyst" Value="True" />
            <om:Property Name="Name" Value="ErrorResponsePortType" />
            <om:Property Name="Signal" Value="False" />
            <om:Element Type="OperationDeclaration" OID="0ed72e80-b985-4262-95ce-1cd55faaba97" ParentLink="PortType_OperationDeclaration" LowerBound="6.1" HigherBound="10.1">
                <om:Property Name="OperationType" Value="OneWay" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="Receive" />
                <om:Property Name="Signal" Value="True" />
                <om:Element Type="MessageRef" OID="87790056-049b-4bce-b324-2047a5ce83bf" ParentLink="OperationDeclaration_RequestMessageRef" LowerBound="8.13" HigherBound="8.80">
                    <om:Property Name="Ref" Value="Microsoft.Samples.BizTalk.SouthridgeVideo.SchemaClasses.OrderStatus" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="Response" />
                    <om:Property Name="Signal" Value="True" />
                </om:Element>
            </om:Element>
        </om:Element>
        <om:Element Type="PortType" OID="6fcc0cd1-4fa3-42c1-99e7-8741966bb539" ParentLink="Module_PortType" LowerBound="11.1" HigherBound="18.1">
            <om:Property Name="Synchronous" Value="False" />
            <om:Property Name="TypeModifier" Value="Internal" />
            <om:Property Name="ReportToAnalyst" Value="True" />
            <om:Property Name="Name" Value="ErrorNotificationPortType" />
            <om:Property Name="Signal" Value="False" />
            <om:Element Type="OperationDeclaration" OID="dec1884e-f81e-4e8f-9b7a-45ed9d900a1c" ParentLink="PortType_OperationDeclaration" LowerBound="13.1" HigherBound="17.1">
                <om:Property Name="OperationType" Value="OneWay" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="Send" />
                <om:Property Name="Signal" Value="True" />
                <om:Element Type="MessageRef" OID="63e77fb9-9536-4e18-af08-61366701c0c0" ParentLink="OperationDeclaration_RequestMessageRef" LowerBound="15.13" HigherBound="15.80">
                    <om:Property Name="Ref" Value="Microsoft.Samples.BizTalk.SouthridgeVideo.SchemaClasses.OrderStatus" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="OrderErrorMsg" />
                    <om:Property Name="Signal" Value="True" />
                </om:Element>
            </om:Element>
        </om:Element>
    </om:Element>
    <om:Element Type="PrintElement" OID="d8eed1b6-057a-4fdc-bdd0-8bf23e9d733d">
        <om:Property Name="Bottom" Value="0" />
        <om:Property Name="FooterBottom" Value="0" />
        <om:Property Name="FooterCenter" Value="0" />
        <om:Property Name="FooterMargin" Value="0" />
        <om:Property Name="FooterTop" Value="0" />
        <om:Property Name="HeaderBottom" Value="0" />
        <om:Property Name="HeaderCenter" Value="3" />
        <om:Property Name="HeaderMargin" Value="0" />
        <om:Property Name="HeaderTop" Value="0" />
        <om:Property Name="Left" Value="0" />
        <om:Property Name="PagesAcross" Value="0" />
        <om:Property Name="PagesDown" Value="0" />
        <om:Property Name="Right" Value="0" />
        <om:Property Name="Scaling" Value="85" />
        <om:Property Name="Top" Value="0" />
        <om:Property Name="Orientation" Value="Portrait" />
        <om:Property Name="Signal" Value="False" />
    </om:Element>
</om:MetaModel>
#endif // __DESIGNER_DATA
[Microsoft.XLANGs.BaseTypes.BPELExportable(false)]
module Microsoft.Samples.BizTalk.SouthridgeVideo.OrderManager
{
    public porttype ErrorResponsePortType
    {
        oneway Receive
        {
            Microsoft.Samples.BizTalk.SouthridgeVideo.SchemaClasses.OrderStatus
        };
    };
    internal porttype ErrorNotificationPortType
    {
        oneway Send
        {
            Microsoft.Samples.BizTalk.SouthridgeVideo.SchemaClasses.OrderStatus
        };
    };
    [Microsoft.XLANGs.BaseTypes.BPELExportable(false)]
    public service ErrorHandlerOrch
    {
        [Microsoft.XLANGs.BaseTypes.LogicalBinding()]
        port uses ErrorNotificationPortType ErrorNotificationPort;
        [Microsoft.XLANGs.BaseTypes.DirectBinding(typeof(Microsoft.Samples.BizTalk.SouthridgeVideo.OrderManager.InterrupterOrch), "InterruptPort")]
        port implements InterruptPortType InterruptPort;
        [Microsoft.XLANGs.BaseTypes.LogicalBinding()]
        port implements ErrorResponsePortType ErrorResponsePort;
        [Microsoft.XLANGs.BaseTypes.PhysicalBinding(typeof(Microsoft.BizTalk.DefaultPipelines.PassThruTransmit))]
        port uses dynamic CSRPortType BadOrderPort;
        correlation OrderCorrelationType OrderCorrelation;
        message Microsoft.Samples.BizTalk.SouthridgeVideo.SchemaClasses.Interrupt InterruptMsg;
        message Microsoft.Samples.BizTalk.SouthridgeVideo.SchemaClasses.OrderStatus OrderStatusMsg;
        message Microsoft.Samples.BizTalk.SouthridgeVideo.SchemaClasses.OrderStatus ResponseMsg;
        Microsoft.Samples.BizTalk.SouthridgeVideo.Utilities.InterruptException interruptEx;
        body (message System.Xml.XmlDocument OriginalMsg, System.String Reason, out message System.Xml.XmlDocument ReturnedMsg, System.Boolean IsBadOrder, Microsoft.Samples.BizTalk.SouthridgeVideo.SchemaClasses.Routing RoutingInfo)
        {
            interruptEx = new Microsoft.Samples.BizTalk.SouthridgeVideo.Utilities.InterruptException();
            [Microsoft.XLANGs.BaseTypes.DesignerPosition("c107538b-73b4-408b-92fd-3b8d7ce164ed")]
            if (IsBadOrder)
            {
                [Microsoft.XLANGs.BaseTypes.DesignerPosition("966ee0cc-4ec6-4325-b460-3a2ebd279a6b")]
                construct OrderStatusMsg
                {
                    [Microsoft.XLANGs.BaseTypes.DesignerPosition("40b78426-08d0-437c-956e-ef1fd3cb4969")]
                    OrderStatusMsg = new Microsoft.Samples.BizTalk.SouthridgeVideo.SchemaClasses.OrderStatus();
                    OrderStatusMsg.CustomerID = RoutingInfo.CustomerID;
                    OrderStatusMsg.OrderID = RoutingInfo.OrderID;
                    OrderStatusMsg.SeqNum = RoutingInfo.SeqNum;
                    OrderStatusMsg.OriginalOrder = OriginalMsg.OuterXml;
                    OrderStatusMsg.Status = "BADORDER";
                    // Error is a promoted property and should be less than 256 characters
                    OrderStatusMsg.Error = Microsoft.Samples.BizTalk.SouthridgeVideo.Utilities.HelperMethods.Truncate(Reason);
                    // if there error doesn't fit into the Error property then copy it to the ErrorComplete field
                    OrderStatusMsg.ErrorComplete = Microsoft.Samples.BizTalk.SouthridgeVideo.Utilities.HelperMethods.GetIfLarge(Reason);
                }
                [Microsoft.XLANGs.BaseTypes.DesignerPosition("35b2ddbd-e783-43bd-bf88-b24d889542ce")]
                BadOrderPort(Microsoft.XLANGs.BaseTypes.Address) = RoutingInfo.SourceSystem;
                [Microsoft.XLANGs.BaseTypes.DesignerPosition("d1627557-989d-46c4-9e94-4165a26dd390")]
                send (BadOrderPort.Send, OrderStatusMsg, initialize OrderCorrelation);
            }
            else 
            {
                [Microsoft.XLANGs.BaseTypes.DesignerPosition("3fd7a734-d4e7-4fec-85b2-f00452071819")]
                construct OrderStatusMsg
                {
                    [Microsoft.XLANGs.BaseTypes.DesignerPosition("74fe60b7-2a91-484d-aaab-50bcd8c150ec")]
                    OrderStatusMsg = new Microsoft.Samples.BizTalk.SouthridgeVideo.SchemaClasses.OrderStatus();
                    OrderStatusMsg.CustomerID = RoutingInfo.CustomerID;
                    OrderStatusMsg.OrderID = RoutingInfo.OrderID;
                    OrderStatusMsg.SeqNum = RoutingInfo.SeqNum;
                    OrderStatusMsg.OriginalOrder = OriginalMsg.OuterXml;
                    OrderStatusMsg.Status = "BADORDER";
                    // Error is a promoted property and should be less than 256 characters
                    OrderStatusMsg.Error = Microsoft.Samples.BizTalk.SouthridgeVideo.Utilities.HelperMethods.Truncate(Reason);
                    // if there error doesn't fit into the Error property then copy it to the ErrorComplete field
                    OrderStatusMsg.ErrorComplete = Microsoft.Samples.BizTalk.SouthridgeVideo.Utilities.HelperMethods.GetIfLarge(Reason);
                }
                [Microsoft.XLANGs.BaseTypes.DesignerPosition("66269cde-75c4-4048-a898-1852dadf3519")]
                send (ErrorNotificationPort.Send, OrderStatusMsg, initialize OrderCorrelation);
            }
            [Microsoft.XLANGs.BaseTypes.DesignerPosition("1c7d7b7e-69e2-4dca-8339-934a5b2513c1")]
            listen
            {
                [Microsoft.XLANGs.BaseTypes.DesignerPosition("e59e3340-bb77-4279-a92a-e494b8521e2f")]
                until receive (ErrorResponsePort.Receive, ResponseMsg, OrderCorrelation)
                {
                    [Microsoft.XLANGs.BaseTypes.DesignerPosition("69a68011-57c0-442e-b628-73131198f61e")]
                    construct ReturnedMsg
                    {
                        [Microsoft.XLANGs.BaseTypes.DesignerPosition("fa63d627-dde0-44e0-95b6-38e726a2f414")]
                        // Using XmlDocument here is OK for small messages
                        // if you have large messages you should write a more efficient helper class to create the message using streams
                        ReturnedMsg = new System.Xml.XmlDocument();
                        ReturnedMsg.LoadXml(ResponseMsg.OriginalOrder);
                    }
                }
                [Microsoft.XLANGs.BaseTypes.DesignerPosition("67baac04-c735-4271-a4b3-bd3a483cf816")]
                until receive (InterruptPort.Interrupt, InterruptMsg, OrderCorrelation)
                {
                    [Microsoft.XLANGs.BaseTypes.DesignerPosition("e1b6f42d-baa1-4b1d-be1c-f124c88d9cbb")]
                    send (InterruptPort.Interrupt, InterruptMsg);
                    [Microsoft.XLANGs.BaseTypes.DesignerPosition("fa376539-8f73-4759-b1ed-f83d72bd81ff")]
                    throw interruptEx;
                }
            }
        }
    }
}

