#if __DESIGNER_DATA
#error Do not define __DESIGNER_DATA.
<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<om:MetaModel MajorVersion="1" MinorVersion="3" Core="2b131234-7959-458d-834f-2dc0769ce683" ScheduleModel="66366196-361d-448d-976f-cab5e87496d2" xmlns:om="http://schemas.microsoft.com/BizTalk/2003/DesignerData">
    <om:Element Type="Module" OID="9cf78b6c-b135-48bc-a38c-42804db14d6f" LowerBound="1.1" HigherBound="118.1">
        <om:Property Name="ReportToAnalyst" Value="True" />
        <om:Property Name="Name" Value="Microsoft.Samples.BizTalk.SouthridgeVideo.OrderManager" />
        <om:Property Name="Signal" Value="False" />
        <om:Element Type="ServiceDeclaration" OID="366aed5f-0c75-40f4-99ef-2b6923c28b15" ParentLink="Module_ServiceDeclaration" LowerBound="4.1" HigherBound="117.1">
            <om:Property Name="InitializedTransactionType" Value="True" />
            <om:Property Name="IsInvokable" Value="True" />
            <om:Property Name="TypeModifier" Value="Public" />
            <om:Property Name="ReportToAnalyst" Value="True" />
            <om:Property Name="AnalystComments" Value="// Microsoft.Samples.BizTalk.SouthridgeVideo.OrderManager.ExceptionHandler&#xD;&#xA;// ExceptionHandler orchestration in the end to end Business Process Management Scenario.&#xD;&#xA;//&#xD;&#xA;// Copyright (c) Microsoft Corporation. All rights reserved.  &#xD;&#xA;// THIS CODE AND INFORMATION ARE PROVIDED &quot;AS IS&quot; WITHOUT WARRANTY OF ANY KIND, &#xD;&#xA;// EITHER EXPRESSED OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE IMPLIED WARRANTIES &#xD;&#xA;// OF MERCHANTABILITY AND/OR FITNESS FOR A PARTICULAR PURPOSE." />
            <om:Property Name="Name" Value="ExceptionHandlerOrch" />
            <om:Property Name="Signal" Value="True" />
            <om:Element Type="VariableDeclaration" OID="55784388-1eb5-4763-92ed-f02165810a3d" ParentLink="ServiceDeclaration_VariableDeclaration" LowerBound="7.1" HigherBound="8.1">
                <om:Property Name="InitialValue" Value="false" />
                <om:Property Name="UseDefaultConstructor" Value="False" />
                <om:Property Name="Type" Value="System.Boolean" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="IsDone" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="VariableDeclaration" OID="15d0e6a2-a448-4ce5-9b52-f545c6d9ffc7" ParentLink="ServiceDeclaration_VariableDeclaration" LowerBound="8.1" HigherBound="9.1">
                <om:Property Name="InitialValue" Value="3" />
                <om:Property Name="UseDefaultConstructor" Value="False" />
                <om:Property Name="Type" Value="System.Int32" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="RetryCounter" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="VariableDeclaration" OID="0a89e5a4-79d3-409a-a578-4ccc68181bae" ParentLink="ServiceDeclaration_VariableDeclaration" LowerBound="9.1" HigherBound="10.1">
                <om:Property Name="UseDefaultConstructor" Value="False" />
                <om:Property Name="Type" Value="System.String" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="Reason" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="VariableDeclaration" OID="90ec4a18-342f-4778-8b22-f2ffd1c6004a" ParentLink="ServiceDeclaration_VariableDeclaration" LowerBound="10.1" HigherBound="11.1">
                <om:Property Name="InitialValue" Value="false" />
                <om:Property Name="UseDefaultConstructor" Value="False" />
                <om:Property Name="Type" Value="System.Boolean" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="IsApplicationException" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="VariableDeclaration" OID="49af604c-599a-4458-bc86-9b26e3f22d9d" ParentLink="ServiceDeclaration_VariableDeclaration" LowerBound="11.1" HigherBound="12.1">
                <om:Property Name="InitialValue" Value="false" />
                <om:Property Name="UseDefaultConstructor" Value="False" />
                <om:Property Name="Type" Value="System.Boolean" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="IsBadOrder" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="ServiceBody" OID="00d1c3b8-2276-4476-b096-37b61de7695c" ParentLink="ServiceDeclaration_ServiceBody">
                <om:Property Name="Signal" Value="False" />
                <om:Element Type="VariableDeclaration" OID="38cabedc-45b0-4598-81af-f1835ce7c49d" ParentLink="ServiceBody_Declaration" LowerBound="12.15" HigherBound="12.40">
                    <om:Property Name="UseDefaultConstructor" Value="False" />
                    <om:Property Name="Type" Value="System.String" />
                    <om:Property Name="ParamDirection" Value="In" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="ErrorString" />
                    <om:Property Name="Signal" Value="True" />
                </om:Element>
                <om:Element Type="VariableDeclaration" OID="a8b827ad-4508-4052-afb4-447695776589" ParentLink="ServiceBody_Declaration" LowerBound="12.42" HigherBound="12.71">
                    <om:Property Name="UseDefaultConstructor" Value="True" />
                    <om:Property Name="Type" Value="System.Exception" />
                    <om:Property Name="ParamDirection" Value="In" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="ExceptionObj" />
                    <om:Property Name="Signal" Value="True" />
                </om:Element>
                <om:Element Type="VariableDeclaration" OID="8eb7c357-a4b6-4e18-97dd-9058b9f3934a" ParentLink="ServiceBody_Declaration" LowerBound="12.73" HigherBound="12.99">
                    <om:Property Name="UseDefaultConstructor" Value="True" />
                    <om:Property Name="Type" Value="System.Object" />
                    <om:Property Name="ParamDirection" Value="In" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="CalledObject" />
                    <om:Property Name="Signal" Value="True" />
                </om:Element>
                <om:Element Type="VariableDeclaration" OID="ac84226b-a6f9-4d14-a2e1-fa423f635312" ParentLink="ServiceBody_Declaration" LowerBound="12.101" HigherBound="12.125">
                    <om:Property Name="UseDefaultConstructor" Value="False" />
                    <om:Property Name="Type" Value="System.String" />
                    <om:Property Name="ParamDirection" Value="In" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="MethodName" />
                    <om:Property Name="Signal" Value="True" />
                </om:Element>
                <om:Element Type="VariableDeclaration" OID="7a0fbdee-bc78-41ed-a10c-06f5c618a0b3" ParentLink="ServiceBody_Declaration" LowerBound="12.127" HigherBound="12.154">
                    <om:Property Name="UseDefaultConstructor" Value="False" />
                    <om:Property Name="Type" Value="System.Array" />
                    <om:Property Name="ParamDirection" Value="In" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="ParameterArray" />
                    <om:Property Name="Signal" Value="True" />
                </om:Element>
                <om:Element Type="CorrelationDeclaration" OID="86f361b7-4730-4b34-9b7d-4f981c2123f3" ParentLink="ServiceBody_Declaration" LowerBound="12.156" HigherBound="12.205">
                    <om:Property Name="Type" Value="Microsoft.Samples.BizTalk.SouthridgeVideo.OrderManager.OrderCorrelationType" />
                    <om:Property Name="ParamDirection" Value="In" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="OrderCorrelation" />
                    <om:Property Name="Signal" Value="True" />
                </om:Element>
                <om:Element Type="MessageDeclaration" OID="a36b25ae-9adb-481f-ac09-613267a57f30" ParentLink="ServiceBody_Declaration" LowerBound="12.207" HigherBound="12.249">
                    <om:Property Name="Type" Value="System.Xml.XmlDocument" />
                    <om:Property Name="ParamDirection" Value="In" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="OriginalMsg" />
                    <om:Property Name="Signal" Value="True" />
                </om:Element>
                <om:Element Type="VariableDeclaration" OID="9cbee2c7-4b97-4643-a631-9f1ff857050c" ParentLink="ServiceBody_Declaration" LowerBound="12.251" HigherBound="12.280">
                    <om:Property Name="UseDefaultConstructor" Value="True" />
                    <om:Property Name="Type" Value="System.Object" />
                    <om:Property Name="ParamDirection" Value="Out" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="ReturnValue" />
                    <om:Property Name="Signal" Value="True" />
                </om:Element>
                <om:Element Type="VariableDeclaration" OID="007f635d-6e13-49a1-9696-445af4d20f6f" ParentLink="ServiceBody_Declaration" LowerBound="12.282" HigherBound="12.304">
                    <om:Property Name="UseDefaultConstructor" Value="False" />
                    <om:Property Name="Type" Value="System.Type" />
                    <om:Property Name="ParamDirection" Value="In" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="ObjectType" />
                    <om:Property Name="Signal" Value="True" />
                </om:Element>
                <om:Element Type="VariableDeclaration" OID="006a6eb7-51db-42b3-a951-90282184b666" ParentLink="ServiceBody_Declaration" LowerBound="12.306" HigherBound="12.381">
                    <om:Property Name="UseDefaultConstructor" Value="True" />
                    <om:Property Name="Type" Value="Microsoft.Samples.BizTalk.SouthridgeVideo.SchemaClasses.Routing" />
                    <om:Property Name="ParamDirection" Value="In" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="RoutingInfo" />
                    <om:Property Name="Signal" Value="True" />
                </om:Element>
                <om:Element Type="VariableAssignment" OID="512790f7-35ac-4b24-96f4-9c6d6f484b9a" ParentLink="ServiceBody_Statement" LowerBound="19.1" HigherBound="21.1">
                    <om:Property Name="Expression" Value="ReturnValue = null;" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="Init Variables" />
                    <om:Property Name="Signal" Value="False" />
                </om:Element>
                <om:Element Type="While" OID="4faea709-f9fe-404a-a8b5-58361d07bcc8" ParentLink="ServiceBody_Statement" LowerBound="21.1" HigherBound="115.1">
                    <om:Property Name="Expression" Value="!IsDone" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="While Not Done" />
                    <om:Property Name="Signal" Value="True" />
                    <om:Element Type="VariableAssignment" OID="ee343680-d823-4b9c-8a4f-27adcc0ce1e5" ParentLink="ComplexStatement_Statement" LowerBound="24.1" HigherBound="26.1">
                        <om:Property Name="Expression" Value="Microsoft.Samples.BizTalk.SouthridgeVideo.Utilities.ErrorHandler.PostError(ErrorString + &quot;: &quot; + ExceptionObj.ToString());" />
                        <om:Property Name="ReportToAnalyst" Value="True" />
                        <om:Property Name="Name" Value="Log Event" />
                        <om:Property Name="Signal" Value="False" />
                    </om:Element>
                    <om:Element Type="Decision" OID="ef9ef22a-0f72-4927-a449-32200020310c" ParentLink="ComplexStatement_Statement" LowerBound="26.1" HigherBound="114.1">
                        <om:Property Name="ReportToAnalyst" Value="True" />
                        <om:Property Name="Name" Value="Error Type" />
                        <om:Property Name="Signal" Value="True" />
                        <om:Element Type="DecisionBranch" OID="09355b26-9a4a-4c82-8094-f884ef7dd4b3" ParentLink="ReallyComplexStatement_Branch" LowerBound="27.17" HigherBound="86.1">
                            <om:Property Name="Expression" Value="!Microsoft.Samples.BizTalk.SouthridgeVideo.Utilities.Recaller.IsApplicationException( ExceptionObj )" />
                            <om:Property Name="IsGhostBranch" Value="True" />
                            <om:Property Name="ReportToAnalyst" Value="True" />
                            <om:Property Name="Name" Value="System Error" />
                            <om:Property Name="Signal" Value="False" />
                            <om:Element Type="VariableAssignment" OID="c711cf88-1bdf-42f8-8760-1c036dc686c2" ParentLink="ComplexStatement_Statement" LowerBound="29.1" HigherBound="32.1">
                                <om:Property Name="Expression" Value="RetryCounter = 3;&#xD;&#xA;IsApplicationException = false;" />
                                <om:Property Name="ReportToAnalyst" Value="True" />
                                <om:Property Name="Name" Value="Init Loop" />
                                <om:Property Name="Signal" Value="False" />
                            </om:Element>
                            <om:Element Type="While" OID="41f5beb5-efeb-4e4d-9f5d-5600994c23fa" ParentLink="ComplexStatement_Statement" LowerBound="32.1" HigherBound="77.1">
                                <om:Property Name="Expression" Value="RetryCounter &gt; 0  &amp;&amp; !IsApplicationException  &amp;&amp; !IsDone" />
                                <om:Property Name="ReportToAnalyst" Value="True" />
                                <om:Property Name="Name" Value="Try 3 times" />
                                <om:Property Name="Signal" Value="True" />
                                <om:Element Type="Call" OID="30a87e81-8a4d-44ca-8e35-afe834dd2a84" ParentLink="ComplexStatement_Statement" LowerBound="35.1" HigherBound="37.1">
                                    <om:Property Name="Identifier" Value="CallCheckInterrupt" />
                                    <om:Property Name="Invokee" Value="Microsoft.Samples.BizTalk.SouthridgeVideo.OrderManager.CheckInterruptOrch" />
                                    <om:Property Name="ReportToAnalyst" Value="True" />
                                    <om:Property Name="Name" Value="Check Interrupt" />
                                    <om:Property Name="Signal" Value="True" />
                                    <om:Element Type="Parameter" OID="356da91b-0cb5-4bbf-8132-b9670748e250" ParentLink="InvokeStatement_Parameter">
                                        <om:Property Name="Direction" Value="In" />
                                        <om:Property Name="Name" Value="OrderCorrelation" />
                                        <om:Property Name="Type" Value="Microsoft.Samples.BizTalk.SouthridgeVideo.OrderManager.OrderCorrelationType" />
                                        <om:Property Name="Signal" Value="False" />
                                    </om:Element>
                                </om:Element>
                                <om:Element Type="Delay" OID="3392252b-c62e-4352-bd27-3d34cb1feb86" ParentLink="ComplexStatement_Statement" LowerBound="37.1" HigherBound="39.1">
                                    <om:Property Name="Timeout" Value="new System.TimeSpan(0,1,0);" />
                                    <om:Property Name="ReportToAnalyst" Value="True" />
                                    <om:Property Name="Name" Value="Delay 1 min" />
                                    <om:Property Name="Signal" Value="False" />
                                </om:Element>
                                <om:Element Type="Scope" OID="6951d61a-5aea-41d7-9645-26e1a86e291b" ParentLink="ComplexStatement_Statement" LowerBound="39.1" HigherBound="76.1">
                                    <om:Property Name="InitializedTransactionType" Value="True" />
                                    <om:Property Name="IsSynchronized" Value="False" />
                                    <om:Property Name="ReportToAnalyst" Value="True" />
                                    <om:Property Name="Name" Value="Calling Code Scope" />
                                    <om:Property Name="Signal" Value="True" />
                                    <om:Element Type="VariableAssignment" OID="b5bc8ffb-5679-4831-8c7b-1d995b853bdf" ParentLink="ComplexStatement_Statement" LowerBound="44.1" HigherBound="46.1">
                                        <om:Property Name="Expression" Value="ReturnValue = Microsoft.Samples.BizTalk.SouthridgeVideo.Utilities.Recaller.Invoke(ObjectType, CalledObject, MethodName, ParameterArray);" />
                                        <om:Property Name="ReportToAnalyst" Value="True" />
                                        <om:Property Name="Name" Value="Call Original Code" />
                                        <om:Property Name="Signal" Value="False" />
                                    </om:Element>
                                    <om:Element Type="VariableAssignment" OID="53b48f38-eaa0-400f-aa29-a9298ab7c40e" ParentLink="ComplexStatement_Statement" LowerBound="46.1" HigherBound="48.1">
                                        <om:Property Name="Expression" Value="IsDone = true;" />
                                        <om:Property Name="ReportToAnalyst" Value="True" />
                                        <om:Property Name="Name" Value="Done" />
                                        <om:Property Name="Signal" Value="False" />
                                    </om:Element>
                                    <om:Element Type="Catch" OID="d973cf99-5ae8-4a6e-9ba2-087f3bf7b9b7" ParentLink="Scope_Catch" LowerBound="51.1" HigherBound="74.1">
                                        <om:Property Name="ExceptionName" Value="SysPathEx" />
                                        <om:Property Name="ExceptionType" Value="System.Exception" />
                                        <om:Property Name="IsFaultMessage" Value="False" />
                                        <om:Property Name="ReportToAnalyst" Value="True" />
                                        <om:Property Name="Name" Value="Catch Exception" />
                                        <om:Property Name="Signal" Value="True" />
                                        <om:Element Type="VariableAssignment" OID="944edbef-95f4-4531-84c1-8f321822c6e2" ParentLink="Catch_Statement" LowerBound="54.1" HigherBound="57.1">
                                            <om:Property Name="Expression" Value="ExceptionObj = SysPathEx;&#xD;&#xA;IsApplicationException = Microsoft.Samples.BizTalk.SouthridgeVideo.Utilities.Recaller.IsApplicationException( SysPathEx );" />
                                            <om:Property Name="ReportToAnalyst" Value="True" />
                                            <om:Property Name="Name" Value="Get Exception" />
                                            <om:Property Name="Signal" Value="True" />
                                        </om:Element>
                                        <om:Element Type="VariableAssignment" OID="ba5cbfdf-a275-435c-b951-ead52b574d9a" ParentLink="Catch_Statement" LowerBound="57.1" HigherBound="59.1">
                                            <om:Property Name="Expression" Value="Microsoft.Samples.BizTalk.SouthridgeVideo.Utilities.ErrorHandler.PostError(SysPathEx.ToString());" />
                                            <om:Property Name="ReportToAnalyst" Value="True" />
                                            <om:Property Name="Name" Value="Log Event" />
                                            <om:Property Name="Signal" Value="True" />
                                        </om:Element>
                                        <om:Element Type="Decision" OID="d7a45aeb-fa36-4789-93ff-be9d8c1981b1" ParentLink="Catch_Statement" LowerBound="59.1" HigherBound="73.1">
                                            <om:Property Name="ReportToAnalyst" Value="True" />
                                            <om:Property Name="Name" Value="Exception Type" />
                                            <om:Property Name="Signal" Value="True" />
                                            <om:Element Type="DecisionBranch" OID="5121490a-6755-46ae-9832-2a8e5e2aac70" ParentLink="ReallyComplexStatement_Branch" LowerBound="60.37" HigherBound="66.1">
                                                <om:Property Name="Expression" Value="!IsApplicationException" />
                                                <om:Property Name="IsGhostBranch" Value="True" />
                                                <om:Property Name="ReportToAnalyst" Value="True" />
                                                <om:Property Name="Name" Value="System" />
                                                <om:Property Name="Signal" Value="False" />
                                                <om:Element Type="VariableAssignment" OID="3ea2db7b-9bdc-47d8-beab-fd6b2bb3bea0" ParentLink="ComplexStatement_Statement" LowerBound="62.1" HigherBound="65.1">
                                                    <om:Property Name="Expression" Value="RetryCounter = RetryCounter - 1;&#xD;&#xA;IsDone = false;" />
                                                    <om:Property Name="ReportToAnalyst" Value="True" />
                                                    <om:Property Name="Name" Value="Decr Retries" />
                                                    <om:Property Name="Signal" Value="True" />
                                                </om:Element>
                                            </om:Element>
                                            <om:Element Type="DecisionBranch" OID="26d5b0e9-342b-4b9f-8888-f4c8e9e7bfba" ParentLink="ReallyComplexStatement_Branch">
                                                <om:Property Name="IsGhostBranch" Value="True" />
                                                <om:Property Name="ReportToAnalyst" Value="True" />
                                                <om:Property Name="Name" Value="Else" />
                                                <om:Property Name="Signal" Value="False" />
                                                <om:Element Type="VariableAssignment" OID="1c9d37ff-696a-4a57-b37b-5bdd4a0f5213" ParentLink="ComplexStatement_Statement" LowerBound="68.1" HigherBound="72.1">
                                                    <om:Property Name="Expression" Value="IsApplicationException = true;&#xD;&#xA;IsDone = false;&#xD;&#xA;RetryCounter = 0;" />
                                                    <om:Property Name="ReportToAnalyst" Value="True" />
                                                    <om:Property Name="Name" Value="App Exception" />
                                                    <om:Property Name="Signal" Value="True" />
                                                </om:Element>
                                            </om:Element>
                                        </om:Element>
                                    </om:Element>
                                </om:Element>
                            </om:Element>
                            <om:Element Type="Decision" OID="8e10bedd-4891-4669-b713-15685af91dec" ParentLink="ComplexStatement_Statement" LowerBound="77.1" HigherBound="85.1">
                                <om:Property Name="ReportToAnalyst" Value="True" />
                                <om:Property Name="Name" Value="Failed Retries?" />
                                <om:Property Name="Signal" Value="True" />
                                <om:Element Type="DecisionBranch" OID="8e3a8ae0-f6cf-493b-9663-1ca657493cf8" ParentLink="ReallyComplexStatement_Branch" LowerBound="78.21" HigherBound="85.1">
                                    <om:Property Name="Expression" Value="RetryCounter == 0  &amp;&amp; !IsApplicationException  &amp;&amp; !IsDone" />
                                    <om:Property Name="IsGhostBranch" Value="True" />
                                    <om:Property Name="ReportToAnalyst" Value="True" />
                                    <om:Property Name="Name" Value="Failed" />
                                    <om:Property Name="Signal" Value="False" />
                                    <om:Element Type="VariableAssignment" OID="4fdc3a12-3046-4853-91b3-2475fe0d672e" ParentLink="ComplexStatement_Statement" LowerBound="80.1" HigherBound="82.1">
                                        <om:Property Name="Expression" Value="Reason = System.String.Concat( &quot;SystemException:&quot;, ErrorString );" />
                                        <om:Property Name="ReportToAnalyst" Value="True" />
                                        <om:Property Name="Name" Value="Construct Reason" />
                                        <om:Property Name="Signal" Value="True" />
                                    </om:Element>
                                    <om:Element Type="Call" OID="03ce168e-b4a9-4112-baf8-9a2e03f53f1b" ParentLink="ComplexStatement_Statement" LowerBound="82.1" HigherBound="84.1">
                                        <om:Property Name="Identifier" Value="CallOrchestration_1" />
                                        <om:Property Name="Invokee" Value="Microsoft.Samples.BizTalk.SouthridgeVideo.OrderManager.ErrorHandlerOrch" />
                                        <om:Property Name="ReportToAnalyst" Value="True" />
                                        <om:Property Name="Name" Value="Call Error Handler" />
                                        <om:Property Name="Signal" Value="False" />
                                        <om:Element Type="Parameter" OID="999ded53-1983-4091-a334-7d9ffeb92083" ParentLink="InvokeStatement_Parameter">
                                            <om:Property Name="Direction" Value="In" />
                                            <om:Property Name="Name" Value="OriginalMsg" />
                                            <om:Property Name="Type" Value="System.Xml.XmlDocument" />
                                            <om:Property Name="Signal" Value="False" />
                                        </om:Element>
                                        <om:Element Type="Parameter" OID="4406c62d-06be-44be-a3d9-f724a7c212f5" ParentLink="InvokeStatement_Parameter">
                                            <om:Property Name="Direction" Value="In" />
                                            <om:Property Name="Name" Value="Reason" />
                                            <om:Property Name="Type" Value="System.String" />
                                            <om:Property Name="Signal" Value="False" />
                                        </om:Element>
                                        <om:Element Type="Parameter" OID="71825ca9-7bf3-4e9b-a88c-c5d028d88f2f" ParentLink="InvokeStatement_Parameter">
                                            <om:Property Name="Direction" Value="Out" />
                                            <om:Property Name="Name" Value="OriginalMsg" />
                                            <om:Property Name="Type" Value="System.Xml.XmlDocument" />
                                            <om:Property Name="Signal" Value="False" />
                                        </om:Element>
                                        <om:Element Type="Parameter" OID="d7fdda5e-829c-4006-92eb-fff383877e87" ParentLink="InvokeStatement_Parameter">
                                            <om:Property Name="Direction" Value="In" />
                                            <om:Property Name="Name" Value="IsBadOrder" />
                                            <om:Property Name="Type" Value="System.Boolean" />
                                            <om:Property Name="Signal" Value="False" />
                                        </om:Element>
                                        <om:Element Type="Parameter" OID="17fe57df-fb7c-4886-8e15-817fadcc8e63" ParentLink="InvokeStatement_Parameter">
                                            <om:Property Name="Direction" Value="In" />
                                            <om:Property Name="Name" Value="RoutingInfo" />
                                            <om:Property Name="Type" Value="Microsoft.Samples.BizTalk.SouthridgeVideo.SchemaClasses.Routing" />
                                            <om:Property Name="Signal" Value="False" />
                                        </om:Element>
                                    </om:Element>
                                </om:Element>
                                <om:Element Type="DecisionBranch" OID="21fde9cb-7fec-42d0-9303-0a7601027d79" ParentLink="ReallyComplexStatement_Branch">
                                    <om:Property Name="IsGhostBranch" Value="True" />
                                    <om:Property Name="ReportToAnalyst" Value="True" />
                                    <om:Property Name="Name" Value="Else" />
                                    <om:Property Name="Signal" Value="False" />
                                </om:Element>
                            </om:Element>
                        </om:Element>
                        <om:Element Type="DecisionBranch" OID="8a9b11d6-012c-4172-937e-61bce5593b82" ParentLink="ReallyComplexStatement_Branch">
                            <om:Property Name="IsGhostBranch" Value="True" />
                            <om:Property Name="ReportToAnalyst" Value="True" />
                            <om:Property Name="Name" Value="Else" />
                            <om:Property Name="Signal" Value="False" />
                            <om:Element Type="VariableAssignment" OID="30345ce6-4e81-4562-a126-02c23979b20d" ParentLink="ComplexStatement_Statement" LowerBound="88.1" HigherBound="90.1">
                                <om:Property Name="Expression" Value="Reason = System.String.Concat( &quot;ApplicationException:&quot;, ErrorString );" />
                                <om:Property Name="ReportToAnalyst" Value="True" />
                                <om:Property Name="Name" Value="Construct Reason" />
                                <om:Property Name="Signal" Value="False" />
                            </om:Element>
                            <om:Element Type="Call" OID="8f326ad1-5659-4292-be09-5734e2e66f77" ParentLink="ComplexStatement_Statement" LowerBound="90.1" HigherBound="92.1">
                                <om:Property Name="Identifier" Value="CallBadOrder" />
                                <om:Property Name="Invokee" Value="Microsoft.Samples.BizTalk.SouthridgeVideo.OrderManager.ErrorHandlerOrch" />
                                <om:Property Name="ReportToAnalyst" Value="True" />
                                <om:Property Name="Name" Value="Call Error Handler" />
                                <om:Property Name="Signal" Value="False" />
                                <om:Element Type="Parameter" OID="c9e4d38e-9dfe-44b2-9849-776841aa4d81" ParentLink="InvokeStatement_Parameter">
                                    <om:Property Name="Direction" Value="In" />
                                    <om:Property Name="Name" Value="OriginalMsg" />
                                    <om:Property Name="Type" Value="System.Xml.XmlDocument" />
                                    <om:Property Name="Signal" Value="False" />
                                </om:Element>
                                <om:Element Type="Parameter" OID="e07c50bf-efaa-4773-82e1-d3ec046eac3b" ParentLink="InvokeStatement_Parameter">
                                    <om:Property Name="Direction" Value="In" />
                                    <om:Property Name="Name" Value="ErrorString" />
                                    <om:Property Name="Type" Value="System.String" />
                                    <om:Property Name="Signal" Value="False" />
                                </om:Element>
                                <om:Element Type="Parameter" OID="0469a69b-25ec-43ad-9dcf-a7ea36ab378d" ParentLink="InvokeStatement_Parameter">
                                    <om:Property Name="Direction" Value="Out" />
                                    <om:Property Name="Name" Value="OriginalMsg" />
                                    <om:Property Name="Type" Value="System.Xml.XmlDocument" />
                                    <om:Property Name="Signal" Value="False" />
                                </om:Element>
                                <om:Element Type="Parameter" OID="f2f982dc-afcd-4930-a339-6e7df50b8acf" ParentLink="InvokeStatement_Parameter">
                                    <om:Property Name="Direction" Value="In" />
                                    <om:Property Name="Name" Value="IsBadOrder" />
                                    <om:Property Name="Type" Value="System.Boolean" />
                                    <om:Property Name="Signal" Value="False" />
                                </om:Element>
                                <om:Element Type="Parameter" OID="b6627753-df50-48ed-8244-62014f177fd2" ParentLink="InvokeStatement_Parameter">
                                    <om:Property Name="Direction" Value="In" />
                                    <om:Property Name="Name" Value="RoutingInfo" />
                                    <om:Property Name="Type" Value="Microsoft.Samples.BizTalk.SouthridgeVideo.SchemaClasses.Routing" />
                                    <om:Property Name="Signal" Value="False" />
                                </om:Element>
                            </om:Element>
                            <om:Element Type="Scope" OID="9259cd70-af1b-47d1-8d5a-5cc8a49fe3b8" ParentLink="ComplexStatement_Statement" LowerBound="92.1" HigherBound="113.1">
                                <om:Property Name="InitializedTransactionType" Value="True" />
                                <om:Property Name="IsSynchronized" Value="False" />
                                <om:Property Name="ReportToAnalyst" Value="True" />
                                <om:Property Name="Name" Value="Calling Code Scope" />
                                <om:Property Name="Signal" Value="True" />
                                <om:Element Type="VariableAssignment" OID="b5a14381-ab29-45c7-bb00-fc0925460be5" ParentLink="ComplexStatement_Statement" LowerBound="97.1" HigherBound="99.1">
                                    <om:Property Name="Expression" Value="ReturnValue = Microsoft.Samples.BizTalk.SouthridgeVideo.Utilities.Recaller.Invoke(ObjectType, CalledObject, MethodName, ParameterArray);" />
                                    <om:Property Name="ReportToAnalyst" Value="True" />
                                    <om:Property Name="Name" Value="Call Original Code" />
                                    <om:Property Name="Signal" Value="False" />
                                </om:Element>
                                <om:Element Type="VariableAssignment" OID="cc836240-be3f-4e86-b3ce-a723d94b9ad9" ParentLink="ComplexStatement_Statement" LowerBound="99.1" HigherBound="101.1">
                                    <om:Property Name="Expression" Value="IsDone = true;" />
                                    <om:Property Name="ReportToAnalyst" Value="True" />
                                    <om:Property Name="Name" Value="Done" />
                                    <om:Property Name="Signal" Value="False" />
                                </om:Element>
                                <om:Element Type="Catch" OID="6d9ee996-b94a-4b0f-84dd-5cc9f3033ded" ParentLink="Scope_Catch" LowerBound="104.1" HigherBound="111.1">
                                    <om:Property Name="ExceptionName" Value="AppPathEx" />
                                    <om:Property Name="ExceptionType" Value="System.Exception" />
                                    <om:Property Name="IsFaultMessage" Value="False" />
                                    <om:Property Name="ReportToAnalyst" Value="True" />
                                    <om:Property Name="Name" Value="Catch Exception" />
                                    <om:Property Name="Signal" Value="True" />
                                    <om:Element Type="VariableAssignment" OID="ef6aee1a-e427-4127-ba6a-5fa6c5358680" ParentLink="Catch_Statement" LowerBound="107.1" HigherBound="110.1">
                                        <om:Property Name="Expression" Value="ExceptionObj = AppPathEx;&#xD;&#xA;IsDone = false;" />
                                        <om:Property Name="ReportToAnalyst" Value="True" />
                                        <om:Property Name="Name" Value="Not Done" />
                                        <om:Property Name="Signal" Value="True" />
                                    </om:Element>
                                </om:Element>
                            </om:Element>
                        </om:Element>
                    </om:Element>
                </om:Element>
            </om:Element>
        </om:Element>
    </om:Element>
    <om:Element Type="PrintElement" OID="17392131-e467-4a26-8058-1e80f61728f9">
        <om:Property Name="Bottom" Value="0" />
        <om:Property Name="FooterBottom" Value="0" />
        <om:Property Name="FooterCenter" Value="0" />
        <om:Property Name="FooterMargin" Value="0" />
        <om:Property Name="FooterTop" Value="0" />
        <om:Property Name="HeaderBottom" Value="0" />
        <om:Property Name="HeaderCenter" Value="3" />
        <om:Property Name="HeaderMargin" Value="0" />
        <om:Property Name="HeaderTop" Value="0" />
        <om:Property Name="Left" Value="0" />
        <om:Property Name="PagesAcross" Value="0" />
        <om:Property Name="PagesDown" Value="0" />
        <om:Property Name="Right" Value="0" />
        <om:Property Name="Scaling" Value="79" />
        <om:Property Name="Top" Value="0" />
        <om:Property Name="Orientation" Value="Portrait" />
        <om:Property Name="Signal" Value="False" />
    </om:Element>
</om:MetaModel>
#endif // __DESIGNER_DATA
[Microsoft.XLANGs.BaseTypes.BPELExportable(false)]
module Microsoft.Samples.BizTalk.SouthridgeVideo.OrderManager
{
    [Microsoft.XLANGs.BaseTypes.BPELExportable(false)]
    public service ExceptionHandlerOrch
    {
        System.Boolean IsDone;
        System.Int32 RetryCounter;
        System.String Reason;
        System.Boolean IsApplicationException;
        System.Boolean IsBadOrder;
        body (System.String ErrorString, System.Exception ExceptionObj, System.Object CalledObject, System.String MethodName, System.Array ParameterArray, correlation OrderCorrelationType OrderCorrelation, message System.Xml.XmlDocument OriginalMsg, out System.Object ReturnValue, System.Type ObjectType, Microsoft.Samples.BizTalk.SouthridgeVideo.SchemaClasses.Routing RoutingInfo)
        {
            IsDone = false;
            RetryCounter = 3;
            Reason = "";
            IsApplicationException = false;
            IsBadOrder = false;
            [Microsoft.XLANGs.BaseTypes.DesignerPosition("512790f7-35ac-4b24-96f4-9c6d6f484b9a")]
            ReturnValue = null;
            [Microsoft.XLANGs.BaseTypes.DesignerPosition("4faea709-f9fe-404a-a8b5-58361d07bcc8")]
            while (!IsDone)
            {
                [Microsoft.XLANGs.BaseTypes.DesignerPosition("ee343680-d823-4b9c-8a4f-27adcc0ce1e5")]
                Microsoft.Samples.BizTalk.SouthridgeVideo.Utilities.ErrorHandler.PostError(ErrorString + ": " + ExceptionObj.ToString());
                [Microsoft.XLANGs.BaseTypes.DesignerPosition("ef9ef22a-0f72-4927-a449-32200020310c")]
                if (!Microsoft.Samples.BizTalk.SouthridgeVideo.Utilities.Recaller.IsApplicationException( ExceptionObj ))
                {
                    [Microsoft.XLANGs.BaseTypes.DesignerPosition("c711cf88-1bdf-42f8-8760-1c036dc686c2")]
                    RetryCounter = 3;
                    IsApplicationException = false;
                    [Microsoft.XLANGs.BaseTypes.DesignerPosition("41f5beb5-efeb-4e4d-9f5d-5600994c23fa")]
                    while (RetryCounter > 0  && !IsApplicationException  && !IsDone)
                    {
                        [Microsoft.XLANGs.BaseTypes.DesignerPosition("30a87e81-8a4d-44ca-8e35-afe834dd2a84")]
                        call Microsoft.Samples.BizTalk.SouthridgeVideo.OrderManager.CheckInterruptOrch (OrderCorrelation);
                        [Microsoft.XLANGs.BaseTypes.DesignerPosition("3392252b-c62e-4352-bd27-3d34cb1feb86")]
                        delay new System.TimeSpan(0,1,0);
                        [Microsoft.XLANGs.BaseTypes.DesignerPosition("6951d61a-5aea-41d7-9645-26e1a86e291b")]
                        scope
                        {
                            body
                            {
                                [Microsoft.XLANGs.BaseTypes.DesignerPosition("b5bc8ffb-5679-4831-8c7b-1d995b853bdf")]
                                ReturnValue = Microsoft.Samples.BizTalk.SouthridgeVideo.Utilities.Recaller.Invoke(ObjectType, CalledObject, MethodName, ParameterArray);
                                [Microsoft.XLANGs.BaseTypes.DesignerPosition("53b48f38-eaa0-400f-aa29-a9298ab7c40e")]
                                IsDone = true;
                            }
                            exceptions
                            {
                                [Microsoft.XLANGs.BaseTypes.DesignerPosition("d973cf99-5ae8-4a6e-9ba2-087f3bf7b9b7")]
                                catch (System.Exception SysPathEx)
                                {
                                    [Microsoft.XLANGs.BaseTypes.DesignerPosition("944edbef-95f4-4531-84c1-8f321822c6e2")]
                                    ExceptionObj = SysPathEx;
                                    IsApplicationException = Microsoft.Samples.BizTalk.SouthridgeVideo.Utilities.Recaller.IsApplicationException( SysPathEx );
                                    [Microsoft.XLANGs.BaseTypes.DesignerPosition("ba5cbfdf-a275-435c-b951-ead52b574d9a")]
                                    Microsoft.Samples.BizTalk.SouthridgeVideo.Utilities.ErrorHandler.PostError(SysPathEx.ToString());
                                    [Microsoft.XLANGs.BaseTypes.DesignerPosition("d7a45aeb-fa36-4789-93ff-be9d8c1981b1")]
                                    if (!IsApplicationException)
                                    {
                                        [Microsoft.XLANGs.BaseTypes.DesignerPosition("3ea2db7b-9bdc-47d8-beab-fd6b2bb3bea0")]
                                        RetryCounter = RetryCounter - 1;
                                        IsDone = false;
                                    }
                                    else 
                                    {
                                        [Microsoft.XLANGs.BaseTypes.DesignerPosition("1c9d37ff-696a-4a57-b37b-5bdd4a0f5213")]
                                        IsApplicationException = true;
                                        IsDone = false;
                                        RetryCounter = 0;
                                    }
                                }
                            }
                        }
                    }
                    [Microsoft.XLANGs.BaseTypes.DesignerPosition("8e10bedd-4891-4669-b713-15685af91dec")]
                    if (RetryCounter == 0  && !IsApplicationException  && !IsDone)
                    {
                        [Microsoft.XLANGs.BaseTypes.DesignerPosition("4fdc3a12-3046-4853-91b3-2475fe0d672e")]
                        Reason = System.String.Concat( "SystemException:", ErrorString );
                        [Microsoft.XLANGs.BaseTypes.DesignerPosition("03ce168e-b4a9-4112-baf8-9a2e03f53f1b")]
                        call Microsoft.Samples.BizTalk.SouthridgeVideo.OrderManager.ErrorHandlerOrch (OriginalMsg, Reason, out OriginalMsg, IsBadOrder, RoutingInfo);
                    }
                }
                else 
                {
                    [Microsoft.XLANGs.BaseTypes.DesignerPosition("30345ce6-4e81-4562-a126-02c23979b20d")]
                    Reason = System.String.Concat( "ApplicationException:", ErrorString );
                    [Microsoft.XLANGs.BaseTypes.DesignerPosition("8f326ad1-5659-4292-be09-5734e2e66f77")]
                    call Microsoft.Samples.BizTalk.SouthridgeVideo.OrderManager.ErrorHandlerOrch (OriginalMsg, ErrorString, out OriginalMsg, IsBadOrder, RoutingInfo);
                    [Microsoft.XLANGs.BaseTypes.DesignerPosition("9259cd70-af1b-47d1-8d5a-5cc8a49fe3b8")]
                    scope
                    {
                        body
                        {
                            [Microsoft.XLANGs.BaseTypes.DesignerPosition("b5a14381-ab29-45c7-bb00-fc0925460be5")]
                            ReturnValue = Microsoft.Samples.BizTalk.SouthridgeVideo.Utilities.Recaller.Invoke(ObjectType, CalledObject, MethodName, ParameterArray);
                            [Microsoft.XLANGs.BaseTypes.DesignerPosition("cc836240-be3f-4e86-b3ce-a723d94b9ad9")]
                            IsDone = true;
                        }
                        exceptions
                        {
                            [Microsoft.XLANGs.BaseTypes.DesignerPosition("6d9ee996-b94a-4b0f-84dd-5cc9f3033ded")]
                            catch (System.Exception AppPathEx)
                            {
                                [Microsoft.XLANGs.BaseTypes.DesignerPosition("ef6aee1a-e427-4127-ba6a-5fa6c5358680")]
                                ExceptionObj = AppPathEx;
                                IsDone = false;
                            }
                        }
                    }
                }
            }
        }
    }
}

