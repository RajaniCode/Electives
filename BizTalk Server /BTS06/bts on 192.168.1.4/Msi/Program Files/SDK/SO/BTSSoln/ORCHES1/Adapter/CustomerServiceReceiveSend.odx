#if __DESIGNER_DATA
#error Do not define __DESIGNER_DATA.
<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<om:MetaModel MajorVersion="1" MinorVersion="3" Core="2b131234-7959-458d-834f-2dc0769ce683" ScheduleModel="66366196-361d-448d-976f-cab5e87496d2" xmlns:om="http://schemas.microsoft.com/BizTalk/2003/DesignerData">
    <om:Element Type="Module" OID="69aa21df-b2fb-4494-82c6-1cc24f2e460c" LowerBound="1.1" HigherBound="77.1">
        <om:Property Name="ReportToAnalyst" Value="True" />
        <om:Property Name="Name" Value="Microsoft.Samples.BizTalk.WoodgroveBank.Orchestrations.Adapter" />
        <om:Property Name="Signal" Value="False" />
        <om:Element Type="PortType" OID="5b8552d6-f2e6-4f25-a59e-25de9080b472" ParentLink="Module_PortType" LowerBound="4.1" HigherBound="11.1">
            <om:Property Name="Synchronous" Value="False" />
            <om:Property Name="TypeModifier" Value="Internal" />
            <om:Property Name="ReportToAnalyst" Value="True" />
            <om:Property Name="Name" Value="RequestInputPortType" />
            <om:Property Name="Signal" Value="False" />
            <om:Element Type="OperationDeclaration" OID="0ff7b0c0-0fe0-40ce-8639-c487d9e173a2" ParentLink="PortType_OperationDeclaration" LowerBound="6.1" HigherBound="10.1">
                <om:Property Name="OperationType" Value="OneWay" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="ReceiveRequest" />
                <om:Property Name="Signal" Value="True" />
                <om:Element Type="MessageRef" OID="d0d46712-bf46-4661-8226-1d2139f9dbee" ParentLink="OperationDeclaration_RequestMessageRef" LowerBound="8.13" HigherBound="8.83">
                    <om:Property Name="Ref" Value="Microsoft.Samples.BizTalk.WoodgroveBank.Schemas.CustomerServiceRequest" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="Request" />
                    <om:Property Name="Signal" Value="True" />
                </om:Element>
            </om:Element>
        </om:Element>
        <om:Element Type="PortType" OID="64ba87a2-f31b-4543-8e41-be0259beccde" ParentLink="Module_PortType" LowerBound="11.1" HigherBound="18.1">
            <om:Property Name="Synchronous" Value="False" />
            <om:Property Name="TypeModifier" Value="Internal" />
            <om:Property Name="ReportToAnalyst" Value="True" />
            <om:Property Name="Name" Value="ResponseOutputPortType" />
            <om:Property Name="Signal" Value="False" />
            <om:Element Type="OperationDeclaration" OID="73fde4a0-ca64-4fc7-bd47-3d657de278fd" ParentLink="PortType_OperationDeclaration" LowerBound="13.1" HigherBound="17.1">
                <om:Property Name="OperationType" Value="OneWay" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="SendResponse" />
                <om:Property Name="Signal" Value="True" />
                <om:Element Type="MessageRef" OID="b944ef72-bd25-4055-ad5f-6d2193c9b7f4" ParentLink="OperationDeclaration_RequestMessageRef" LowerBound="15.13" HigherBound="15.84">
                    <om:Property Name="Ref" Value="Microsoft.Samples.BizTalk.WoodgroveBank.Schemas.CustomerServiceResponse" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="Request" />
                    <om:Property Name="Signal" Value="False" />
                </om:Element>
            </om:Element>
        </om:Element>
        <om:Element Type="ServiceDeclaration" OID="6672b752-4463-42c2-ac3e-8c9dc1b1e332" ParentLink="Module_ServiceDeclaration" LowerBound="18.1" HigherBound="76.1">
            <om:Property Name="InitializedTransactionType" Value="True" />
            <om:Property Name="IsInvokable" Value="False" />
            <om:Property Name="TypeModifier" Value="Internal" />
            <om:Property Name="ReportToAnalyst" Value="True" />
            <om:Property Name="AnalystComments" Value="// Microsoft.Samples.BizTalk.WoodgroveBank.Orchestrations.Adapter.CustomerServiceReceiveSend&#xD;&#xA;// Orchestration to accept requests via a non-request-response port.&#xD;&#xA;//&#xD;&#xA;// Copyright (c) Microsoft Corporation. All rights reserved.&#xD;&#xA;// THIS CODE AND INFORMATION ARE PROVIDED &quot;AS IS&quot; WITHOUT WARRANTY OF ANY KIND, &#xD;&#xA;// EITHER EXPRESSED OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE IMPLIED WARRANTIES &#xD;&#xA;// OF MERCHANTABILITY AND/OR FITNESS FOR A PARTICULAR PURPOSE." />
            <om:Property Name="Name" Value="CustomerServiceReceiveSend" />
            <om:Property Name="Signal" Value="True" />
            <om:Element Type="VariableDeclaration" OID="0bd1f59d-a0ee-4d12-b86c-4f8c1db1196f" ParentLink="ServiceDeclaration_VariableDeclaration" LowerBound="28.1" HigherBound="29.1">
                <om:Property Name="UseDefaultConstructor" Value="False" />
                <om:Property Name="Type" Value="System.String" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="transport" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="VariableDeclaration" OID="05a5377b-a72f-41cb-a28b-078dc6b1cd7d" ParentLink="ServiceDeclaration_VariableDeclaration" LowerBound="29.1" HigherBound="30.1">
                <om:Property Name="InitialValue" Value="true" />
                <om:Property Name="UseDefaultConstructor" Value="False" />
                <om:Property Name="Type" Value="System.Boolean" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="isMQSeries" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="LongRunningTransaction" OID="35541567-2b83-4779-bbd6-dfb295a176a2" ParentLink="ServiceDeclaration_Transaction" LowerBound="19.21" HigherBound="19.72">
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="CustomerServiceReceiveSendProcess" />
                <om:Property Name="Signal" Value="False" />
            </om:Element>
            <om:Element Type="MessageDeclaration" OID="41074a30-7d18-44c3-bc28-51d04a01b689" ParentLink="ServiceDeclaration_MessageDeclaration" LowerBound="25.1" HigherBound="26.1">
                <om:Property Name="Type" Value="Microsoft.Samples.BizTalk.WoodgroveBank.Schemas.CustomerServiceResponse" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="CustomerServiceResponse2" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="MessageDeclaration" OID="511eb993-4a0d-43cd-aba3-e918b6e8246d" ParentLink="ServiceDeclaration_MessageDeclaration" LowerBound="26.1" HigherBound="27.1">
                <om:Property Name="Type" Value="Microsoft.Samples.BizTalk.WoodgroveBank.Schemas.CustomerServiceResponse" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="CustomerServiceResponse" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="MessageDeclaration" OID="d0081e4b-0db9-487e-81bf-0aa0da2350ea" ParentLink="ServiceDeclaration_MessageDeclaration" LowerBound="27.1" HigherBound="28.1">
                <om:Property Name="Type" Value="Microsoft.Samples.BizTalk.WoodgroveBank.Schemas.CustomerServiceRequest" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="CustomerServiceRequest" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="ServiceBody" OID="d2ef7c58-1736-4124-9423-b82f77b7d731" ParentLink="ServiceDeclaration_ServiceBody">
                <om:Property Name="Signal" Value="False" />
                <om:Element Type="Receive" OID="0af240ab-8400-4a5f-bc2a-a1673f62971e" ParentLink="ServiceBody_Statement" LowerBound="32.1" HigherBound="36.1">
                    <om:Property Name="Activate" Value="True" />
                    <om:Property Name="PortName" Value="RequestInputPort" />
                    <om:Property Name="MessageName" Value="CustomerServiceRequest" />
                    <om:Property Name="OperationName" Value="ReceiveRequest" />
                    <om:Property Name="OperationMessageName" Value="Request" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="ReceiveCustomerServiceRequest" />
                    <om:Property Name="Signal" Value="True" />
                </om:Element>
                <om:Element Type="Call" OID="2d369573-e98c-46c1-9337-2ba96b03c23e" ParentLink="ServiceBody_Statement" LowerBound="36.1" HigherBound="38.1">
                    <om:Property Name="Identifier" Value="ProcessRequest" />
                    <om:Property Name="Invokee" Value="Microsoft.Samples.BizTalk.WoodgroveBank.Orchestrations.Adapter.CustomerService" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="ProcessRequest" />
                    <om:Property Name="Signal" Value="False" />
                    <om:Element Type="Parameter" OID="2a45577a-910f-4798-9b1f-1c021408720b" ParentLink="InvokeStatement_Parameter">
                        <om:Property Name="Direction" Value="In" />
                        <om:Property Name="Name" Value="CustomerServiceRequest" />
                        <om:Property Name="Type" Value="Microsoft.Samples.BizTalk.WoodgroveBank.Schemas.CustomerServiceRequest" />
                        <om:Property Name="Signal" Value="False" />
                    </om:Element>
                    <om:Element Type="Parameter" OID="ff491191-fa93-4379-a427-e9d4b36481b8" ParentLink="InvokeStatement_Parameter">
                        <om:Property Name="Direction" Value="Out" />
                        <om:Property Name="Name" Value="CustomerServiceResponse" />
                        <om:Property Name="Type" Value="Microsoft.Samples.BizTalk.WoodgroveBank.Schemas.CustomerServiceResponse" />
                        <om:Property Name="Signal" Value="False" />
                    </om:Element>
                </om:Element>
                <om:Element Type="VariableAssignment" OID="3b3a7326-dde5-47a3-bd7c-1e8a1a8c75ff" ParentLink="ServiceBody_Statement" LowerBound="38.1" HigherBound="46.1">
                    <om:Property Name="Expression" Value="// Identify if the incoming message is coming via the MQ Series transport&#xD;&#xA;&#xD;&#xA;transport = CustomerServiceRequest(BTS.InboundTransportType);&#xD;&#xA;&#xD;&#xA;isMQSeries = transport.IndexOf(&quot;MQS&quot;) != -1;&#xD;&#xA;&#xD;&#xA;//System.Diagnostics.Trace.Write(&quot;Transport = &quot; + transport);&#xD;&#xA;" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="IdentifyMQSeriesMessage" />
                    <om:Property Name="Signal" Value="False" />
                </om:Element>
                <om:Element Type="Decision" OID="bb4a50a4-108f-4d67-99a1-a541ef64c807" ParentLink="ServiceBody_Statement" LowerBound="46.1" HigherBound="72.1">
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="Decide_1" />
                    <om:Property Name="Signal" Value="False" />
                    <om:Element Type="DecisionBranch" OID="2650549f-44cd-40d1-8a68-0e92295430b2" ParentLink="ReallyComplexStatement_Branch" LowerBound="47.13" HigherBound="63.1">
                        <om:Property Name="Expression" Value="isMQSeries" />
                        <om:Property Name="IsGhostBranch" Value="True" />
                        <om:Property Name="ReportToAnalyst" Value="True" />
                        <om:Property Name="Name" Value="isMQSeriesMessage" />
                        <om:Property Name="Signal" Value="True" />
                        <om:Element Type="Construct" OID="4d43aa1f-7177-4581-ae0e-0a8a229b7518" ParentLink="ComplexStatement_Statement" LowerBound="49.1" HigherBound="62.1">
                            <om:Property Name="ReportToAnalyst" Value="True" />
                            <om:Property Name="Name" Value="ConstructCorrelatedResponse" />
                            <om:Property Name="Signal" Value="True" />
                            <om:Element Type="MessageRef" OID="d246a213-4bf8-4dcc-a89c-8967f6d00d08" ParentLink="Construct_MessageRef" LowerBound="50.27" HigherBound="50.51">
                                <om:Property Name="Ref" Value="CustomerServiceResponse2" />
                                <om:Property Name="ReportToAnalyst" Value="True" />
                                <om:Property Name="Signal" Value="False" />
                            </om:Element>
                            <om:Element Type="MessageAssignment" OID="bfc62fcf-d462-4159-a686-c2d26d8625d0" ParentLink="ComplexStatement_Statement" LowerBound="52.1" HigherBound="61.1">
                                <om:Property Name="Expression" Value="// For messages received via MQ Series transport, need to correlate the response to the request received&#xD;&#xA;// This is standard MQ Series practice&#xD;&#xA;&#xD;&#xA;CustomerServiceResponse2 = CustomerServiceResponse;&#xD;&#xA;CustomerServiceResponse2(MQSeries.MQMD_CorrelId) = CustomerServiceRequest (MQSeries.MQMD_MsgId);&#xD;&#xA;&#xD;&#xA;//System.Diagnostics.Trace.Write(&quot;Request Messge ID = &quot; + CustomerServiceRequest (MQSeries.MQMD_MsgId));&#xD;&#xA;//System.Diagnostics.Trace.Write(&quot;Response Correlation = &quot; + CustomerServiceResponse2(MQSeries.MQMD_CorrelId));" />
                                <om:Property Name="ReportToAnalyst" Value="False" />
                                <om:Property Name="Name" Value="CreateCorrelatedResponseMessage" />
                                <om:Property Name="Signal" Value="True" />
                            </om:Element>
                        </om:Element>
                    </om:Element>
                    <om:Element Type="DecisionBranch" OID="7b60ec8e-709b-4b68-86ca-9c9a036ba9b6" ParentLink="ReallyComplexStatement_Branch">
                        <om:Property Name="IsGhostBranch" Value="True" />
                        <om:Property Name="ReportToAnalyst" Value="True" />
                        <om:Property Name="Name" Value="Else" />
                        <om:Property Name="Signal" Value="False" />
                        <om:Element Type="Construct" OID="d06d63d8-2283-41ef-8e92-0edf80d129a6" ParentLink="ComplexStatement_Statement" LowerBound="65.1" HigherBound="71.1">
                            <om:Property Name="ReportToAnalyst" Value="True" />
                            <om:Property Name="Name" Value="ConstructCopiedResponse" />
                            <om:Property Name="Signal" Value="True" />
                            <om:Element Type="MessageRef" OID="f5685d0d-2bee-4762-ac60-276758d8a5ea" ParentLink="Construct_MessageRef" LowerBound="66.27" HigherBound="66.51">
                                <om:Property Name="Ref" Value="CustomerServiceResponse2" />
                                <om:Property Name="ReportToAnalyst" Value="True" />
                                <om:Property Name="Signal" Value="False" />
                            </om:Element>
                            <om:Element Type="MessageAssignment" OID="e59b75d5-0a91-4b42-bcde-3ac617c0f447" ParentLink="ComplexStatement_Statement" LowerBound="68.1" HigherBound="70.1">
                                <om:Property Name="Expression" Value="CustomerServiceResponse2 = CustomerServiceResponse;" />
                                <om:Property Name="ReportToAnalyst" Value="False" />
                                <om:Property Name="Name" Value="CreateCopiedResponseMessage" />
                                <om:Property Name="Signal" Value="True" />
                            </om:Element>
                        </om:Element>
                    </om:Element>
                </om:Element>
                <om:Element Type="Send" OID="20cfe1ff-11d8-4c4d-b990-8105e35bd6c3" ParentLink="ServiceBody_Statement" LowerBound="72.1" HigherBound="74.1">
                    <om:Property Name="PortName" Value="ResponseOutputPort" />
                    <om:Property Name="MessageName" Value="CustomerServiceResponse2" />
                    <om:Property Name="OperationName" Value="SendResponse" />
                    <om:Property Name="OperationMessageName" Value="Request" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="SendCustomerServiceResponse" />
                    <om:Property Name="Signal" Value="True" />
                </om:Element>
            </om:Element>
            <om:Element Type="PortDeclaration" OID="10f06118-ea80-4db0-b006-3ed8ff052090" ParentLink="ServiceDeclaration_PortDeclaration" LowerBound="21.1" HigherBound="23.1">
                <om:Property Name="PortModifier" Value="Implements" />
                <om:Property Name="Orientation" Value="Left" />
                <om:Property Name="PortIndex" Value="-1" />
                <om:Property Name="IsWebPort" Value="False" />
                <om:Property Name="OrderedDelivery" Value="False" />
                <om:Property Name="DeliveryNotification" Value="None" />
                <om:Property Name="Type" Value="Microsoft.Samples.BizTalk.WoodgroveBank.Orchestrations.Adapter.RequestInputPortType" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="RequestInputPort" />
                <om:Property Name="Signal" Value="False" />
                <om:Element Type="LogicalBindingAttribute" OID="1c3b1bf8-8e9b-4cb6-9f0d-a51f2c0e6327" ParentLink="PortDeclaration_CLRAttribute" LowerBound="21.1" HigherBound="22.1">
                    <om:Property Name="Signal" Value="False" />
                </om:Element>
            </om:Element>
            <om:Element Type="PortDeclaration" OID="86131f51-14e8-4f26-b27e-490fbad79edc" ParentLink="ServiceDeclaration_PortDeclaration" LowerBound="23.1" HigherBound="25.1">
                <om:Property Name="PortModifier" Value="Uses" />
                <om:Property Name="Orientation" Value="Right" />
                <om:Property Name="PortIndex" Value="-1" />
                <om:Property Name="IsWebPort" Value="False" />
                <om:Property Name="OrderedDelivery" Value="False" />
                <om:Property Name="DeliveryNotification" Value="None" />
                <om:Property Name="Type" Value="Microsoft.Samples.BizTalk.WoodgroveBank.Orchestrations.Adapter.ResponseOutputPortType" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="ResponseOutputPort" />
                <om:Property Name="Signal" Value="False" />
                <om:Element Type="LogicalBindingAttribute" OID="919b2dbd-5213-4541-be43-05a2796d7095" ParentLink="PortDeclaration_CLRAttribute" LowerBound="23.1" HigherBound="24.1">
                    <om:Property Name="Signal" Value="False" />
                </om:Element>
            </om:Element>
        </om:Element>
    </om:Element>
</om:MetaModel>
#endif // __DESIGNER_DATA
[Microsoft.XLANGs.BaseTypes.BPELExportable(false)]
module Microsoft.Samples.BizTalk.WoodgroveBank.Orchestrations.Adapter
{
    internal porttype RequestInputPortType
    {
        oneway ReceiveRequest
        {
            Microsoft.Samples.BizTalk.WoodgroveBank.Schemas.CustomerServiceRequest
        };
    };
    internal porttype ResponseOutputPortType
    {
        oneway SendResponse
        {
            Microsoft.Samples.BizTalk.WoodgroveBank.Schemas.CustomerServiceResponse
        };
    };
    [Microsoft.XLANGs.BaseTypes.BPELExportable(false)]
    internal service longrunning transaction CustomerServiceReceiveSend
    {
        [Microsoft.XLANGs.BaseTypes.LogicalBinding()]
        port implements RequestInputPortType RequestInputPort;
        [Microsoft.XLANGs.BaseTypes.LogicalBinding()]
        port uses ResponseOutputPortType ResponseOutputPort;
        message Microsoft.Samples.BizTalk.WoodgroveBank.Schemas.CustomerServiceResponse CustomerServiceResponse2;
        message Microsoft.Samples.BizTalk.WoodgroveBank.Schemas.CustomerServiceResponse CustomerServiceResponse;
        message Microsoft.Samples.BizTalk.WoodgroveBank.Schemas.CustomerServiceRequest CustomerServiceRequest;
        System.String transport;
        System.Boolean isMQSeries;
        body ()
        {
            [Microsoft.XLANGs.BaseTypes.DesignerPosition("0af240ab-8400-4a5f-bc2a-a1673f62971e")]
            activate receive (RequestInputPort.ReceiveRequest, CustomerServiceRequest);
            transport = "";
            isMQSeries = true;
            [Microsoft.XLANGs.BaseTypes.DesignerPosition("2d369573-e98c-46c1-9337-2ba96b03c23e")]
            call Microsoft.Samples.BizTalk.WoodgroveBank.Orchestrations.Adapter.CustomerService (CustomerServiceRequest, out CustomerServiceResponse) ProcessRequest;
            [Microsoft.XLANGs.BaseTypes.DesignerPosition("3b3a7326-dde5-47a3-bd7c-1e8a1a8c75ff")]
            // Identify if the incoming message is coming via the MQ Series transport
            
            transport = CustomerServiceRequest(BTS.InboundTransportType);
            
            isMQSeries = transport.IndexOf("MQS") != -1;
            
            //System.Diagnostics.Trace.Write("Transport = " + transport);
            [Microsoft.XLANGs.BaseTypes.DesignerPosition("bb4a50a4-108f-4d67-99a1-a541ef64c807")]
            if (isMQSeries)
            {
                [Microsoft.XLANGs.BaseTypes.DesignerPosition("4d43aa1f-7177-4581-ae0e-0a8a229b7518")]
                construct CustomerServiceResponse2
                {
                    [Microsoft.XLANGs.BaseTypes.DesignerPosition("bfc62fcf-d462-4159-a686-c2d26d8625d0")]
                    // For messages received via MQ Series transport, need to correlate the response to the request received
                    // This is standard MQ Series practice
                    
                    CustomerServiceResponse2 = CustomerServiceResponse;
                    CustomerServiceResponse2(MQSeries.MQMD_CorrelId) = CustomerServiceRequest (MQSeries.MQMD_MsgId);
                    
                    //System.Diagnostics.Trace.Write("Request Messge ID = " + CustomerServiceRequest (MQSeries.MQMD_MsgId));
                    //System.Diagnostics.Trace.Write("Response Correlation = " + CustomerServiceResponse2(MQSeries.MQMD_CorrelId));
                }
            }
            else 
            {
                [Microsoft.XLANGs.BaseTypes.DesignerPosition("d06d63d8-2283-41ef-8e92-0edf80d129a6")]
                construct CustomerServiceResponse2
                {
                    [Microsoft.XLANGs.BaseTypes.DesignerPosition("e59b75d5-0a91-4b42-bcde-3ac617c0f447")]
                    CustomerServiceResponse2 = CustomerServiceResponse;
                }
            }
            [Microsoft.XLANGs.BaseTypes.DesignerPosition("20cfe1ff-11d8-4c4d-b990-8105e35bd6c3")]
            send (ResponseOutputPort.SendResponse, CustomerServiceResponse2);
        }
    }
}

