#if __DESIGNER_DATA
#error Do not define __DESIGNER_DATA.
<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<om:MetaModel MajorVersion="1" MinorVersion="3" Core="2b131234-7959-458d-834f-2dc0769ce683" ScheduleModel="66366196-361d-448d-976f-cab5e87496d2" xmlns:om="http://schemas.microsoft.com/BizTalk/2003/DesignerData">
    <om:Element Type="Module" OID="8a4dbec7-6456-4c95-a9b4-2f07c488d527" LowerBound="1.1" HigherBound="116.1">
        <om:Property Name="ReportToAnalyst" Value="True" />
        <om:Property Name="Name" Value="Microsoft.Samples.BizTalk.Litware.Orchestrations" />
        <om:Property Name="Signal" Value="False" />
        <om:Element Type="ServiceDeclaration" OID="4171b0b4-17bf-4435-aac7-20d8ad807c80" ParentLink="Module_ServiceDeclaration" LowerBound="25.1" HigherBound="115.1">
            <om:Property Name="InitializedTransactionType" Value="False" />
            <om:Property Name="IsInvokable" Value="True" />
            <om:Property Name="TypeModifier" Value="Internal" />
            <om:Property Name="ReportToAnalyst" Value="True" />
            <om:Property Name="Name" Value="ConfirmOrderWithVendors" />
            <om:Property Name="Signal" Value="True" />
            <om:Element Type="VariableDeclaration" OID="1ce269d2-3bb1-4597-aa2e-4c864be4cdd2" ParentLink="ServiceDeclaration_VariableDeclaration" LowerBound="33.1" HigherBound="34.1">
                <om:Property Name="UseDefaultConstructor" Value="False" />
                <om:Property Name="Type" Value="System.Int32" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="orderCount" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="VariableDeclaration" OID="8d104908-1763-469d-9d9d-379c4c83b94b" ParentLink="ServiceDeclaration_VariableDeclaration" LowerBound="34.1" HigherBound="35.1">
                <om:Property Name="InitialValue" Value="1" />
                <om:Property Name="UseDefaultConstructor" Value="False" />
                <om:Property Name="Type" Value="System.Int32" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="ctr" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="VariableDeclaration" OID="b0085ac5-8fa1-4571-9af9-3e838b0898fd" ParentLink="ServiceDeclaration_VariableDeclaration" LowerBound="35.1" HigherBound="36.1">
                <om:Property Name="UseDefaultConstructor" Value="False" />
                <om:Property Name="Type" Value="System.String" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="thePath" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="VariableDeclaration" OID="d413679b-578b-4dcc-9d53-05bc12091fe4" ParentLink="ServiceDeclaration_VariableDeclaration" LowerBound="36.1" HigherBound="37.1">
                <om:Property Name="UseDefaultConstructor" Value="False" />
                <om:Property Name="Type" Value="System.String" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="vendorID" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="VariableDeclaration" OID="7b605d76-9993-4fe2-a93d-2bc9e66a4ce8" ParentLink="ServiceDeclaration_VariableDeclaration" LowerBound="37.1" HigherBound="38.1">
                <om:Property Name="InitialValue" Value="true" />
                <om:Property Name="UseDefaultConstructor" Value="False" />
                <om:Property Name="Type" Value="System.Boolean" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="callFailed" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="VariableDeclaration" OID="fb7b716f-d308-4298-bfad-447fc75d05b1" ParentLink="ServiceDeclaration_VariableDeclaration" LowerBound="38.1" HigherBound="39.1">
                <om:Property Name="InitialValue" Value="true" />
                <om:Property Name="UseDefaultConstructor" Value="False" />
                <om:Property Name="Type" Value="System.Boolean" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="sendFailed" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="VariableDeclaration" OID="6feb9fec-768d-4a2f-9b7f-67e9a73343b4" ParentLink="ServiceDeclaration_VariableDeclaration" LowerBound="39.1" HigherBound="40.1">
                <om:Property Name="UseDefaultConstructor" Value="False" />
                <om:Property Name="Type" Value="System.String" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="destination" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="ServiceLinkDeclaration" OID="95101ab1-46f7-4f43-9fd9-233bbcd53408" ParentLink="ServiceDeclaration_ServiceLinkDeclaration" LowerBound="28.1" HigherBound="29.1">
                <om:Property Name="Orientation" Value="Left" />
                <om:Property Name="PortIndex" Value="46" />
                <om:Property Name="PortModifier" Value="Uses" />
                <om:Property Name="RoleName" Value="ContactVendor_Role" />
                <om:Property Name="OrderedDelivery" Value="False" />
                <om:Property Name="DeliveryNotification" Value="None" />
                <om:Property Name="Type" Value="Microsoft.Samples.BizTalk.Litware.Orchestrations.VendorLinkType" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="ContactVendorRoleLink" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="MessageDeclaration" OID="f7072eac-a155-4b38-9649-c22653bd173c" ParentLink="ServiceDeclaration_MessageDeclaration" LowerBound="31.1" HigherBound="32.1">
                <om:Property Name="Type" Value="Microsoft.Samples.BizTalk.Litware.Schemas.Order.OrderForm" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="OrderFormMsg" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="MessageDeclaration" OID="42089625-4b98-44bd-89c4-6b97e20fa089" ParentLink="ServiceDeclaration_MessageDeclaration" LowerBound="32.1" HigherBound="33.1">
                <om:Property Name="Type" Value="Microsoft.Samples.BizTalk.Litware.Schemas.TPM.Partner.PartnerObject" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="ProfileMsg" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="ServiceBody" OID="096c84e2-3066-4782-bcdd-ba509b998e33" ParentLink="ServiceDeclaration_ServiceBody">
                <om:Property Name="Signal" Value="False" />
                <om:Element Type="MessageDeclaration" OID="d415860f-9fca-41b4-a6c8-4daf359dfdfb" ParentLink="ServiceBody_Declaration" LowerBound="40.15" HigherBound="40.97">
                    <om:Property Name="Type" Value="Microsoft.Samples.BizTalk.Litware.Schemas.Order.PurchaseOrder" />
                    <om:Property Name="ParamDirection" Value="In" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="OrderMessage" />
                    <om:Property Name="Signal" Value="True" />
                </om:Element>
                <om:Element Type="VariableAssignment" OID="18116090-2db2-4c74-8cca-aae43a13b6c1" ParentLink="ServiceBody_Statement" LowerBound="48.1" HigherBound="50.1">
                    <om:Property Name="Expression" Value="orderCount = (System.Int32)xpath(OrderMessage, &quot;count(/*[local-name()='PurchaseOrder' and namespace-uri()='']/*[local-name()='OrderForms' and namespace-uri()='']/*[local-name()='OrderForm' and namespace-uri()=''])&quot;);" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="Get Orders Cnt" />
                    <om:Property Name="Signal" Value="False" />
                </om:Element>
                <om:Element Type="While" OID="8c37618d-37e9-47c3-bcee-944b05a665c1" ParentLink="ServiceBody_Statement" LowerBound="50.1" HigherBound="113.1">
                    <om:Property Name="Expression" Value="ctr &lt;= orderCount" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="RetryLoop" />
                    <om:Property Name="Signal" Value="True" />
                    <om:Element Type="Construct" OID="4e6a0fcd-1b4a-4910-96fb-546d35a992e3" ParentLink="ComplexStatement_Statement" LowerBound="53.1" HigherBound="60.1">
                        <om:Property Name="ReportToAnalyst" Value="True" />
                        <om:Property Name="Name" Value="Construct Order From" />
                        <om:Property Name="Signal" Value="True" />
                        <om:Element Type="MessageAssignment" OID="6b87b716-4016-41bb-b783-8db6c18f1cce" ParentLink="ComplexStatement_Statement" LowerBound="56.1" HigherBound="59.1">
                            <om:Property Name="Expression" Value="thePath = System.String.Format(&quot;/*[local-name()='PurchaseOrder' and namespace-uri()='']/*[local-name()='OrderForms' and namespace-uri()='']/*[local-name()='OrderForm' and namespace-uri()=''][{0}]&quot;, ctr);&#xD;&#xA;OrderFormMsg = xpath(OrderMessage, thePath);" />
                            <om:Property Name="ReportToAnalyst" Value="False" />
                            <om:Property Name="Name" Value="Create Order Form" />
                            <om:Property Name="Signal" Value="True" />
                        </om:Element>
                        <om:Element Type="MessageRef" OID="fc14c402-bb56-40c5-bd26-3f76a78ac73a" ParentLink="Construct_MessageRef" LowerBound="54.27" HigherBound="54.39">
                            <om:Property Name="Ref" Value="OrderFormMsg" />
                            <om:Property Name="ReportToAnalyst" Value="True" />
                            <om:Property Name="Signal" Value="False" />
                        </om:Element>
                    </om:Element>
                    <om:Element Type="VariableAssignment" OID="e0a64597-f0c3-4ded-8346-142aa0225215" ParentLink="ComplexStatement_Statement" LowerBound="60.1" HigherBound="62.1">
                        <om:Property Name="Expression" Value="vendorID = OrderFormMsg.Name;" />
                        <om:Property Name="ReportToAnalyst" Value="True" />
                        <om:Property Name="Name" Value="Get Vendor ID" />
                        <om:Property Name="Signal" Value="False" />
                    </om:Element>
                    <om:Element Type="Call" OID="15294d3d-d4a1-435c-9093-4a962dc4ee6a" ParentLink="ComplexStatement_Statement" LowerBound="62.1" HigherBound="64.1">
                        <om:Property Name="Identifier" Value="CallGetProfile" />
                        <om:Property Name="Invokee" Value="Microsoft.Samples.BizTalk.Litware.Orchestrations.GetUserProfile" />
                        <om:Property Name="ReportToAnalyst" Value="True" />
                        <om:Property Name="Name" Value="CallGetProfile" />
                        <om:Property Name="Signal" Value="False" />
                        <om:Element Type="Parameter" OID="efaa2ea9-b453-410c-8cc8-d28db969bb7a" ParentLink="InvokeStatement_Parameter">
                            <om:Property Name="Direction" Value="In" />
                            <om:Property Name="Name" Value="vendorID" />
                            <om:Property Name="Type" Value="System.String" />
                            <om:Property Name="Signal" Value="False" />
                        </om:Element>
                        <om:Element Type="Parameter" OID="42195e41-27bd-42f3-bf1c-3564045935a4" ParentLink="InvokeStatement_Parameter">
                            <om:Property Name="Direction" Value="Out" />
                            <om:Property Name="Name" Value="ProfileMsg" />
                            <om:Property Name="Type" Value="Microsoft.Samples.BizTalk.Litware.Schemas.TPM.Partner.PartnerObject" />
                            <om:Property Name="Signal" Value="False" />
                        </om:Element>
                        <om:Element Type="Parameter" OID="f0aa8611-f876-436e-ad2d-283e112964a3" ParentLink="InvokeStatement_Parameter">
                            <om:Property Name="Direction" Value="Ref" />
                            <om:Property Name="Name" Value="callFailed" />
                            <om:Property Name="Type" Value="System.Boolean" />
                            <om:Property Name="Signal" Value="False" />
                        </om:Element>
                    </om:Element>
                    <om:Element Type="Decision" OID="3f2e390d-82d9-4f14-b5d5-833ddc7d3f25" ParentLink="ComplexStatement_Statement" LowerBound="64.1" HigherBound="110.1">
                        <om:Property Name="ReportToAnalyst" Value="True" />
                        <om:Property Name="Name" Value="ContactVendor" />
                        <om:Property Name="Signal" Value="True" />
                        <om:Element Type="DecisionBranch" OID="e94a7631-67e9-4e50-913a-918ca8410bc6" ParentLink="ReallyComplexStatement_Branch" LowerBound="65.17" HigherBound="105.1">
                            <om:Property Name="Expression" Value="false == callFailed" />
                            <om:Property Name="IsGhostBranch" Value="True" />
                            <om:Property Name="ReportToAnalyst" Value="True" />
                            <om:Property Name="Name" Value="Profile exist" />
                            <om:Property Name="Signal" Value="True" />
                            <om:Element Type="Scope" OID="bbe5d90e-e842-4dd3-8a86-ab79444a2cfe" ParentLink="ComplexStatement_Statement" LowerBound="67.1" HigherBound="91.1">
                                <om:Property Name="InitializedTransactionType" Value="True" />
                                <om:Property Name="IsSynchronized" Value="False" />
                                <om:Property Name="ReportToAnalyst" Value="True" />
                                <om:Property Name="Name" Value="Send Partial order to partner" />
                                <om:Property Name="Signal" Value="True" />
                                <om:Element Type="Catch" OID="268cba4c-f36c-4a05-9368-342a9fc167b6" ParentLink="Scope_Catch" LowerBound="81.1" HigherBound="89.1">
                                    <om:Property Name="ExceptionName" Value="exp" />
                                    <om:Property Name="ExceptionType" Value="System.Exception" />
                                    <om:Property Name="IsFaultMessage" Value="False" />
                                    <om:Property Name="ReportToAnalyst" Value="True" />
                                    <om:Property Name="Name" Value="Send failed" />
                                    <om:Property Name="Signal" Value="True" />
                                    <om:Element Type="VariableAssignment" OID="b64b2811-cee3-4d2d-8033-e427fef4cad9" ParentLink="Catch_Statement" LowerBound="84.1" HigherBound="86.1">
                                        <om:Property Name="Expression" Value="sendFailed = true;" />
                                        <om:Property Name="ReportToAnalyst" Value="True" />
                                        <om:Property Name="Name" Value="Set Failed Flag" />
                                        <om:Property Name="Signal" Value="False" />
                                    </om:Element>
                                    <om:Element Type="VariableAssignment" OID="4523a21f-1ea8-4ea0-aa25-8f258fbb16bd" ParentLink="Catch_Statement" LowerBound="86.1" HigherBound="88.1">
                                        <om:Property Name="Expression" Value="System.Diagnostics.EventLog.WriteEntry(&quot;Litware Scenario&quot;, &quot;Unable to initialize Role Link or un-enlisted party for Vendor = &quot; + vendorID + &quot;. Exception occured: &quot;+ exp.Message, System.Diagnostics.EventLogEntryType.Error);" />
                                        <om:Property Name="ReportToAnalyst" Value="True" />
                                        <om:Property Name="Name" Value="Notify Admin" />
                                        <om:Property Name="Signal" Value="False" />
                                    </om:Element>
                                </om:Element>
                                <om:Element Type="VariableAssignment" OID="6b6b0222-2fe8-4bc9-8161-7ad403c4c696" ParentLink="ComplexStatement_Statement" LowerBound="72.1" HigherBound="74.1">
                                    <om:Property Name="Expression" Value="ContactVendorRoleLink(Microsoft.XLANGs.BaseTypes.DestinationParty) = new Microsoft.XLANGs.BaseTypes.Party(vendorID,&quot;OrganizationName&quot;);" />
                                    <om:Property Name="ReportToAnalyst" Value="True" />
                                    <om:Property Name="Name" Value="Set Destination" />
                                    <om:Property Name="Signal" Value="True" />
                                </om:Element>
                                <om:Element Type="Send" OID="48260dbc-53d8-4582-9aaa-9bb0a234d9c6" ParentLink="ComplexStatement_Statement" LowerBound="74.1" HigherBound="76.1">
                                    <om:Property Name="MessageName" Value="OrderFormMsg" />
                                    <om:Property Name="OperationName" Value="Operation_ContactVendor" />
                                    <om:Property Name="OperationMessageName" Value="Request" />
                                    <om:Property Name="ServiceLinkName" Value="ContactVendorRoleLink" />
                                    <om:Property Name="ServiceLinkPortTypeName" Value="Microsoft.Samples.BizTalk.Litware.Orchestrations.ContactVendorPortType" />
                                    <om:Property Name="ServiceLinkRoleName" Value="ContactVendor_Role" />
                                    <om:Property Name="ReportToAnalyst" Value="True" />
                                    <om:Property Name="Name" Value="Order to Vendor" />
                                    <om:Property Name="Signal" Value="True" />
                                </om:Element>
                                <om:Element Type="VariableAssignment" OID="9385f702-9403-4582-829a-4e0590f5ac8f" ParentLink="ComplexStatement_Statement" LowerBound="76.1" HigherBound="78.1">
                                    <om:Property Name="Expression" Value="destination = Microsoft.Samples.BizTalk.Litware.Utilities.XmlHelper.GetPartnerEmail(ProfileMsg);" />
                                    <om:Property Name="ReportToAnalyst" Value="True" />
                                    <om:Property Name="Name" Value="Get EMail Address" />
                                    <om:Property Name="Signal" Value="False" />
                                </om:Element>
                            </om:Element>
                            <om:Element Type="Decision" OID="c98a78f3-4d6f-412e-9534-f6f5d96c0f30" ParentLink="ComplexStatement_Statement" LowerBound="91.1" HigherBound="104.1">
                                <om:Property Name="ReportToAnalyst" Value="True" />
                                <om:Property Name="Name" Value="GotEmail" />
                                <om:Property Name="Signal" Value="True" />
                                <om:Element Type="DecisionBranch" OID="34b2f50d-96af-4b64-9800-6226cfc3ce31" ParentLink="ReallyComplexStatement_Branch" LowerBound="92.21" HigherBound="99.1">
                                    <om:Property Name="Expression" Value="null != destination &amp;&amp; false == sendFailed" />
                                    <om:Property Name="IsGhostBranch" Value="True" />
                                    <om:Property Name="ReportToAnalyst" Value="True" />
                                    <om:Property Name="Name" Value="Ok to Notify" />
                                    <om:Property Name="Signal" Value="True" />
                                    <om:Element Type="VariableAssignment" OID="5ec3f633-268f-4884-8a63-7352bb03b863" ParentLink="ComplexStatement_Statement" LowerBound="94.1" HigherBound="96.1">
                                        <om:Property Name="Expression" Value="SendVendorEmail(Microsoft.XLANGs.BaseTypes.Address) = destination;" />
                                        <om:Property Name="ReportToAnalyst" Value="True" />
                                        <om:Property Name="Name" Value="InitializeSendPort" />
                                        <om:Property Name="Signal" Value="True" />
                                    </om:Element>
                                    <om:Element Type="Send" OID="dab3f883-8173-463f-a01d-599312a26bdc" ParentLink="ComplexStatement_Statement" LowerBound="96.1" HigherBound="98.1">
                                        <om:Property Name="PortName" Value="SendVendorEmail" />
                                        <om:Property Name="MessageName" Value="OrderMessage" />
                                        <om:Property Name="OperationName" Value="Operation_1" />
                                        <om:Property Name="OperationMessageName" Value="Request" />
                                        <om:Property Name="ReportToAnalyst" Value="True" />
                                        <om:Property Name="Name" Value="SendEmailNotification" />
                                        <om:Property Name="Signal" Value="True" />
                                    </om:Element>
                                </om:Element>
                                <om:Element Type="DecisionBranch" OID="ba7626db-d96b-4bdd-9d2f-3f73b80f1d6b" ParentLink="ReallyComplexStatement_Branch">
                                    <om:Property Name="IsGhostBranch" Value="True" />
                                    <om:Property Name="ReportToAnalyst" Value="True" />
                                    <om:Property Name="Name" Value="Else" />
                                    <om:Property Name="Signal" Value="False" />
                                    <om:Element Type="VariableAssignment" OID="79ac3607-3445-4152-b1d1-16d9a36c8256" ParentLink="ComplexStatement_Statement" LowerBound="101.1" HigherBound="103.1">
                                        <om:Property Name="Expression" Value="sendFailed = false;" />
                                        <om:Property Name="ReportToAnalyst" Value="True" />
                                        <om:Property Name="Name" Value="Set Failed Flag" />
                                        <om:Property Name="Signal" Value="True" />
                                    </om:Element>
                                </om:Element>
                            </om:Element>
                        </om:Element>
                        <om:Element Type="DecisionBranch" OID="3e513209-e5c9-41af-b272-110788009219" ParentLink="ReallyComplexStatement_Branch">
                            <om:Property Name="IsGhostBranch" Value="True" />
                            <om:Property Name="ReportToAnalyst" Value="True" />
                            <om:Property Name="Name" Value="Else" />
                            <om:Property Name="Signal" Value="False" />
                            <om:Element Type="VariableAssignment" OID="4cb73de4-74fe-41cf-936d-0e7f0a577f78" ParentLink="ComplexStatement_Statement" LowerBound="107.1" HigherBound="109.1">
                                <om:Property Name="Expression" Value="System.Diagnostics.EventLog.WriteEntry(&quot;Litware Scenario&quot;, &quot;Unable to find Partner Profile with Vendor ID = &quot; + vendorID, System.Diagnostics.EventLogEntryType.Warning);" />
                                <om:Property Name="ReportToAnalyst" Value="True" />
                                <om:Property Name="Name" Value="Notify Admin" />
                                <om:Property Name="Signal" Value="True" />
                            </om:Element>
                        </om:Element>
                    </om:Element>
                    <om:Element Type="VariableAssignment" OID="7de85a6f-684c-40c1-a033-d0204250da93" ParentLink="ComplexStatement_Statement" LowerBound="110.1" HigherBound="112.1">
                        <om:Property Name="Expression" Value="ctr = ctr + 1;" />
                        <om:Property Name="ReportToAnalyst" Value="True" />
                        <om:Property Name="Name" Value="Inc Counter" />
                        <om:Property Name="Signal" Value="False" />
                    </om:Element>
                </om:Element>
            </om:Element>
            <om:Element Type="PortDeclaration" OID="c1ae479d-ce86-45c3-b8a5-8a61ad1b30d1" ParentLink="ServiceDeclaration_PortDeclaration" LowerBound="29.1" HigherBound="31.1">
                <om:Property Name="PortModifier" Value="Uses" />
                <om:Property Name="Orientation" Value="Left" />
                <om:Property Name="PortIndex" Value="77" />
                <om:Property Name="IsWebPort" Value="False" />
                <om:Property Name="OrderedDelivery" Value="False" />
                <om:Property Name="DeliveryNotification" Value="None" />
                <om:Property Name="Type" Value="Microsoft.Samples.BizTalk.Litware.Orchestrations.SendVendorEmailType" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="SendVendorEmail" />
                <om:Property Name="Signal" Value="False" />
                <om:Element Type="PhysicalBindingAttribute" OID="61d1f693-e032-454c-af6c-fa4b7b14207b" ParentLink="PortDeclaration_CLRAttribute" LowerBound="29.1" HigherBound="30.1">
                    <om:Property Name="InPipeline" Value="Microsoft.BizTalk.DefaultPipelines.XMLReceive" />
                    <om:Property Name="OutPipeline" Value="Microsoft.BizTalk.DefaultPipelines.XMLTransmit" />
                    <om:Property Name="TransportType" Value="HTTP" />
                    <om:Property Name="URI" Value="http://tempURI" />
                    <om:Property Name="IsDynamic" Value="True" />
                    <om:Property Name="Signal" Value="False" />
                </om:Element>
            </om:Element>
        </om:Element>
        <om:Element Type="PortType" OID="70b4e754-8ff3-4205-a73e-d18c636c007c" ParentLink="Module_PortType" LowerBound="4.1" HigherBound="11.1">
            <om:Property Name="Synchronous" Value="False" />
            <om:Property Name="TypeModifier" Value="Public" />
            <om:Property Name="ReportToAnalyst" Value="True" />
            <om:Property Name="Name" Value="ContactVendorPortType" />
            <om:Property Name="Signal" Value="False" />
            <om:Element Type="OperationDeclaration" OID="974a4b44-f38e-4dd5-983e-fa22e07ae8ae" ParentLink="PortType_OperationDeclaration" LowerBound="6.1" HigherBound="10.1">
                <om:Property Name="OperationType" Value="OneWay" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="Operation_ContactVendor" />
                <om:Property Name="Signal" Value="True" />
                <om:Element Type="MessageRef" OID="1b9404aa-0592-4437-b1ca-c6faec612503" ParentLink="OperationDeclaration_RequestMessageRef" LowerBound="8.13" HigherBound="8.70">
                    <om:Property Name="Ref" Value="Microsoft.Samples.BizTalk.Litware.Schemas.Order.OrderForm" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="Request" />
                    <om:Property Name="Signal" Value="False" />
                </om:Element>
            </om:Element>
        </om:Element>
        <om:Element Type="PortType" OID="6f50c4c7-f1a7-4f69-8b30-4cdcc70632a4" ParentLink="Module_PortType" LowerBound="11.1" HigherBound="18.1">
            <om:Property Name="Synchronous" Value="False" />
            <om:Property Name="TypeModifier" Value="Internal" />
            <om:Property Name="ReportToAnalyst" Value="True" />
            <om:Property Name="Name" Value="SendVendorEmailType" />
            <om:Property Name="Signal" Value="False" />
            <om:Element Type="OperationDeclaration" OID="14678dc1-e9b2-4663-beec-706735601899" ParentLink="PortType_OperationDeclaration" LowerBound="13.1" HigherBound="17.1">
                <om:Property Name="OperationType" Value="OneWay" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="Operation_1" />
                <om:Property Name="Signal" Value="False" />
                <om:Element Type="MessageRef" OID="efbc85a2-4026-4463-8fa6-985e679e64f7" ParentLink="OperationDeclaration_RequestMessageRef" LowerBound="15.13" HigherBound="15.74">
                    <om:Property Name="Ref" Value="Microsoft.Samples.BizTalk.Litware.Schemas.Order.PurchaseOrder" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="Request" />
                    <om:Property Name="Signal" Value="False" />
                </om:Element>
            </om:Element>
        </om:Element>
        <om:Element Type="ServiceLinkType" OID="4cdc8b0e-b613-4edb-bc51-74e5209fef40" ParentLink="Module_ServiceLinkType" LowerBound="18.1" HigherBound="25.1">
            <om:Property Name="TypeModifier" Value="Internal" />
            <om:Property Name="ReportToAnalyst" Value="True" />
            <om:Property Name="Name" Value="VendorLinkType" />
            <om:Property Name="Signal" Value="True" />
            <om:Element Type="RoleDeclaration" OID="6de08e19-3d58-4e1d-9c61-204972a6e72b" ParentLink="ServiceLinkType_RoleDeclaration" LowerBound="20.1" HigherBound="24.1">
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="ContactVendor_Role" />
                <om:Property Name="Signal" Value="True" />
                <om:Element Type="PortTypeRef" OID="d1fa3753-0fec-4be0-95a9-6abe5f5c859b" ParentLink="RoleDeclaration_PortTypeRef" LowerBound="22.13" HigherBound="22.34">
                    <om:Property Name="Ref" Value="Microsoft.Samples.BizTalk.Litware.Orchestrations.ContactVendorPortType" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="PortTypeRef_1" />
                    <om:Property Name="Signal" Value="False" />
                </om:Element>
            </om:Element>
        </om:Element>
    </om:Element>
</om:MetaModel>
#endif // __DESIGNER_DATA
[Microsoft.XLANGs.BaseTypes.BPELExportable(false)]
module Microsoft.Samples.BizTalk.Litware.Orchestrations
{
    public porttype ContactVendorPortType
    {
        oneway Operation_ContactVendor
        {
            Microsoft.Samples.BizTalk.Litware.Schemas.Order.OrderForm
        };
    };
    internal porttype SendVendorEmailType
    {
        oneway Operation_1
        {
            Microsoft.Samples.BizTalk.Litware.Schemas.Order.PurchaseOrder
        };
    };
    internal servicelinktype VendorLinkType
    {
        ContactVendor_Role
        {
            ContactVendorPortType
        };
    };
    [Microsoft.XLANGs.BaseTypes.BPELExportable(false)]
    internal service ConfirmOrderWithVendors
    {
        servicelink uses VendorLinkType.ContactVendor_Role ContactVendorRoleLink;
        [Microsoft.XLANGs.BaseTypes.PhysicalBinding(typeof(Microsoft.BizTalk.DefaultPipelines.XMLTransmit))]
        port uses dynamic SendVendorEmailType SendVendorEmail;
        message Microsoft.Samples.BizTalk.Litware.Schemas.Order.OrderForm OrderFormMsg;
        message Microsoft.Samples.BizTalk.Litware.Schemas.TPM.Partner.PartnerObject ProfileMsg;
        System.Int32 orderCount;
        System.Int32 ctr;
        System.String thePath;
        System.String vendorID;
        System.Boolean callFailed;
        System.Boolean sendFailed;
        System.String destination;
        body (message Microsoft.Samples.BizTalk.Litware.Schemas.Order.PurchaseOrder OrderMessage)
        {
            ctr = 1;
            thePath = "";
            vendorID = "";
            callFailed = true;
            sendFailed = true;
            destination = "";
            [Microsoft.XLANGs.BaseTypes.DesignerPosition("18116090-2db2-4c74-8cca-aae43a13b6c1")]
            orderCount = (System.Int32)xpath(OrderMessage, "count(/*[local-name()='PurchaseOrder' and namespace-uri()='']/*[local-name()='OrderForms' and namespace-uri()='']/*[local-name()='OrderForm' and namespace-uri()=''])");
            [Microsoft.XLANGs.BaseTypes.DesignerPosition("8c37618d-37e9-47c3-bcee-944b05a665c1")]
            while (ctr <= orderCount)
            {
                [Microsoft.XLANGs.BaseTypes.DesignerPosition("4e6a0fcd-1b4a-4910-96fb-546d35a992e3")]
                construct OrderFormMsg
                {
                    [Microsoft.XLANGs.BaseTypes.DesignerPosition("6b87b716-4016-41bb-b783-8db6c18f1cce")]
                    thePath = System.String.Format("/*[local-name()='PurchaseOrder' and namespace-uri()='']/*[local-name()='OrderForms' and namespace-uri()='']/*[local-name()='OrderForm' and namespace-uri()=''][{0}]", ctr);
                    OrderFormMsg = xpath(OrderMessage, thePath);
                }
                [Microsoft.XLANGs.BaseTypes.DesignerPosition("e0a64597-f0c3-4ded-8346-142aa0225215")]
                vendorID = OrderFormMsg.Name;
                [Microsoft.XLANGs.BaseTypes.DesignerPosition("15294d3d-d4a1-435c-9093-4a962dc4ee6a")]
                call Microsoft.Samples.BizTalk.Litware.Orchestrations.GetUserProfile (vendorID, out ProfileMsg, ref callFailed);
                [Microsoft.XLANGs.BaseTypes.DesignerPosition("3f2e390d-82d9-4f14-b5d5-833ddc7d3f25")]
                if (false == callFailed)
                {
                    [Microsoft.XLANGs.BaseTypes.DesignerPosition("bbe5d90e-e842-4dd3-8a86-ab79444a2cfe")]
                    scope
                    {
                        body
                        {
                            [Microsoft.XLANGs.BaseTypes.DesignerPosition("6b6b0222-2fe8-4bc9-8161-7ad403c4c696")]
                            ContactVendorRoleLink(Microsoft.XLANGs.BaseTypes.DestinationParty) = new Microsoft.XLANGs.BaseTypes.Party(vendorID,"OrganizationName");
                            [Microsoft.XLANGs.BaseTypes.DesignerPosition("48260dbc-53d8-4582-9aaa-9bb0a234d9c6")]
                            send (ContactVendorRoleLink[Microsoft.Samples.BizTalk.Litware.Orchestrations.ContactVendorPortType].Operation_ContactVendor, OrderFormMsg);
                            [Microsoft.XLANGs.BaseTypes.DesignerPosition("9385f702-9403-4582-829a-4e0590f5ac8f")]
                            destination = Microsoft.Samples.BizTalk.Litware.Utilities.XmlHelper.GetPartnerEmail(ProfileMsg);
                        }
                        exceptions
                        {
                            [Microsoft.XLANGs.BaseTypes.DesignerPosition("268cba4c-f36c-4a05-9368-342a9fc167b6")]
                            catch (System.Exception exp)
                            {
                                [Microsoft.XLANGs.BaseTypes.DesignerPosition("b64b2811-cee3-4d2d-8033-e427fef4cad9")]
                                sendFailed = true;
                                [Microsoft.XLANGs.BaseTypes.DesignerPosition("4523a21f-1ea8-4ea0-aa25-8f258fbb16bd")]
                                System.Diagnostics.EventLog.WriteEntry("Litware Scenario", "Unable to initialize Role Link or un-enlisted party for Vendor = " + vendorID + ". Exception occured: "+ exp.Message, System.Diagnostics.EventLogEntryType.Error);
                            }
                        }
                    }
                    [Microsoft.XLANGs.BaseTypes.DesignerPosition("c98a78f3-4d6f-412e-9534-f6f5d96c0f30")]
                    if (null != destination && false == sendFailed)
                    {
                        [Microsoft.XLANGs.BaseTypes.DesignerPosition("5ec3f633-268f-4884-8a63-7352bb03b863")]
                        SendVendorEmail(Microsoft.XLANGs.BaseTypes.Address) = destination;
                        [Microsoft.XLANGs.BaseTypes.DesignerPosition("dab3f883-8173-463f-a01d-599312a26bdc")]
                        send (SendVendorEmail.Operation_1, OrderMessage);
                    }
                    else 
                    {
                        [Microsoft.XLANGs.BaseTypes.DesignerPosition("79ac3607-3445-4152-b1d1-16d9a36c8256")]
                        sendFailed = false;
                    }
                }
                else 
                {
                    [Microsoft.XLANGs.BaseTypes.DesignerPosition("4cb73de4-74fe-41cf-936d-0e7f0a577f78")]
                    System.Diagnostics.EventLog.WriteEntry("Litware Scenario", "Unable to find Partner Profile with Vendor ID = " + vendorID, System.Diagnostics.EventLogEntryType.Warning);
                }
                [Microsoft.XLANGs.BaseTypes.DesignerPosition("7de85a6f-684c-40c1-a033-d0204250da93")]
                ctr = ctr + 1;
            }
        }
    }
}

