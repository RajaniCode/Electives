#if __DESIGNER_DATA
#error Do not define __DESIGNER_DATA.
<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<om:MetaModel MajorVersion="1" MinorVersion="3" Core="2b131234-7959-458d-834f-2dc0769ce683" ScheduleModel="66366196-361d-448d-976f-cab5e87496d2" xmlns:om="http://schemas.microsoft.com/BizTalk/2003/DesignerData">
    <om:Element Type="Module" OID="f60884b6-2489-4124-8895-0e74777c4c91" LowerBound="1.1" HigherBound="102.1">
        <om:Property Name="ReportToAnalyst" Value="True" />
        <om:Property Name="Name" Value="Microsoft.Samples.BizTalk.Litware.Orchestrations" />
        <om:Property Name="Signal" Value="False" />
        <om:Element Type="ServiceDeclaration" OID="8bbe9388-4402-4141-9ae0-bc90dac7a918" ParentLink="Module_ServiceDeclaration" LowerBound="11.1" HigherBound="101.1">
            <om:Property Name="InitializedTransactionType" Value="False" />
            <om:Property Name="IsInvokable" Value="True" />
            <om:Property Name="TypeModifier" Value="Internal" />
            <om:Property Name="ReportToAnalyst" Value="True" />
            <om:Property Name="Name" Value="GetPurchaseOrder" />
            <om:Property Name="Signal" Value="False" />
            <om:Element Type="VariableDeclaration" OID="00ef633a-8f57-4219-bcd0-c1e09d52390a" ParentLink="ServiceDeclaration_VariableDeclaration" LowerBound="17.1" HigherBound="18.1">
                <om:Property Name="InitialValue" Value="0" />
                <om:Property Name="UseDefaultConstructor" Value="False" />
                <om:Property Name="Type" Value="System.Int32" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="retryCount" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="MessageDeclaration" OID="324e28a8-d58d-45ec-bbab-4976ba00186a" ParentLink="ServiceDeclaration_MessageDeclaration" LowerBound="16.1" HigherBound="17.1">
                <om:Property Name="Type" Value="Microsoft.Samples.BizTalk.Litware.Schemas.OrderSystem.OrderInquiry" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="RequestMessage" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="ServiceBody" OID="52cc6565-e2d8-4f2a-912d-7c2f78c89e07" ParentLink="ServiceDeclaration_ServiceBody">
                <om:Property Name="Signal" Value="False" />
                <om:Element Type="VariableDeclaration" OID="6114f684-6ead-4e4b-93b0-4dcaea2ce075" ParentLink="ServiceBody_Declaration" LowerBound="18.15" HigherBound="18.37">
                    <om:Property Name="UseDefaultConstructor" Value="False" />
                    <om:Property Name="Type" Value="System.String" />
                    <om:Property Name="ParamDirection" Value="In" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="brokerID" />
                    <om:Property Name="Signal" Value="True" />
                </om:Element>
                <om:Element Type="VariableDeclaration" OID="c6a5c4fb-9947-40d4-836d-cd0e393ffe1e" ParentLink="ServiceBody_Declaration" LowerBound="18.39" HigherBound="18.60">
                    <om:Property Name="UseDefaultConstructor" Value="False" />
                    <om:Property Name="Type" Value="System.String" />
                    <om:Property Name="ParamDirection" Value="In" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="orderID" />
                    <om:Property Name="Signal" Value="True" />
                </om:Element>
                <om:Element Type="MessageDeclaration" OID="f24c6de6-5796-4167-9631-099b0f963bbc" ParentLink="ServiceBody_Declaration" LowerBound="18.62" HigherBound="18.149">
                    <om:Property Name="Type" Value="Microsoft.Samples.BizTalk.Litware.Schemas.Order.PurchaseOrder" />
                    <om:Property Name="ParamDirection" Value="Out" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="OrderMessage" />
                    <om:Property Name="Signal" Value="True" />
                </om:Element>
                <om:Element Type="VariableDeclaration" OID="b4700fe3-2f46-4c28-8e18-7c1eeccdc954" ParentLink="ServiceBody_Declaration" LowerBound="18.151" HigherBound="18.178">
                    <om:Property Name="InitialValue" Value="true" />
                    <om:Property Name="UseDefaultConstructor" Value="False" />
                    <om:Property Name="Type" Value="System.Boolean" />
                    <om:Property Name="ParamDirection" Value="Ref" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="bFailure" />
                    <om:Property Name="Signal" Value="True" />
                </om:Element>
                <om:Element Type="Construct" OID="c1a73359-e4f0-404f-905d-55e6a7d797bf" ParentLink="ServiceBody_Statement" LowerBound="21.1" HigherBound="27.1">
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="IntializeOutMessage" />
                    <om:Property Name="Signal" Value="True" />
                    <om:Element Type="MessageRef" OID="82c27399-f146-41b4-9584-f8ed5a8bde42" ParentLink="Construct_MessageRef" LowerBound="22.23" HigherBound="22.35">
                        <om:Property Name="Ref" Value="OrderMessage" />
                        <om:Property Name="ReportToAnalyst" Value="True" />
                        <om:Property Name="Signal" Value="False" />
                    </om:Element>
                    <om:Element Type="MessageAssignment" OID="e757ebfa-64cb-4be9-8aa2-cd0ee861dd76" ParentLink="ComplexStatement_Statement" LowerBound="24.1" HigherBound="26.1">
                        <om:Property Name="Expression" Value="OrderMessage = Microsoft.Samples.BizTalk.Litware.Utilities.ResourceHelper.GetEmptyOrderMessage();" />
                        <om:Property Name="ReportToAnalyst" Value="False" />
                        <om:Property Name="Name" Value="EmptyMessage" />
                        <om:Property Name="Signal" Value="True" />
                    </om:Element>
                </om:Element>
                <om:Element Type="Construct" OID="8e40e678-8f13-47f3-8514-02a64e1159f5" ParentLink="ServiceBody_Statement" LowerBound="27.1" HigherBound="37.1">
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="RequestOrderMessage" />
                    <om:Property Name="Signal" Value="True" />
                    <om:Element Type="Transform" OID="6eed853a-5182-483a-92a3-82a0a74d55c8" ParentLink="ComplexStatement_Statement" LowerBound="30.1" HigherBound="32.1">
                        <om:Property Name="ClassName" Value="Microsoft.Samples.BizTalk.Litware.Maps.PurchaseOrder_To_Inquiry" />
                        <om:Property Name="ReportToAnalyst" Value="True" />
                        <om:Property Name="Name" Value="PO X Inquiry" />
                        <om:Property Name="Signal" Value="True" />
                        <om:Element Type="MessagePartRef" OID="362cc244-4a40-40d8-bdad-8cc33b557c01" ParentLink="Transform_InputMessagePartRef" LowerBound="31.112" HigherBound="31.124">
                            <om:Property Name="MessageRef" Value="OrderMessage" />
                            <om:Property Name="ReportToAnalyst" Value="True" />
                            <om:Property Name="Name" Value="MessagePartReference_1" />
                            <om:Property Name="Signal" Value="False" />
                        </om:Element>
                        <om:Element Type="MessagePartRef" OID="5d02b2de-557a-481d-9801-2e719a05850d" ParentLink="Transform_OutputMessagePartRef" LowerBound="31.28" HigherBound="31.42">
                            <om:Property Name="MessageRef" Value="RequestMessage" />
                            <om:Property Name="ReportToAnalyst" Value="True" />
                            <om:Property Name="Name" Value="MessagePartReference_2" />
                            <om:Property Name="Signal" Value="False" />
                        </om:Element>
                    </om:Element>
                    <om:Element Type="MessageAssignment" OID="baf94d6e-e199-47d6-b48b-09ff6d1efe2a" ParentLink="ComplexStatement_Statement" LowerBound="32.1" HigherBound="36.1">
                        <om:Property Name="Expression" Value="RequestMessage.Request.OrderGroupId = orderID;&#xD;&#xA;RequestMessage.Request.SoldToName = brokerID;&#xD;&#xA;RequestMessage(Microsoft.Samples.BizTalk.Litware.Schemas.ReturnPOXML) = true;" />
                        <om:Property Name="ReportToAnalyst" Value="False" />
                        <om:Property Name="Name" Value="Set Params" />
                        <om:Property Name="Signal" Value="False" />
                    </om:Element>
                    <om:Element Type="MessageRef" OID="a1b6dac7-e6a9-4ebc-8cf3-5eab673a88e5" ParentLink="Construct_MessageRef" LowerBound="28.23" HigherBound="28.37">
                        <om:Property Name="Ref" Value="RequestMessage" />
                        <om:Property Name="ReportToAnalyst" Value="True" />
                        <om:Property Name="Signal" Value="False" />
                    </om:Element>
                </om:Element>
                <om:Element Type="While" OID="672dde37-c7e1-406e-b288-e008b7cb3756" ParentLink="ServiceBody_Statement" LowerBound="37.1" HigherBound="99.1">
                    <om:Property Name="Expression" Value="retryCount &lt; 3" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="RetryLoop" />
                    <om:Property Name="Signal" Value="False" />
                    <om:Element Type="Scope" OID="56503026-692d-48d4-b0d0-d93c41836e20" ParentLink="ComplexStatement_Statement" LowerBound="40.1" HigherBound="98.1">
                        <om:Property Name="InitializedTransactionType" Value="True" />
                        <om:Property Name="IsSynchronized" Value="False" />
                        <om:Property Name="ReportToAnalyst" Value="True" />
                        <om:Property Name="Name" Value="GetOrder" />
                        <om:Property Name="Signal" Value="True" />
                        <om:Element Type="Send" OID="0427c438-7b2f-4aba-90fd-2ca7fe097300" ParentLink="ComplexStatement_Statement" LowerBound="45.1" HigherBound="47.1">
                            <om:Property Name="PortName" Value="GetOrderPort" />
                            <om:Property Name="MessageName" Value="RequestMessage" />
                            <om:Property Name="OperationName" Value="Operation_GetOrder" />
                            <om:Property Name="OperationMessageName" Value="Request" />
                            <om:Property Name="ReportToAnalyst" Value="True" />
                            <om:Property Name="Name" Value="SendOrderRequest" />
                            <om:Property Name="Signal" Value="True" />
                        </om:Element>
                        <om:Element Type="Receive" OID="9eab0b3c-9f0a-4fde-80c7-1c86013bc08e" ParentLink="ComplexStatement_Statement" LowerBound="47.1" HigherBound="49.1">
                            <om:Property Name="Activate" Value="False" />
                            <om:Property Name="PortName" Value="GetOrderPort" />
                            <om:Property Name="MessageName" Value="OrderMessage" />
                            <om:Property Name="OperationName" Value="Operation_GetOrder" />
                            <om:Property Name="OperationMessageName" Value="Response" />
                            <om:Property Name="ReportToAnalyst" Value="True" />
                            <om:Property Name="Name" Value="ReceiveOrder" />
                            <om:Property Name="Signal" Value="True" />
                        </om:Element>
                        <om:Element Type="VariableAssignment" OID="588a375d-b410-4fac-9276-c0b50b4cef01" ParentLink="ComplexStatement_Statement" LowerBound="49.1" HigherBound="51.1">
                            <om:Property Name="Expression" Value="retryCount = 3;" />
                            <om:Property Name="ReportToAnalyst" Value="True" />
                            <om:Property Name="Name" Value="Breakloop" />
                            <om:Property Name="Signal" Value="False" />
                        </om:Element>
                        <om:Element Type="Catch" OID="dcda201d-aa9e-4ee9-abdc-4950c47a897d" ParentLink="Scope_Catch" LowerBound="54.1" HigherBound="75.1">
                            <om:Property Name="ExceptionName" Value="OrderSystemSystemFault" />
                            <om:Property Name="ExceptionType" Value="GetOrderPort.Operation_GetOrder.SystemFault" />
                            <om:Property Name="IsFaultMessage" Value="False" />
                            <om:Property Name="ReportToAnalyst" Value="True" />
                            <om:Property Name="Name" Value="CatchSystemException" />
                            <om:Property Name="Signal" Value="True" />
                            <om:Element Type="VariableAssignment" OID="e6f3e3a0-2e69-431a-a295-0299bcc6473f" ParentLink="Catch_Statement" LowerBound="57.1" HigherBound="59.1">
                                <om:Property Name="Expression" Value="retryCount = retryCount + 1;" />
                                <om:Property Name="ReportToAnalyst" Value="True" />
                                <om:Property Name="Name" Value="Count" />
                                <om:Property Name="Signal" Value="True" />
                            </om:Element>
                            <om:Element Type="Decision" OID="a4e666fa-9f67-47c9-9b99-fc58a7fb66cc" ParentLink="Catch_Statement" LowerBound="59.1" HigherBound="74.1">
                                <om:Property Name="ReportToAnalyst" Value="True" />
                                <om:Property Name="Name" Value="Terminate" />
                                <om:Property Name="Signal" Value="True" />
                                <om:Element Type="DecisionBranch" OID="f1c9e455-c0b5-485d-8d1b-572dbdf69ed0" ParentLink="ReallyComplexStatement_Branch" LowerBound="60.29" HigherBound="67.1">
                                    <om:Property Name="Expression" Value="retryCount &lt; 3" />
                                    <om:Property Name="IsGhostBranch" Value="True" />
                                    <om:Property Name="ReportToAnalyst" Value="True" />
                                    <om:Property Name="Name" Value="RetryOver" />
                                    <om:Property Name="Signal" Value="False" />
                                    <om:Element Type="VariableAssignment" OID="99258df7-a1a3-4088-81cf-c06227488e3c" ParentLink="ComplexStatement_Statement" LowerBound="62.1" HigherBound="64.1">
                                        <om:Property Name="Expression" Value="System.Diagnostics.EventLog.WriteEntry(&quot;Litware Scenario&quot;, &quot;Failed to get order &quot; + orderID + &quot; for user &quot; + brokerID + &quot;. Orchestration suspended due to error &quot; + OrderSystemSystemFault.Message, System.Diagnostics.EventLogEntryType.Warning);&#xD;&#xA;" />
                                        <om:Property Name="ReportToAnalyst" Value="True" />
                                        <om:Property Name="Name" Value="Log Susp Error" />
                                        <om:Property Name="Signal" Value="False" />
                                    </om:Element>
                                    <om:Element Type="Suspend" OID="09a86953-05fe-4b4f-bab1-6b89ea17cdc5" ParentLink="ComplexStatement_Statement" LowerBound="64.1" HigherBound="66.1">
                                        <om:Property Name="ErrorMessage" Value="&quot;Please verify why we failed to get order.&quot;;" />
                                        <om:Property Name="ReportToAnalyst" Value="True" />
                                        <om:Property Name="Name" Value="Suspend" />
                                        <om:Property Name="Signal" Value="True" />
                                    </om:Element>
                                </om:Element>
                                <om:Element Type="DecisionBranch" OID="f559d0ea-75ba-4ca3-bd83-aa63307bc1f1" ParentLink="ReallyComplexStatement_Branch">
                                    <om:Property Name="IsGhostBranch" Value="True" />
                                    <om:Property Name="ReportToAnalyst" Value="True" />
                                    <om:Property Name="Name" Value="Else" />
                                    <om:Property Name="Signal" Value="False" />
                                    <om:Element Type="VariableAssignment" OID="c6eb33cc-949e-45e7-b22a-d523dc21ad5c" ParentLink="ComplexStatement_Statement" LowerBound="69.1" HigherBound="71.1">
                                        <om:Property Name="Expression" Value="System.Diagnostics.EventLog.WriteEntry(&quot;Litware Scenario&quot;, &quot;Failed to get order &quot; + orderID + &quot; for user &quot; + brokerID + &quot;. Orchestration suspended due to error &quot; + OrderSystemSystemFault.Message, System.Diagnostics.EventLogEntryType.Error);&#xD;&#xA;" />
                                        <om:Property Name="ReportToAnalyst" Value="True" />
                                        <om:Property Name="Name" Value="Log Intervention Error" />
                                        <om:Property Name="Signal" Value="True" />
                                    </om:Element>
                                    <om:Element Type="VariableAssignment" OID="28d502eb-2940-47ca-ad54-a526e471aa3f" ParentLink="ComplexStatement_Statement" LowerBound="71.1" HigherBound="73.1">
                                        <om:Property Name="Expression" Value="bFailure = true;" />
                                        <om:Property Name="ReportToAnalyst" Value="True" />
                                        <om:Property Name="Name" Value="Intervention" />
                                        <om:Property Name="Signal" Value="False" />
                                    </om:Element>
                                </om:Element>
                            </om:Element>
                        </om:Element>
                        <om:Element Type="Catch" OID="86dcdba5-854a-4b4b-b765-3e8bf5151e5f" ParentLink="Scope_Catch" LowerBound="75.1" HigherBound="96.1">
                            <om:Property Name="ExceptionName" Value="exp" />
                            <om:Property Name="ExceptionType" Value="System.Exception" />
                            <om:Property Name="IsFaultMessage" Value="False" />
                            <om:Property Name="ReportToAnalyst" Value="True" />
                            <om:Property Name="Name" Value="CatchException" />
                            <om:Property Name="Signal" Value="True" />
                            <om:Element Type="VariableAssignment" OID="9f52d105-c81f-4f4e-81e6-e29c77915a20" ParentLink="Catch_Statement" LowerBound="78.1" HigherBound="80.1">
                                <om:Property Name="Expression" Value="retryCount = retryCount + 1;" />
                                <om:Property Name="ReportToAnalyst" Value="True" />
                                <om:Property Name="Name" Value="Count" />
                                <om:Property Name="Signal" Value="True" />
                            </om:Element>
                            <om:Element Type="Decision" OID="7163dd5b-39e3-4a99-bb66-9cc037357771" ParentLink="Catch_Statement" LowerBound="80.1" HigherBound="95.1">
                                <om:Property Name="ReportToAnalyst" Value="True" />
                                <om:Property Name="Name" Value="Terminate" />
                                <om:Property Name="Signal" Value="True" />
                                <om:Element Type="DecisionBranch" OID="32786213-d5c6-4c20-95c2-ba02e2267f7a" ParentLink="ReallyComplexStatement_Branch" LowerBound="81.29" HigherBound="88.1">
                                    <om:Property Name="Expression" Value="retryCount &lt; 3" />
                                    <om:Property Name="IsGhostBranch" Value="True" />
                                    <om:Property Name="ReportToAnalyst" Value="True" />
                                    <om:Property Name="Name" Value="RetryOver" />
                                    <om:Property Name="Signal" Value="False" />
                                    <om:Element Type="VariableAssignment" OID="e2de675b-03d0-4b79-b5c9-990c6c917918" ParentLink="ComplexStatement_Statement" LowerBound="83.1" HigherBound="85.1">
                                        <om:Property Name="Expression" Value="System.Diagnostics.EventLog.WriteEntry(&quot;Litware Scenario&quot;, &quot;Failed to get order &quot; + orderID + &quot; for user &quot; + brokerID + &quot;. Orchestration suspended due to error &quot; + exp.Message, System.Diagnostics.EventLogEntryType.Warning);" />
                                        <om:Property Name="ReportToAnalyst" Value="True" />
                                        <om:Property Name="Name" Value="Log Susp Error" />
                                        <om:Property Name="Signal" Value="True" />
                                    </om:Element>
                                    <om:Element Type="Suspend" OID="0e569111-4e56-4d0f-b9d1-f75a43b67cbb" ParentLink="ComplexStatement_Statement" LowerBound="85.1" HigherBound="87.1">
                                        <om:Property Name="ErrorMessage" Value="&quot;Please verify why we failed to get order.&quot;;" />
                                        <om:Property Name="ReportToAnalyst" Value="True" />
                                        <om:Property Name="Name" Value="Suspend" />
                                        <om:Property Name="Signal" Value="True" />
                                    </om:Element>
                                </om:Element>
                                <om:Element Type="DecisionBranch" OID="03ae29ea-afa7-4bae-a688-306b0598f696" ParentLink="ReallyComplexStatement_Branch">
                                    <om:Property Name="IsGhostBranch" Value="True" />
                                    <om:Property Name="ReportToAnalyst" Value="True" />
                                    <om:Property Name="Name" Value="Else" />
                                    <om:Property Name="Signal" Value="False" />
                                    <om:Element Type="VariableAssignment" OID="a081db9f-7310-4bb1-b29a-768d72a143f9" ParentLink="ComplexStatement_Statement" LowerBound="90.1" HigherBound="92.1">
                                        <om:Property Name="Expression" Value="System.Diagnostics.EventLog.WriteEntry(&quot;Litware Scenario&quot;, &quot;Failed to get order &quot; + orderID + &quot; for user &quot; + brokerID + &quot;. Orchestration suspended due to error &quot; + exp.Message, System.Diagnostics.EventLogEntryType.Error);&#xD;&#xA;" />
                                        <om:Property Name="ReportToAnalyst" Value="True" />
                                        <om:Property Name="Name" Value="Log Intervention Error" />
                                        <om:Property Name="Signal" Value="False" />
                                    </om:Element>
                                    <om:Element Type="VariableAssignment" OID="cfcd2c58-ccda-4ccf-8be7-610b50b899d2" ParentLink="ComplexStatement_Statement" LowerBound="92.1" HigherBound="94.1">
                                        <om:Property Name="Expression" Value="bFailure = true;" />
                                        <om:Property Name="ReportToAnalyst" Value="True" />
                                        <om:Property Name="Name" Value="Intervention" />
                                        <om:Property Name="Signal" Value="False" />
                                    </om:Element>
                                </om:Element>
                            </om:Element>
                        </om:Element>
                    </om:Element>
                </om:Element>
            </om:Element>
            <om:Element Type="PortDeclaration" OID="a3404c8b-f3ed-464c-9f78-c6e2b302e7e9" ParentLink="ServiceDeclaration_PortDeclaration" LowerBound="14.1" HigherBound="16.1">
                <om:Property Name="PortModifier" Value="Uses" />
                <om:Property Name="Orientation" Value="Left" />
                <om:Property Name="PortIndex" Value="39" />
                <om:Property Name="IsWebPort" Value="False" />
                <om:Property Name="OrderedDelivery" Value="False" />
                <om:Property Name="DeliveryNotification" Value="None" />
                <om:Property Name="Type" Value="Microsoft.Samples.BizTalk.Litware.Orchestrations.GetOrderPortType" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="GetOrderPort" />
                <om:Property Name="Signal" Value="False" />
                <om:Element Type="LogicalBindingAttribute" OID="998b0274-2cf8-4749-b1c0-1a7c466f0e2b" ParentLink="PortDeclaration_CLRAttribute" LowerBound="14.1" HigherBound="15.1">
                    <om:Property Name="Signal" Value="False" />
                </om:Element>
            </om:Element>
        </om:Element>
        <om:Element Type="PortType" OID="ee3b614f-49b0-486f-a6f5-6163c7af5e67" ParentLink="Module_PortType" LowerBound="4.1" HigherBound="11.1">
            <om:Property Name="Synchronous" Value="True" />
            <om:Property Name="TypeModifier" Value="Internal" />
            <om:Property Name="ReportToAnalyst" Value="True" />
            <om:Property Name="Name" Value="GetOrderPortType" />
            <om:Property Name="Signal" Value="True" />
            <om:Element Type="OperationDeclaration" OID="77f110e4-38ae-41ef-b7bd-f3b6bb520b91" ParentLink="PortType_OperationDeclaration" LowerBound="6.1" HigherBound="10.1">
                <om:Property Name="OperationType" Value="RequestResponse" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="Operation_GetOrder" />
                <om:Property Name="Signal" Value="True" />
                <om:Element Type="MessageRef" OID="a3fa9221-4942-44f4-b3b3-72893ba56d07" ParentLink="OperationDeclaration_FaultMessageRef" LowerBound="8.146" HigherBound="8.233">
                    <om:Property Name="Ref" Value="Microsoft.Samples.BizTalk.Litware.Schemas.OrderSystem.SystemFaultMessage" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="SystemFault" />
                    <om:Property Name="Signal" Value="True" />
                </om:Element>
                <om:Element Type="MessageRef" OID="fdbdbfa7-2e89-496b-bd77-a57abf0cc97d" ParentLink="OperationDeclaration_ResponseMessageRef" LowerBound="8.82" HigherBound="8.144">
                    <om:Property Name="Ref" Value="Microsoft.Samples.BizTalk.Litware.Schemas.Order.PurchaseOrder" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="Response" />
                    <om:Property Name="Signal" Value="True" />
                </om:Element>
                <om:Element Type="MessageRef" OID="2512c929-1f67-480b-99e8-2232072fe4e2" ParentLink="OperationDeclaration_RequestMessageRef" LowerBound="8.13" HigherBound="8.80">
                    <om:Property Name="Ref" Value="Microsoft.Samples.BizTalk.Litware.Schemas.OrderSystem.OrderInquiry" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="Request" />
                    <om:Property Name="Signal" Value="True" />
                </om:Element>
            </om:Element>
        </om:Element>
    </om:Element>
</om:MetaModel>
#endif // __DESIGNER_DATA
[Microsoft.XLANGs.BaseTypes.BPELExportable(false)]
module Microsoft.Samples.BizTalk.Litware.Orchestrations
{
    internal porttype GetOrderPortType
    {
        requestresponse Operation_GetOrder
        {
            Microsoft.Samples.BizTalk.Litware.Schemas.OrderSystem.OrderInquiry, Microsoft.Samples.BizTalk.Litware.Schemas.Order.PurchaseOrder, SystemFault = Microsoft.Samples.BizTalk.Litware.Schemas.OrderSystem.SystemFaultMessage
        };
    };
    [Microsoft.XLANGs.BaseTypes.BPELExportable(false)]
    internal service GetPurchaseOrder
    {
        [Microsoft.XLANGs.BaseTypes.LogicalBinding()]
        port uses GetOrderPortType GetOrderPort;
        message Microsoft.Samples.BizTalk.Litware.Schemas.OrderSystem.OrderInquiry RequestMessage;
        System.Int32 retryCount;
        body (System.String brokerID, System.String orderID, out message Microsoft.Samples.BizTalk.Litware.Schemas.Order.PurchaseOrder OrderMessage, ref System.Boolean bFailure)
        {
            retryCount = 0;
            [Microsoft.XLANGs.BaseTypes.DesignerPosition("c1a73359-e4f0-404f-905d-55e6a7d797bf")]
            construct OrderMessage
            {
                [Microsoft.XLANGs.BaseTypes.DesignerPosition("e757ebfa-64cb-4be9-8aa2-cd0ee861dd76")]
                OrderMessage = Microsoft.Samples.BizTalk.Litware.Utilities.ResourceHelper.GetEmptyOrderMessage();
            }
            [Microsoft.XLANGs.BaseTypes.DesignerPosition("8e40e678-8f13-47f3-8514-02a64e1159f5")]
            construct RequestMessage
            {
                [Microsoft.XLANGs.BaseTypes.DesignerPosition("6eed853a-5182-483a-92a3-82a0a74d55c8")]
                transform (RequestMessage) = Microsoft.Samples.BizTalk.Litware.Maps.PurchaseOrder_To_Inquiry (OrderMessage);
                [Microsoft.XLANGs.BaseTypes.DesignerPosition("baf94d6e-e199-47d6-b48b-09ff6d1efe2a")]
                RequestMessage.Request.OrderGroupId = orderID;
                RequestMessage.Request.SoldToName = brokerID;
                RequestMessage(Microsoft.Samples.BizTalk.Litware.Schemas.ReturnPOXML) = true;
            }
            [Microsoft.XLANGs.BaseTypes.DesignerPosition("672dde37-c7e1-406e-b288-e008b7cb3756")]
            while (retryCount < 3)
            {
                [Microsoft.XLANGs.BaseTypes.DesignerPosition("56503026-692d-48d4-b0d0-d93c41836e20")]
                scope
                {
                    body
                    {
                        [Microsoft.XLANGs.BaseTypes.DesignerPosition("0427c438-7b2f-4aba-90fd-2ca7fe097300")]
                        send (GetOrderPort.Operation_GetOrder, RequestMessage);
                        [Microsoft.XLANGs.BaseTypes.DesignerPosition("9eab0b3c-9f0a-4fde-80c7-1c86013bc08e")]
                        receive (GetOrderPort.Operation_GetOrder, OrderMessage);
                        [Microsoft.XLANGs.BaseTypes.DesignerPosition("588a375d-b410-4fac-9276-c0b50b4cef01")]
                        retryCount = 3;
                    }
                    exceptions
                    {
                        [Microsoft.XLANGs.BaseTypes.DesignerPosition("dcda201d-aa9e-4ee9-abdc-4950c47a897d")]
                        catch (GetOrderPort.Operation_GetOrder.SystemFault OrderSystemSystemFault)
                        {
                            [Microsoft.XLANGs.BaseTypes.DesignerPosition("e6f3e3a0-2e69-431a-a295-0299bcc6473f")]
                            retryCount = retryCount + 1;
                            [Microsoft.XLANGs.BaseTypes.DesignerPosition("a4e666fa-9f67-47c9-9b99-fc58a7fb66cc")]
                            if (retryCount < 3)
                            {
                                [Microsoft.XLANGs.BaseTypes.DesignerPosition("99258df7-a1a3-4088-81cf-c06227488e3c")]
                                System.Diagnostics.EventLog.WriteEntry("Litware Scenario", "Failed to get order " + orderID + " for user " + brokerID + ". Orchestration suspended due to error " + OrderSystemSystemFault.Message, System.Diagnostics.EventLogEntryType.Warning);
                                [Microsoft.XLANGs.BaseTypes.DesignerPosition("09a86953-05fe-4b4f-bab1-6b89ea17cdc5")]
                                suspend "Please verify why we failed to get order.";
                            }
                            else 
                            {
                                [Microsoft.XLANGs.BaseTypes.DesignerPosition("c6eb33cc-949e-45e7-b22a-d523dc21ad5c")]
                                System.Diagnostics.EventLog.WriteEntry("Litware Scenario", "Failed to get order " + orderID + " for user " + brokerID + ". Orchestration suspended due to error " + OrderSystemSystemFault.Message, System.Diagnostics.EventLogEntryType.Error);
                                [Microsoft.XLANGs.BaseTypes.DesignerPosition("28d502eb-2940-47ca-ad54-a526e471aa3f")]
                                bFailure = true;
                            }
                        }
                        [Microsoft.XLANGs.BaseTypes.DesignerPosition("86dcdba5-854a-4b4b-b765-3e8bf5151e5f")]
                        catch (System.Exception exp)
                        {
                            [Microsoft.XLANGs.BaseTypes.DesignerPosition("9f52d105-c81f-4f4e-81e6-e29c77915a20")]
                            retryCount = retryCount + 1;
                            [Microsoft.XLANGs.BaseTypes.DesignerPosition("7163dd5b-39e3-4a99-bb66-9cc037357771")]
                            if (retryCount < 3)
                            {
                                [Microsoft.XLANGs.BaseTypes.DesignerPosition("e2de675b-03d0-4b79-b5c9-990c6c917918")]
                                System.Diagnostics.EventLog.WriteEntry("Litware Scenario", "Failed to get order " + orderID + " for user " + brokerID + ". Orchestration suspended due to error " + exp.Message, System.Diagnostics.EventLogEntryType.Warning);
                                [Microsoft.XLANGs.BaseTypes.DesignerPosition("0e569111-4e56-4d0f-b9d1-f75a43b67cbb")]
                                suspend "Please verify why we failed to get order.";
                            }
                            else 
                            {
                                [Microsoft.XLANGs.BaseTypes.DesignerPosition("a081db9f-7310-4bb1-b29a-768d72a143f9")]
                                System.Diagnostics.EventLog.WriteEntry("Litware Scenario", "Failed to get order " + orderID + " for user " + brokerID + ". Orchestration suspended due to error " + exp.Message, System.Diagnostics.EventLogEntryType.Error);
                                [Microsoft.XLANGs.BaseTypes.DesignerPosition("cfcd2c58-ccda-4ccf-8be7-610b50b899d2")]
                                bFailure = true;
                            }
                        }
                    }
                }
            }
        }
    }
}

