#if __DESIGNER_DATA
#error Do not define __DESIGNER_DATA.
<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<om:MetaModel MajorVersion="1" MinorVersion="3" Core="2b131234-7959-458d-834f-2dc0769ce683" ScheduleModel="66366196-361d-448d-976f-cab5e87496d2" xmlns:om="http://schemas.microsoft.com/BizTalk/2003/DesignerData">
    <om:Element Type="Module" OID="1c5b1ac5-2f24-4e6d-bf62-6c52fa5020b7" LowerBound="1.1" HigherBound="174.1">
        <om:Property Name="ReportToAnalyst" Value="True" />
        <om:Property Name="Name" Value="Microsoft.Samples.BizTalk.Litware.Orchestrations" />
        <om:Property Name="Signal" Value="False" />
        <om:Element Type="PortType" OID="54807df3-ff39-41c0-9c33-f19d8fffec17" ParentLink="Module_PortType" LowerBound="4.1" HigherBound="11.1">
            <om:Property Name="Synchronous" Value="False" />
            <om:Property Name="TypeModifier" Value="Public" />
            <om:Property Name="ReportToAnalyst" Value="True" />
            <om:Property Name="Name" Value="RecvPOChgType" />
            <om:Property Name="Signal" Value="True" />
            <om:Element Type="OperationDeclaration" OID="001ed285-c7a2-4e8b-bfca-772a25a8fffa" ParentLink="PortType_OperationDeclaration" LowerBound="6.1" HigherBound="10.1">
                <om:Property Name="OperationType" Value="OneWay" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="RecvPOOp" />
                <om:Property Name="Signal" Value="True" />
                <om:Element Type="MessageRef" OID="04afe9f2-8f56-4611-a6d4-e41014cb61bd" ParentLink="OperationDeclaration_RequestMessageRef" LowerBound="8.13" HigherBound="8.74">
                    <om:Property Name="Ref" Value="Microsoft.Samples.BizTalk.Litware.Schemas.Order.PurchaseOrder" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="Request" />
                    <om:Property Name="Signal" Value="False" />
                </om:Element>
            </om:Element>
        </om:Element>
        <om:Element Type="PortType" OID="9e62546e-4277-430d-8a55-0b024e97de2d" ParentLink="Module_PortType" LowerBound="11.1" HigherBound="18.1">
            <om:Property Name="Synchronous" Value="True" />
            <om:Property Name="TypeModifier" Value="Internal" />
            <om:Property Name="ReportToAnalyst" Value="True" />
            <om:Property Name="Name" Value="SendOrderInquiryType" />
            <om:Property Name="Signal" Value="False" />
            <om:Element Type="OperationDeclaration" OID="ab93b6b2-77bc-42c6-b579-4bddc8207701" ParentLink="PortType_OperationDeclaration" LowerBound="13.1" HigherBound="17.1">
                <om:Property Name="OperationType" Value="RequestResponse" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="OrderInquiryOp" />
                <om:Property Name="Signal" Value="True" />
                <om:Element Type="MessageRef" OID="a67b236c-17b3-460f-9b6f-d6083dbf8bf2" ParentLink="OperationDeclaration_RequestMessageRef" LowerBound="15.13" HigherBound="15.79">
                    <om:Property Name="Ref" Value="Microsoft.Samples.BizTalk.Litware.Schemas.OrderSystem.OrderInquiry" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="Request" />
                    <om:Property Name="Signal" Value="False" />
                </om:Element>
                <om:Element Type="MessageRef" OID="2e7f82a0-0e43-43a6-b261-9c79d5e4bbec" ParentLink="OperationDeclaration_ResponseMessageRef" LowerBound="15.81" HigherBound="15.147">
                    <om:Property Name="Ref" Value="Microsoft.Samples.BizTalk.Litware.Schemas.OrderSystem.OrderInquiry" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="Response" />
                    <om:Property Name="Signal" Value="False" />
                </om:Element>
            </om:Element>
        </om:Element>
        <om:Element Type="PortType" OID="e7a9f3f1-fddb-4c81-a670-8849ae444585" ParentLink="Module_PortType" LowerBound="18.1" HigherBound="25.1">
            <om:Property Name="Synchronous" Value="True" />
            <om:Property Name="TypeModifier" Value="Internal" />
            <om:Property Name="ReportToAnalyst" Value="True" />
            <om:Property Name="Name" Value="SendOrderChgType" />
            <om:Property Name="Signal" Value="False" />
            <om:Element Type="OperationDeclaration" OID="8d403f16-c888-4729-9c0d-18d74118ba48" ParentLink="PortType_OperationDeclaration" LowerBound="20.1" HigherBound="24.1">
                <om:Property Name="OperationType" Value="RequestResponse" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="SendOrderChgOp" />
                <om:Property Name="Signal" Value="True" />
                <om:Element Type="MessageRef" OID="9fb67ea6-8481-4df9-9a58-96c18a305969" ParentLink="OperationDeclaration_RequestMessageRef" LowerBound="22.13" HigherBound="22.74">
                    <om:Property Name="Ref" Value="Microsoft.Samples.BizTalk.Litware.Schemas.Order.PurchaseOrder" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="Request" />
                    <om:Property Name="Signal" Value="False" />
                </om:Element>
                <om:Element Type="MessageRef" OID="042aa91d-79fc-4505-bc25-d1c9d4f2202b" ParentLink="OperationDeclaration_ResponseMessageRef" LowerBound="22.76" HigherBound="22.138">
                    <om:Property Name="Ref" Value="Microsoft.Samples.BizTalk.Litware.Schemas.OrderSystem.OrderAck" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="Response" />
                    <om:Property Name="Signal" Value="False" />
                </om:Element>
                <om:Element Type="MessageRef" OID="07144651-7763-4ea6-ba19-4caa41d4cfac" ParentLink="OperationDeclaration_FaultMessageRef" LowerBound="22.140" HigherBound="22.231">
                    <om:Property Name="Ref" Value="Microsoft.Samples.BizTalk.Litware.Schemas.OrderSystem.BusinessFaultMessage" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="BusinessrFault" />
                    <om:Property Name="Signal" Value="True" />
                </om:Element>
                <om:Element Type="MessageRef" OID="975b2d9d-adcd-425c-95ac-ea802d52f554" ParentLink="OperationDeclaration_FaultMessageRef" LowerBound="22.233" HigherBound="22.319">
                    <om:Property Name="Ref" Value="Microsoft.Samples.BizTalk.Litware.Schemas.OrderSystem.SystemFaultMessage" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="SystemFault" />
                    <om:Property Name="Signal" Value="True" />
                </om:Element>
            </om:Element>
        </om:Element>
        <om:Element Type="ServiceDeclaration" OID="d0f3b0b1-347c-4b6c-b65f-0641fc2e830b" ParentLink="Module_ServiceDeclaration" LowerBound="32.1" HigherBound="173.1">
            <om:Property Name="InitializedTransactionType" Value="False" />
            <om:Property Name="IsInvokable" Value="False" />
            <om:Property Name="TypeModifier" Value="Internal" />
            <om:Property Name="ReportToAnalyst" Value="True" />
            <om:Property Name="Name" Value="UpdateOrder" />
            <om:Property Name="Signal" Value="True" />
            <om:Element Type="VariableDeclaration" OID="ef8559c3-c4f4-430f-bfc3-af2643542baf" ParentLink="ServiceDeclaration_VariableDeclaration" LowerBound="42.1" HigherBound="43.1">
                <om:Property Name="UseDefaultConstructor" Value="False" />
                <om:Property Name="Type" Value="System.String" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="partnerName" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="VariableDeclaration" OID="c0f40945-9694-48e6-b2ab-28fcf96dd327" ParentLink="ServiceDeclaration_VariableDeclaration" LowerBound="43.1" HigherBound="44.1">
                <om:Property Name="UseDefaultConstructor" Value="False" />
                <om:Property Name="Type" Value="System.String" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="errMsg" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="VariableDeclaration" OID="6c1917df-5216-4990-bd0e-4eccea2781f7" ParentLink="ServiceDeclaration_VariableDeclaration" LowerBound="44.1" HigherBound="45.1">
                <om:Property Name="UseDefaultConstructor" Value="False" />
                <om:Property Name="Type" Value="System.String" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="soldToName" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="VariableDeclaration" OID="349f6624-a3c7-4ee5-a009-58deea0b5111" ParentLink="ServiceDeclaration_VariableDeclaration" LowerBound="45.1" HigherBound="46.1">
                <om:Property Name="InitialValue" Value="true" />
                <om:Property Name="UseDefaultConstructor" Value="False" />
                <om:Property Name="Type" Value="System.Boolean" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="result" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="VariableDeclaration" OID="b0e69392-6418-4289-bbb3-3a841b8d99c6" ParentLink="ServiceDeclaration_VariableDeclaration" LowerBound="46.1" HigherBound="47.1">
                <om:Property Name="InitialValue" Value="0" />
                <om:Property Name="UseDefaultConstructor" Value="False" />
                <om:Property Name="Type" Value="System.Int32" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="retryCount" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="VariableDeclaration" OID="7121cfda-8751-41bb-b6ff-78493af5db7e" ParentLink="ServiceDeclaration_VariableDeclaration" LowerBound="47.1" HigherBound="48.1">
                <om:Property Name="UseDefaultConstructor" Value="False" />
                <om:Property Name="Type" Value="System.String" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="destination" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="VariableDeclaration" OID="7654317d-6e2d-4119-b2ea-e7e4f6a938b9" ParentLink="ServiceDeclaration_VariableDeclaration" LowerBound="48.1" HigherBound="49.1">
                <om:Property Name="UseDefaultConstructor" Value="False" />
                <om:Property Name="Type" Value="Microsoft.XLANGs.BaseTypes.Party" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="partner" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="VariableDeclaration" OID="14019885-fa4f-4be8-ae00-002a62b3bbca" ParentLink="ServiceDeclaration_VariableDeclaration" LowerBound="49.1" HigherBound="50.1">
                <om:Property Name="InitialValue" Value="false" />
                <om:Property Name="UseDefaultConstructor" Value="False" />
                <om:Property Name="Type" Value="System.Boolean" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="bInquiryStatus" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="ServiceLinkDeclaration" OID="a5013ae7-4cf9-40c8-9e89-250060e8aa5c" ParentLink="ServiceDeclaration_ServiceLinkDeclaration" LowerBound="35.1" HigherBound="36.1">
                <om:Property Name="Orientation" Value="Left" />
                <om:Property Name="PortIndex" Value="0" />
                <om:Property Name="PortModifier" Value="Implements" />
                <om:Property Name="RoleName" Value="RequestRole" />
                <om:Property Name="OrderedDelivery" Value="False" />
                <om:Property Name="DeliveryNotification" Value="None" />
                <om:Property Name="Type" Value="Microsoft.Samples.BizTalk.Litware.Orchestrations.UpdatePORoleLinkType" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="POChangeRoleLink" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="MessageDeclaration" OID="1b833ecc-a7b3-4b7d-91df-3bf5b55ec2c5" ParentLink="ServiceDeclaration_MessageDeclaration" LowerBound="38.1" HigherBound="39.1">
                <om:Property Name="Type" Value="Microsoft.Samples.BizTalk.Litware.Schemas.Order.PurchaseOrder" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="POChgMsg" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="MessageDeclaration" OID="4e3f8577-f7b1-400b-bdbc-1f9c54e376c8" ParentLink="ServiceDeclaration_MessageDeclaration" LowerBound="39.1" HigherBound="40.1">
                <om:Property Name="Type" Value="Microsoft.Samples.BizTalk.Litware.Schemas.OrderSystem.OrderInquiry" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="InquiryMsg" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="MessageDeclaration" OID="c06f9dfa-4a2c-421b-897e-7ed99a499fd7" ParentLink="ServiceDeclaration_MessageDeclaration" LowerBound="40.1" HigherBound="41.1">
                <om:Property Name="Type" Value="Microsoft.Samples.BizTalk.Litware.Schemas.OrderSystem.OrderAck" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="UpdateAck" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="MessageDeclaration" OID="4f74b716-d8c6-471f-83cd-d300445a2635" ParentLink="ServiceDeclaration_MessageDeclaration" LowerBound="41.1" HigherBound="42.1">
                <om:Property Name="Type" Value="Microsoft.Samples.BizTalk.Litware.Schemas.TPM.Partner.PartnerObject" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="ProfileMsg" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="ServiceBody" OID="85de4b3a-6104-4dde-882f-1bcf350e7f38" ParentLink="ServiceDeclaration_ServiceBody">
                <om:Property Name="Signal" Value="False" />
                <om:Element Type="Receive" OID="4768db85-ce6e-4ee6-b3ba-a1863a0a4cdd" ParentLink="ServiceBody_Statement" LowerBound="52.1" HigherBound="61.1">
                    <om:Property Name="Activate" Value="True" />
                    <om:Property Name="MessageName" Value="POChgMsg" />
                    <om:Property Name="OperationName" Value="RecvPOOp" />
                    <om:Property Name="OperationMessageName" Value="Request" />
                    <om:Property Name="ServiceLinkName" Value="POChangeRoleLink" />
                    <om:Property Name="ServiceLinkPortTypeName" Value="Microsoft.Samples.BizTalk.Litware.Orchestrations.RecvPOChgType" />
                    <om:Property Name="ServiceLinkRoleName" Value="RequestRole" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="Recv PO Chg" />
                    <om:Property Name="Signal" Value="True" />
                </om:Element>
                <om:Element Type="VariableAssignment" OID="58913a90-cd59-4abd-989f-12dd01d62b52" ParentLink="ServiceBody_Statement" LowerBound="61.1" HigherBound="67.1">
                    <om:Property Name="Expression" Value="//partnerName = POChgMsg(MessageTracking.PartyName);&#xD;&#xA;partner = POChangeRoleLink(Microsoft.XLANGs.BaseTypes.SourceParty);&#xD;&#xA;partnerName = partner.Name;&#xD;&#xA;soldToName = POChgMsg(Microsoft.Samples.BizTalk.Litware.Schemas.SoldToName);&#xD;&#xA;&#xD;&#xA;" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="Get Sender Info" />
                    <om:Property Name="Signal" Value="False" />
                </om:Element>
                <om:Element Type="Decision" OID="25c4b12b-e3c8-4cc0-8376-f8fa06bc5dbb" ParentLink="ServiceBody_Statement" LowerBound="67.1" HigherBound="171.1">
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="Is Sender Valid" />
                    <om:Property Name="Signal" Value="True" />
                    <om:Element Type="DecisionBranch" OID="663ed021-d089-4832-a514-fe4322ea3790" ParentLink="ReallyComplexStatement_Branch" LowerBound="68.13" HigherBound="165.1">
                        <om:Property Name="Expression" Value="partnerName == soldToName" />
                        <om:Property Name="IsGhostBranch" Value="True" />
                        <om:Property Name="ReportToAnalyst" Value="True" />
                        <om:Property Name="Name" Value="Valid Sender" />
                        <om:Property Name="Signal" Value="True" />
                        <om:Element Type="Task" OID="25ad14e6-88e0-4850-b697-5b7e0a19ad72" ParentLink="ComplexStatement_Statement" LowerBound="70.1" HigherBound="78.1">
                            <om:Property Name="ReportToAnalyst" Value="True" />
                            <om:Property Name="Name" Value="Check PO Existance" />
                            <om:Property Name="Signal" Value="True" />
                            <om:Element Type="Construct" OID="563c1c14-96bb-4612-bd96-1871b059a5ec" ParentLink="ComplexStatement_Statement" LowerBound="70.1" HigherBound="76.1">
                                <om:Property Name="ReportToAnalyst" Value="True" />
                                <om:Property Name="Name" Value="Construct Inquiry" />
                                <om:Property Name="Signal" Value="True" />
                                <om:Element Type="Transform" OID="e1315a05-c8db-4e85-87b0-1481f2cfec67" ParentLink="ComplexStatement_Statement" LowerBound="73.1" HigherBound="75.1">
                                    <om:Property Name="ClassName" Value="Microsoft.Samples.BizTalk.Litware.Maps.PurchaseOrder_To_Inquiry" />
                                    <om:Property Name="ReportToAnalyst" Value="True" />
                                    <om:Property Name="Name" Value="POChg X Inquiry" />
                                    <om:Property Name="Signal" Value="False" />
                                    <om:Element Type="MessagePartRef" OID="e4e5a7e1-8935-48bc-8d72-91e1baf6e508" ParentLink="Transform_InputMessagePartRef" LowerBound="74.111" HigherBound="74.119">
                                        <om:Property Name="MessageRef" Value="POChgMsg" />
                                        <om:Property Name="ReportToAnalyst" Value="True" />
                                        <om:Property Name="Name" Value="MessagePartReference_1" />
                                        <om:Property Name="Signal" Value="False" />
                                    </om:Element>
                                    <om:Element Type="MessagePartRef" OID="33ee18a2-23c6-4ec7-9ba6-7fc9ddb63d8f" ParentLink="Transform_OutputMessagePartRef" LowerBound="74.32" HigherBound="74.42">
                                        <om:Property Name="MessageRef" Value="InquiryMsg" />
                                        <om:Property Name="ReportToAnalyst" Value="True" />
                                        <om:Property Name="Name" Value="MessagePartReference_2" />
                                        <om:Property Name="Signal" Value="False" />
                                    </om:Element>
                                </om:Element>
                                <om:Element Type="MessageRef" OID="a05d2af0-d638-41ba-8dc3-8ef6a1ffc67f" ParentLink="Construct_MessageRef" LowerBound="71.27" HigherBound="71.37">
                                    <om:Property Name="Ref" Value="InquiryMsg" />
                                    <om:Property Name="ReportToAnalyst" Value="True" />
                                    <om:Property Name="Signal" Value="False" />
                                </om:Element>
                            </om:Element>
                            <om:Element Type="Call" OID="81071b02-e4a8-40dd-8a74-fa00176b9721" ParentLink="ComplexStatement_Statement" LowerBound="76.1" HigherBound="78.1">
                                <om:Property Name="Identifier" Value="CallOrchestration_1" />
                                <om:Property Name="Invokee" Value="Microsoft.Samples.BizTalk.Litware.Orchestrations.CheckOrderExists" />
                                <om:Property Name="ReportToAnalyst" Value="True" />
                                <om:Property Name="Name" Value="CheckOrderExists" />
                                <om:Property Name="Signal" Value="True" />
                                <om:Element Type="Parameter" OID="b9f9b969-588a-46ad-896c-1001097c842f" ParentLink="InvokeStatement_Parameter">
                                    <om:Property Name="Direction" Value="In" />
                                    <om:Property Name="Name" Value="InquiryMsg" />
                                    <om:Property Name="Type" Value="Microsoft.Samples.BizTalk.Litware.Schemas.OrderSystem.OrderInquiry" />
                                    <om:Property Name="Signal" Value="False" />
                                </om:Element>
                                <om:Element Type="Parameter" OID="e83c5e6c-8d7c-47c0-9778-d9c28ade218e" ParentLink="InvokeStatement_Parameter">
                                    <om:Property Name="Direction" Value="Ref" />
                                    <om:Property Name="Name" Value="bInquiryStatus" />
                                    <om:Property Name="Type" Value="System.Boolean" />
                                    <om:Property Name="Signal" Value="False" />
                                </om:Element>
                            </om:Element>
                        </om:Element>
                        <om:Element Type="Decision" OID="a754e36b-bd19-4b3a-b72f-ee89c34fa682" ParentLink="ComplexStatement_Statement" LowerBound="78.1" HigherBound="164.1">
                            <om:Property Name="ReportToAnalyst" Value="True" />
                            <om:Property Name="Name" Value="Is PO Exist" />
                            <om:Property Name="Signal" Value="True" />
                            <om:Element Type="DecisionBranch" OID="217b6cd4-bcc9-4338-a863-0b38f9275df2" ParentLink="ReallyComplexStatement_Branch" LowerBound="79.17" HigherBound="158.1">
                                <om:Property Name="Expression" Value="bInquiryStatus == true" />
                                <om:Property Name="IsGhostBranch" Value="True" />
                                <om:Property Name="ReportToAnalyst" Value="True" />
                                <om:Property Name="Name" Value="PO Exist" />
                                <om:Property Name="Signal" Value="False" />
                                <om:Element Type="While" OID="ea2bd1fe-a671-411f-83f6-17299097caa2" ParentLink="ComplexStatement_Statement" LowerBound="81.1" HigherBound="149.1">
                                    <om:Property Name="Expression" Value="retryCount &lt; 3" />
                                    <om:Property Name="ReportToAnalyst" Value="True" />
                                    <om:Property Name="Name" Value="Retry Update" />
                                    <om:Property Name="Signal" Value="False" />
                                    <om:Element Type="Scope" OID="d39b5e3c-2069-4509-8cda-65f6cd67eb95" ParentLink="ComplexStatement_Statement" LowerBound="84.1" HigherBound="148.1">
                                        <om:Property Name="InitializedTransactionType" Value="True" />
                                        <om:Property Name="IsSynchronized" Value="False" />
                                        <om:Property Name="ReportToAnalyst" Value="True" />
                                        <om:Property Name="Name" Value="Update PO" />
                                        <om:Property Name="Signal" Value="True" />
                                        <om:Element Type="Send" OID="38e93a95-4105-4242-b25a-fb403787d7cc" ParentLink="ComplexStatement_Statement" LowerBound="89.1" HigherBound="91.1">
                                            <om:Property Name="PortName" Value="SendOrderChg" />
                                            <om:Property Name="MessageName" Value="POChgMsg" />
                                            <om:Property Name="OperationName" Value="SendOrderChgOp" />
                                            <om:Property Name="OperationMessageName" Value="Request" />
                                            <om:Property Name="ReportToAnalyst" Value="True" />
                                            <om:Property Name="Name" Value="Send PO Chg" />
                                            <om:Property Name="Signal" Value="True" />
                                        </om:Element>
                                        <om:Element Type="Receive" OID="0a65c6f7-fa00-4c7c-ae71-85cd708b8419" ParentLink="ComplexStatement_Statement" LowerBound="91.1" HigherBound="93.1">
                                            <om:Property Name="Activate" Value="False" />
                                            <om:Property Name="PortName" Value="SendOrderChg" />
                                            <om:Property Name="MessageName" Value="UpdateAck" />
                                            <om:Property Name="OperationName" Value="SendOrderChgOp" />
                                            <om:Property Name="OperationMessageName" Value="Response" />
                                            <om:Property Name="ReportToAnalyst" Value="True" />
                                            <om:Property Name="Name" Value="Recv Ack" />
                                            <om:Property Name="Signal" Value="True" />
                                        </om:Element>
                                        <om:Element Type="VariableAssignment" OID="947e5f61-3a83-4a5c-aa16-985bf85c0cfb" ParentLink="ComplexStatement_Statement" LowerBound="93.1" HigherBound="95.1">
                                            <om:Property Name="Expression" Value="retryCount = 3;" />
                                            <om:Property Name="ReportToAnalyst" Value="True" />
                                            <om:Property Name="Name" Value="Break Loop" />
                                            <om:Property Name="Signal" Value="False" />
                                        </om:Element>
                                        <om:Element Type="Catch" OID="eadf9268-754d-4ae3-bf14-b14e552c43fe" ParentLink="Scope_Catch" LowerBound="98.1" HigherBound="104.1">
                                            <om:Property Name="ExceptionName" Value="OrderSystemBusinessException" />
                                            <om:Property Name="ExceptionType" Value="SendOrderChg.SendOrderChgOp.BusinessrFault" />
                                            <om:Property Name="IsFaultMessage" Value="False" />
                                            <om:Property Name="ReportToAnalyst" Value="True" />
                                            <om:Property Name="Name" Value="OrderSystemBusinessException" />
                                            <om:Property Name="Signal" Value="True" />
                                            <om:Element Type="Terminate" OID="4df1fd54-4e0e-4987-a3d1-351415cc619b" ParentLink="Catch_Statement" LowerBound="101.1" HigherBound="103.1">
                                                <om:Property Name="ErrorMessage" Value="OrderSystemBusinessException.Message;" />
                                                <om:Property Name="ReportToAnalyst" Value="True" />
                                                <om:Property Name="Name" Value="Terminate Update" />
                                                <om:Property Name="Signal" Value="False" />
                                            </om:Element>
                                        </om:Element>
                                        <om:Element Type="Catch" OID="d53ec575-6bd1-4c2a-9ec1-2e008a5aa152" ParentLink="Scope_Catch" LowerBound="104.1" HigherBound="125.1">
                                            <om:Property Name="ExceptionName" Value="OrderSystemSystemException" />
                                            <om:Property Name="ExceptionType" Value="SendOrderChg.SendOrderChgOp.SystemFault" />
                                            <om:Property Name="IsFaultMessage" Value="False" />
                                            <om:Property Name="ReportToAnalyst" Value="True" />
                                            <om:Property Name="Name" Value="OrderSystemSystemException" />
                                            <om:Property Name="Signal" Value="True" />
                                            <om:Element Type="VariableAssignment" OID="1509061c-5cee-4292-87fb-a7faac4501a6" ParentLink="Catch_Statement" LowerBound="107.1" HigherBound="109.1">
                                                <om:Property Name="Expression" Value="retryCount = retryCount + 1;" />
                                                <om:Property Name="ReportToAnalyst" Value="True" />
                                                <om:Property Name="Name" Value="Inc Retry Count" />
                                                <om:Property Name="Signal" Value="False" />
                                            </om:Element>
                                            <om:Element Type="Decision" OID="1e34dbdd-94da-4f6a-a66d-0c4e4ca76c1a" ParentLink="Catch_Statement" LowerBound="109.1" HigherBound="124.1">
                                                <om:Property Name="ReportToAnalyst" Value="True" />
                                                <om:Property Name="Name" Value="Check Retry Count" />
                                                <om:Property Name="Signal" Value="True" />
                                                <om:Element Type="DecisionBranch" OID="a0308a89-0b95-4af9-b8ee-e7cdb78b4b24" ParentLink="ReallyComplexStatement_Branch" LowerBound="110.37" HigherBound="117.1">
                                                    <om:Property Name="Expression" Value="retryCount &lt; 3" />
                                                    <om:Property Name="IsGhostBranch" Value="True" />
                                                    <om:Property Name="ReportToAnalyst" Value="True" />
                                                    <om:Property Name="Name" Value="All Failed" />
                                                    <om:Property Name="Signal" Value="False" />
                                                    <om:Element Type="VariableAssignment" OID="e76e13bd-6cd3-44c9-966e-fd6a11867836" ParentLink="ComplexStatement_Statement" LowerBound="112.1" HigherBound="114.1">
                                                        <om:Property Name="Expression" Value="System.Diagnostics.EventLog.WriteEntry(&quot;Litware Scenario&quot;, &quot;Failed to update order in order system. Orchestration suspended.&quot; + OrderSystemSystemException.Message, System.Diagnostics.EventLogEntryType.Warning);" />
                                                        <om:Property Name="ReportToAnalyst" Value="True" />
                                                        <om:Property Name="Name" Value="Log Susp Error" />
                                                        <om:Property Name="Signal" Value="True" />
                                                    </om:Element>
                                                    <om:Element Type="Suspend" OID="c2244489-7d57-444d-a91d-56563eb48b24" ParentLink="ComplexStatement_Statement" LowerBound="114.1" HigherBound="116.1">
                                                        <om:Property Name="ErrorMessage" Value="OrderSystemSystemException.Message;" />
                                                        <om:Property Name="ReportToAnalyst" Value="True" />
                                                        <om:Property Name="Name" Value="Suspend Update" />
                                                        <om:Property Name="Signal" Value="False" />
                                                    </om:Element>
                                                </om:Element>
                                                <om:Element Type="DecisionBranch" OID="4a3debb6-f9c8-44ba-a08e-a70f68eebaac" ParentLink="ReallyComplexStatement_Branch">
                                                    <om:Property Name="IsGhostBranch" Value="True" />
                                                    <om:Property Name="ReportToAnalyst" Value="True" />
                                                    <om:Property Name="Name" Value="Else" />
                                                    <om:Property Name="Signal" Value="False" />
                                                    <om:Element Type="VariableAssignment" OID="12763700-d26f-43ae-82cc-494cb43dd670" ParentLink="ComplexStatement_Statement" LowerBound="119.1" HigherBound="121.1">
                                                        <om:Property Name="Expression" Value="System.Diagnostics.EventLog.WriteEntry(&quot;Litware Scenario&quot;, &quot;Failed to update order to order system after several retries. Orchestration Terminated.&quot; + OrderSystemSystemException.Message, System.Diagnostics.EventLogEntryType.Warning);" />
                                                        <om:Property Name="ReportToAnalyst" Value="True" />
                                                        <om:Property Name="Name" Value="Log Term Error" />
                                                        <om:Property Name="Signal" Value="True" />
                                                    </om:Element>
                                                    <om:Element Type="Terminate" OID="9fb0af01-8d6d-4dac-9d85-be13c59e4c7d" ParentLink="ComplexStatement_Statement" LowerBound="121.1" HigherBound="123.1">
                                                        <om:Property Name="ErrorMessage" Value="OrderSystemSystemException.Message;" />
                                                        <om:Property Name="ReportToAnalyst" Value="True" />
                                                        <om:Property Name="Name" Value="Terminate Update" />
                                                        <om:Property Name="Signal" Value="False" />
                                                    </om:Element>
                                                </om:Element>
                                            </om:Element>
                                        </om:Element>
                                        <om:Element Type="Catch" OID="2b96d038-65bb-48b4-a7df-33634b3c8b89" ParentLink="Scope_Catch" LowerBound="125.1" HigherBound="146.1">
                                            <om:Property Name="ExceptionName" Value="exp" />
                                            <om:Property Name="ExceptionType" Value="System.SystemException" />
                                            <om:Property Name="IsFaultMessage" Value="False" />
                                            <om:Property Name="ReportToAnalyst" Value="True" />
                                            <om:Property Name="Name" Value="Catch Exception" />
                                            <om:Property Name="Signal" Value="True" />
                                            <om:Element Type="VariableAssignment" OID="e7f370b3-23a6-4c97-a7c1-bd3f9904c10f" ParentLink="Catch_Statement" LowerBound="128.1" HigherBound="130.1">
                                                <om:Property Name="Expression" Value="retryCount = retryCount + 1;" />
                                                <om:Property Name="ReportToAnalyst" Value="True" />
                                                <om:Property Name="Name" Value="Inc Retry Count" />
                                                <om:Property Name="Signal" Value="False" />
                                            </om:Element>
                                            <om:Element Type="Decision" OID="94c1efe0-7c54-4813-9fec-69b24aef229a" ParentLink="Catch_Statement" LowerBound="130.1" HigherBound="145.1">
                                                <om:Property Name="ReportToAnalyst" Value="True" />
                                                <om:Property Name="Name" Value="Check Retry Count" />
                                                <om:Property Name="Signal" Value="True" />
                                                <om:Element Type="DecisionBranch" OID="425cdf3d-f89b-4227-9c95-a65d7a8f8981" ParentLink="ReallyComplexStatement_Branch" LowerBound="131.37" HigherBound="138.1">
                                                    <om:Property Name="Expression" Value="retryCount &lt; 3" />
                                                    <om:Property Name="IsGhostBranch" Value="True" />
                                                    <om:Property Name="ReportToAnalyst" Value="True" />
                                                    <om:Property Name="Name" Value="All Failed" />
                                                    <om:Property Name="Signal" Value="False" />
                                                    <om:Element Type="VariableAssignment" OID="210dbf59-d7a6-4e66-9dc3-48b0d4f506f3" ParentLink="ComplexStatement_Statement" LowerBound="133.1" HigherBound="135.1">
                                                        <om:Property Name="Expression" Value="System.Diagnostics.EventLog.WriteEntry(&quot;Litware Scenario&quot;, &quot;Failed to update order to order system. Orchestration suspended.&quot; + exp.Message, System.Diagnostics.EventLogEntryType.Warning);" />
                                                        <om:Property Name="ReportToAnalyst" Value="True" />
                                                        <om:Property Name="Name" Value="Log Susp Error" />
                                                        <om:Property Name="Signal" Value="False" />
                                                    </om:Element>
                                                    <om:Element Type="Suspend" OID="ff5db415-483b-4536-9a00-a6ff7c3ab571" ParentLink="ComplexStatement_Statement" LowerBound="135.1" HigherBound="137.1">
                                                        <om:Property Name="ErrorMessage" Value="exp.Message;" />
                                                        <om:Property Name="ReportToAnalyst" Value="True" />
                                                        <om:Property Name="Name" Value="Suspend Update" />
                                                        <om:Property Name="Signal" Value="False" />
                                                    </om:Element>
                                                </om:Element>
                                                <om:Element Type="DecisionBranch" OID="45543433-ff94-4a54-acbe-e612214def7f" ParentLink="ReallyComplexStatement_Branch">
                                                    <om:Property Name="IsGhostBranch" Value="True" />
                                                    <om:Property Name="ReportToAnalyst" Value="True" />
                                                    <om:Property Name="Name" Value="Else" />
                                                    <om:Property Name="Signal" Value="False" />
                                                    <om:Element Type="VariableAssignment" OID="eaf8d282-9eed-40da-b4cd-b2828bd81faa" ParentLink="ComplexStatement_Statement" LowerBound="140.1" HigherBound="142.1">
                                                        <om:Property Name="Expression" Value="System.Diagnostics.EventLog.WriteEntry(&quot;Litware Scenario&quot;, &quot;Failed to update order to order system after several retries. Orchestration Terminated.&quot; + exp.Message, System.Diagnostics.EventLogEntryType.Error);" />
                                                        <om:Property Name="ReportToAnalyst" Value="True" />
                                                        <om:Property Name="Name" Value="Log Term Error" />
                                                        <om:Property Name="Signal" Value="False" />
                                                    </om:Element>
                                                    <om:Element Type="Terminate" OID="6734684f-924e-4bb5-b9d1-b4772769b3b7" ParentLink="ComplexStatement_Statement" LowerBound="142.1" HigherBound="144.1">
                                                        <om:Property Name="ErrorMessage" Value="exp.Message;" />
                                                        <om:Property Name="ReportToAnalyst" Value="True" />
                                                        <om:Property Name="Name" Value="Terminate Update" />
                                                        <om:Property Name="Signal" Value="False" />
                                                    </om:Element>
                                                </om:Element>
                                            </om:Element>
                                        </om:Element>
                                    </om:Element>
                                </om:Element>
                                <om:Element Type="Call" OID="b7d88c6a-da3a-48b5-aba5-6af92cc693ef" ParentLink="ComplexStatement_Statement" LowerBound="149.1" HigherBound="151.1">
                                    <om:Property Name="Identifier" Value="VendorConfirm" />
                                    <om:Property Name="Invokee" Value="Microsoft.Samples.BizTalk.Litware.Orchestrations.ConfirmOrderWithVendors" />
                                    <om:Property Name="ReportToAnalyst" Value="True" />
                                    <om:Property Name="Name" Value="Vendor Confirm" />
                                    <om:Property Name="Signal" Value="False" />
                                    <om:Element Type="Parameter" OID="4be997cb-f48b-42d5-bec1-111964774938" ParentLink="InvokeStatement_Parameter">
                                        <om:Property Name="Direction" Value="In" />
                                        <om:Property Name="Name" Value="POChgMsg" />
                                        <om:Property Name="Type" Value="Microsoft.Samples.BizTalk.Litware.Schemas.Order.PurchaseOrder" />
                                        <om:Property Name="Signal" Value="False" />
                                    </om:Element>
                                </om:Element>
                                <om:Element Type="Task" OID="8bd1a5f9-50e9-4609-8b4f-9009968e0a9a" ParentLink="ComplexStatement_Statement" LowerBound="151.1" HigherBound="157.1">
                                    <om:Property Name="ReportToAnalyst" Value="True" />
                                    <om:Property Name="Name" Value="Inform Broker" />
                                    <om:Property Name="Signal" Value="True" />
                                    <om:Element Type="Call" OID="b3b38133-8ca2-4f89-a251-fca1bd9f45de" ParentLink="ComplexStatement_Statement" LowerBound="151.1" HigherBound="153.1">
                                        <om:Property Name="Identifier" Value="GetBrokerProfile" />
                                        <om:Property Name="Invokee" Value="Microsoft.Samples.BizTalk.Litware.Orchestrations.GetUserProfile" />
                                        <om:Property Name="ReportToAnalyst" Value="True" />
                                        <om:Property Name="Name" Value="Get Broker Profile" />
                                        <om:Property Name="Signal" Value="False" />
                                        <om:Element Type="Parameter" OID="961db191-69c2-455a-9d17-7c5b4b5e250f" ParentLink="InvokeStatement_Parameter">
                                            <om:Property Name="Direction" Value="In" />
                                            <om:Property Name="Name" Value="partnerName" />
                                            <om:Property Name="Type" Value="System.String" />
                                            <om:Property Name="Signal" Value="False" />
                                        </om:Element>
                                        <om:Element Type="Parameter" OID="e0581f31-5c14-47f2-8db6-0f5aeadbfbeb" ParentLink="InvokeStatement_Parameter">
                                            <om:Property Name="Direction" Value="Out" />
                                            <om:Property Name="Name" Value="ProfileMsg" />
                                            <om:Property Name="Type" Value="Microsoft.Samples.BizTalk.Litware.Schemas.TPM.Partner.PartnerObject" />
                                            <om:Property Name="Signal" Value="False" />
                                        </om:Element>
                                        <om:Element Type="Parameter" OID="aaf41a7c-1456-461b-b088-8509ab6e2c2c" ParentLink="InvokeStatement_Parameter">
                                            <om:Property Name="Direction" Value="Ref" />
                                            <om:Property Name="Name" Value="result" />
                                            <om:Property Name="Type" Value="System.Boolean" />
                                            <om:Property Name="Signal" Value="False" />
                                        </om:Element>
                                    </om:Element>
                                    <om:Element Type="VariableAssignment" OID="006a212a-4ece-4fdc-895d-bd6cfa7b78f8" ParentLink="ComplexStatement_Statement" LowerBound="153.1" HigherBound="155.1">
                                        <om:Property Name="Expression" Value="destination = Microsoft.Samples.BizTalk.Litware.Utilities.XmlHelper.GetPartnerEmail(ProfileMsg);" />
                                        <om:Property Name="ReportToAnalyst" Value="True" />
                                        <om:Property Name="Name" Value="Get Email" />
                                        <om:Property Name="Signal" Value="False" />
                                    </om:Element>
                                    <om:Element Type="Call" OID="45e777ea-cf53-4c15-9cdd-82cc35823cd2" ParentLink="ComplexStatement_Statement" LowerBound="155.1" HigherBound="157.1">
                                        <om:Property Name="Identifier" Value="BrokerConfirm" />
                                        <om:Property Name="Invokee" Value="Microsoft.Samples.BizTalk.Litware.Orchestrations.ConfirmOrderWithBroker" />
                                        <om:Property Name="ReportToAnalyst" Value="True" />
                                        <om:Property Name="Name" Value="Broker Confirm" />
                                        <om:Property Name="Signal" Value="False" />
                                        <om:Element Type="Parameter" OID="82d6c101-dc90-401a-aaf7-3d3e69819a28" ParentLink="InvokeStatement_Parameter">
                                            <om:Property Name="Direction" Value="In" />
                                            <om:Property Name="Name" Value="partnerName" />
                                            <om:Property Name="Type" Value="System.String" />
                                            <om:Property Name="Signal" Value="False" />
                                        </om:Element>
                                        <om:Element Type="Parameter" OID="194a6b17-a4ec-4371-b763-e9ea5b941e4b" ParentLink="InvokeStatement_Parameter">
                                            <om:Property Name="Direction" Value="In" />
                                            <om:Property Name="Name" Value="POChgMsg" />
                                            <om:Property Name="Type" Value="Microsoft.Samples.BizTalk.Litware.Schemas.Order.PurchaseOrder" />
                                            <om:Property Name="Signal" Value="False" />
                                        </om:Element>
                                        <om:Element Type="Parameter" OID="65034ef8-4aa4-4eea-9d44-627f67b2bc71" ParentLink="InvokeStatement_Parameter">
                                            <om:Property Name="Direction" Value="In" />
                                            <om:Property Name="Name" Value="destination" />
                                            <om:Property Name="Type" Value="System.String" />
                                            <om:Property Name="Signal" Value="False" />
                                        </om:Element>
                                    </om:Element>
                                </om:Element>
                            </om:Element>
                            <om:Element Type="DecisionBranch" OID="4a295362-903c-4733-b0b9-404bf33f914b" ParentLink="ReallyComplexStatement_Branch">
                                <om:Property Name="IsGhostBranch" Value="True" />
                                <om:Property Name="ReportToAnalyst" Value="True" />
                                <om:Property Name="Name" Value="Else" />
                                <om:Property Name="Signal" Value="False" />
                                <om:Element Type="VariableAssignment" OID="5a20e877-c137-46fa-9d79-7fb5a223f1bd" ParentLink="ComplexStatement_Statement" LowerBound="160.1" HigherBound="163.1">
                                    <om:Property Name="Expression" Value="errMsg = System.String.Format(&quot;Unable to find Order where Order ID = {0} and Sold To Name = {1}&quot;, InquiryMsg.Request.OrderGroupId, InquiryMsg.Request.SoldToName);&#xD;&#xA;System.Diagnostics.EventLog.WriteEntry(&quot;Litware Scenario&quot;, errMsg, System.Diagnostics.EventLogEntryType.Warning);" />
                                    <om:Property Name="ReportToAnalyst" Value="True" />
                                    <om:Property Name="Name" Value="Notify Admin" />
                                    <om:Property Name="Signal" Value="True" />
                                </om:Element>
                            </om:Element>
                        </om:Element>
                    </om:Element>
                    <om:Element Type="DecisionBranch" OID="4cca395f-4b97-471a-b502-79049febc3c3" ParentLink="ReallyComplexStatement_Branch">
                        <om:Property Name="IsGhostBranch" Value="True" />
                        <om:Property Name="ReportToAnalyst" Value="True" />
                        <om:Property Name="Name" Value="Else" />
                        <om:Property Name="Signal" Value="False" />
                        <om:Element Type="VariableAssignment" OID="99372bf0-f117-4e63-87db-b8dc227a55e7" ParentLink="ComplexStatement_Statement" LowerBound="167.1" HigherBound="170.1">
                            <om:Property Name="Expression" Value="errMsg = System.String.Format(&quot;Sender ({0}) is not the same as Sold To Name ({1}).&quot;, partnerName, soldToName);&#xD;&#xA;System.Diagnostics.EventLog.WriteEntry(&quot;Litware Scenario&quot;, errMsg, System.Diagnostics.EventLogEntryType.Error);" />
                            <om:Property Name="ReportToAnalyst" Value="True" />
                            <om:Property Name="Name" Value="Notify Admin" />
                            <om:Property Name="Signal" Value="True" />
                        </om:Element>
                    </om:Element>
                </om:Element>
            </om:Element>
            <om:Element Type="PortDeclaration" OID="241dc04b-7414-4bf1-be81-d8118f8d698d" ParentLink="ServiceDeclaration_PortDeclaration" LowerBound="36.1" HigherBound="38.1">
                <om:Property Name="PortModifier" Value="Uses" />
                <om:Property Name="Orientation" Value="Left" />
                <om:Property Name="PortIndex" Value="50" />
                <om:Property Name="IsWebPort" Value="False" />
                <om:Property Name="OrderedDelivery" Value="False" />
                <om:Property Name="DeliveryNotification" Value="None" />
                <om:Property Name="Type" Value="Microsoft.Samples.BizTalk.Litware.Orchestrations.SendOrderChgType" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="SendOrderChg" />
                <om:Property Name="Signal" Value="False" />
                <om:Element Type="LogicalBindingAttribute" OID="da6491b0-e940-4b3d-9b81-ce29ee4bee3b" ParentLink="PortDeclaration_CLRAttribute" LowerBound="36.1" HigherBound="37.1">
                    <om:Property Name="Signal" Value="False" />
                </om:Element>
            </om:Element>
        </om:Element>
        <om:Element Type="ServiceLinkType" OID="584a4dfc-3178-4b32-9f47-99ad8bee49e9" ParentLink="Module_ServiceLinkType" LowerBound="25.1" HigherBound="32.1">
            <om:Property Name="TypeModifier" Value="Internal" />
            <om:Property Name="ReportToAnalyst" Value="True" />
            <om:Property Name="Name" Value="UpdatePORoleLinkType" />
            <om:Property Name="Signal" Value="True" />
            <om:Element Type="RoleDeclaration" OID="68233cdc-b9ae-4d09-89af-9c4a070956f4" ParentLink="ServiceLinkType_RoleDeclaration" LowerBound="27.1" HigherBound="31.1">
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="RequestRole" />
                <om:Property Name="Signal" Value="True" />
                <om:Element Type="PortTypeRef" OID="d651c046-aff0-41c5-bb5d-56918861ee0c" ParentLink="RoleDeclaration_PortTypeRef" LowerBound="29.13" HigherBound="29.26">
                    <om:Property Name="Ref" Value="Microsoft.Samples.BizTalk.Litware.Orchestrations.RecvPOChgType" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="PortTypeRef_1" />
                    <om:Property Name="Signal" Value="False" />
                </om:Element>
            </om:Element>
        </om:Element>
    </om:Element>
</om:MetaModel>
#endif // __DESIGNER_DATA
[Microsoft.XLANGs.BaseTypes.BPELExportable(false)]
module Microsoft.Samples.BizTalk.Litware.Orchestrations
{
    public porttype RecvPOChgType
    {
        oneway RecvPOOp
        {
            Microsoft.Samples.BizTalk.Litware.Schemas.Order.PurchaseOrder
        };
    };
    internal porttype SendOrderInquiryType
    {
        requestresponse OrderInquiryOp
        {
            Microsoft.Samples.BizTalk.Litware.Schemas.OrderSystem.OrderInquiry, Microsoft.Samples.BizTalk.Litware.Schemas.OrderSystem.OrderInquiry
        };
    };
    internal porttype SendOrderChgType
    {
        requestresponse SendOrderChgOp
        {
            Microsoft.Samples.BizTalk.Litware.Schemas.Order.PurchaseOrder, Microsoft.Samples.BizTalk.Litware.Schemas.OrderSystem.OrderAck, BusinessrFault = Microsoft.Samples.BizTalk.Litware.Schemas.OrderSystem.BusinessFaultMessage, SystemFault = Microsoft.Samples.BizTalk.Litware.Schemas.OrderSystem.SystemFaultMessage
        };
    };
    internal servicelinktype UpdatePORoleLinkType
    {
        RequestRole
        {
            RecvPOChgType
        };
    };
    [Microsoft.XLANGs.BaseTypes.BPELExportable(false)]
    internal service UpdateOrder
    {
        servicelink implements UpdatePORoleLinkType.RequestRole POChangeRoleLink;
        [Microsoft.XLANGs.BaseTypes.LogicalBinding()]
        port uses SendOrderChgType SendOrderChg;
        message Microsoft.Samples.BizTalk.Litware.Schemas.Order.PurchaseOrder POChgMsg;
        message Microsoft.Samples.BizTalk.Litware.Schemas.OrderSystem.OrderInquiry InquiryMsg;
        message Microsoft.Samples.BizTalk.Litware.Schemas.OrderSystem.OrderAck UpdateAck;
        message Microsoft.Samples.BizTalk.Litware.Schemas.TPM.Partner.PartnerObject ProfileMsg;
        System.String partnerName;
        System.String errMsg;
        System.String soldToName;
        System.Boolean result;
        System.Int32 retryCount;
        System.String destination;
        Microsoft.XLANGs.BaseTypes.Party partner;
        System.Boolean bInquiryStatus;
        body ()
        {
            [Microsoft.XLANGs.BaseTypes.DesignerPosition("4768db85-ce6e-4ee6-b3ba-a1863a0a4cdd")]
            activate receive (POChangeRoleLink[Microsoft.Samples.BizTalk.Litware.Orchestrations.RecvPOChgType].RecvPOOp, POChgMsg);
            partnerName = "";
            errMsg = "";
            soldToName = "";
            result = true;
            retryCount = 0;
            destination = "";
            bInquiryStatus = false;
            [Microsoft.XLANGs.BaseTypes.DesignerPosition("58913a90-cd59-4abd-989f-12dd01d62b52")]
            //partnerName = POChgMsg(MessageTracking.PartyName);
            partner = POChangeRoleLink(Microsoft.XLANGs.BaseTypes.SourceParty);
            partnerName = partner.Name;
            soldToName = POChgMsg(Microsoft.Samples.BizTalk.Litware.Schemas.SoldToName);
            
            [Microsoft.XLANGs.BaseTypes.DesignerPosition("25c4b12b-e3c8-4cc0-8376-f8fa06bc5dbb")]
            if (partnerName == soldToName)
            {
                [Microsoft.XLANGs.BaseTypes.DesignerPosition("563c1c14-96bb-4612-bd96-1871b059a5ec")]
                construct InquiryMsg
                {
                    [Microsoft.XLANGs.BaseTypes.DesignerPosition("e1315a05-c8db-4e85-87b0-1481f2cfec67")]
                    transform (InquiryMsg) = Microsoft.Samples.BizTalk.Litware.Maps.PurchaseOrder_To_Inquiry (POChgMsg);
                }
                [Microsoft.XLANGs.BaseTypes.DesignerPosition("81071b02-e4a8-40dd-8a74-fa00176b9721")]
                call Microsoft.Samples.BizTalk.Litware.Orchestrations.CheckOrderExists (InquiryMsg, ref bInquiryStatus);
                [Microsoft.XLANGs.BaseTypes.DesignerPosition("a754e36b-bd19-4b3a-b72f-ee89c34fa682")]
                if (bInquiryStatus == true)
                {
                    [Microsoft.XLANGs.BaseTypes.DesignerPosition("ea2bd1fe-a671-411f-83f6-17299097caa2")]
                    while (retryCount < 3)
                    {
                        [Microsoft.XLANGs.BaseTypes.DesignerPosition("d39b5e3c-2069-4509-8cda-65f6cd67eb95")]
                        scope
                        {
                            body
                            {
                                [Microsoft.XLANGs.BaseTypes.DesignerPosition("38e93a95-4105-4242-b25a-fb403787d7cc")]
                                send (SendOrderChg.SendOrderChgOp, POChgMsg);
                                [Microsoft.XLANGs.BaseTypes.DesignerPosition("0a65c6f7-fa00-4c7c-ae71-85cd708b8419")]
                                receive (SendOrderChg.SendOrderChgOp, UpdateAck);
                                [Microsoft.XLANGs.BaseTypes.DesignerPosition("947e5f61-3a83-4a5c-aa16-985bf85c0cfb")]
                                retryCount = 3;
                            }
                            exceptions
                            {
                                [Microsoft.XLANGs.BaseTypes.DesignerPosition("eadf9268-754d-4ae3-bf14-b14e552c43fe")]
                                catch (SendOrderChg.SendOrderChgOp.BusinessrFault OrderSystemBusinessException)
                                {
                                    [Microsoft.XLANGs.BaseTypes.DesignerPosition("4df1fd54-4e0e-4987-a3d1-351415cc619b")]
                                    terminate OrderSystemBusinessException.Message;;
                                }
                                [Microsoft.XLANGs.BaseTypes.DesignerPosition("d53ec575-6bd1-4c2a-9ec1-2e008a5aa152")]
                                catch (SendOrderChg.SendOrderChgOp.SystemFault OrderSystemSystemException)
                                {
                                    [Microsoft.XLANGs.BaseTypes.DesignerPosition("1509061c-5cee-4292-87fb-a7faac4501a6")]
                                    retryCount = retryCount + 1;
                                    [Microsoft.XLANGs.BaseTypes.DesignerPosition("1e34dbdd-94da-4f6a-a66d-0c4e4ca76c1a")]
                                    if (retryCount < 3)
                                    {
                                        [Microsoft.XLANGs.BaseTypes.DesignerPosition("e76e13bd-6cd3-44c9-966e-fd6a11867836")]
                                        System.Diagnostics.EventLog.WriteEntry("Litware Scenario", "Failed to update order in order system. Orchestration suspended." + OrderSystemSystemException.Message, System.Diagnostics.EventLogEntryType.Warning);
                                        [Microsoft.XLANGs.BaseTypes.DesignerPosition("c2244489-7d57-444d-a91d-56563eb48b24")]
                                        suspend OrderSystemSystemException.Message;
                                    }
                                    else 
                                    {
                                        [Microsoft.XLANGs.BaseTypes.DesignerPosition("12763700-d26f-43ae-82cc-494cb43dd670")]
                                        System.Diagnostics.EventLog.WriteEntry("Litware Scenario", "Failed to update order to order system after several retries. Orchestration Terminated." + OrderSystemSystemException.Message, System.Diagnostics.EventLogEntryType.Warning);
                                        [Microsoft.XLANGs.BaseTypes.DesignerPosition("9fb0af01-8d6d-4dac-9d85-be13c59e4c7d")]
                                        terminate OrderSystemSystemException.Message;;
                                    }
                                }
                                [Microsoft.XLANGs.BaseTypes.DesignerPosition("2b96d038-65bb-48b4-a7df-33634b3c8b89")]
                                catch (System.SystemException exp)
                                {
                                    [Microsoft.XLANGs.BaseTypes.DesignerPosition("e7f370b3-23a6-4c97-a7c1-bd3f9904c10f")]
                                    retryCount = retryCount + 1;
                                    [Microsoft.XLANGs.BaseTypes.DesignerPosition("94c1efe0-7c54-4813-9fec-69b24aef229a")]
                                    if (retryCount < 3)
                                    {
                                        [Microsoft.XLANGs.BaseTypes.DesignerPosition("210dbf59-d7a6-4e66-9dc3-48b0d4f506f3")]
                                        System.Diagnostics.EventLog.WriteEntry("Litware Scenario", "Failed to update order to order system. Orchestration suspended." + exp.Message, System.Diagnostics.EventLogEntryType.Warning);
                                        [Microsoft.XLANGs.BaseTypes.DesignerPosition("ff5db415-483b-4536-9a00-a6ff7c3ab571")]
                                        suspend exp.Message;
                                    }
                                    else 
                                    {
                                        [Microsoft.XLANGs.BaseTypes.DesignerPosition("eaf8d282-9eed-40da-b4cd-b2828bd81faa")]
                                        System.Diagnostics.EventLog.WriteEntry("Litware Scenario", "Failed to update order to order system after several retries. Orchestration Terminated." + exp.Message, System.Diagnostics.EventLogEntryType.Error);
                                        [Microsoft.XLANGs.BaseTypes.DesignerPosition("6734684f-924e-4bb5-b9d1-b4772769b3b7")]
                                        terminate exp.Message;;
                                    }
                                }
                            }
                        }
                    }
                    [Microsoft.XLANGs.BaseTypes.DesignerPosition("b7d88c6a-da3a-48b5-aba5-6af92cc693ef")]
                    call Microsoft.Samples.BizTalk.Litware.Orchestrations.ConfirmOrderWithVendors (POChgMsg);
                    [Microsoft.XLANGs.BaseTypes.DesignerPosition("b3b38133-8ca2-4f89-a251-fca1bd9f45de")]
                    call Microsoft.Samples.BizTalk.Litware.Orchestrations.GetUserProfile (partnerName, out ProfileMsg, ref result);
                    [Microsoft.XLANGs.BaseTypes.DesignerPosition("006a212a-4ece-4fdc-895d-bd6cfa7b78f8")]
                    destination = Microsoft.Samples.BizTalk.Litware.Utilities.XmlHelper.GetPartnerEmail(ProfileMsg);
                    [Microsoft.XLANGs.BaseTypes.DesignerPosition("45e777ea-cf53-4c15-9cdd-82cc35823cd2")]
                    call Microsoft.Samples.BizTalk.Litware.Orchestrations.ConfirmOrderWithBroker (partnerName, POChgMsg, destination);
                }
                else 
                {
                    [Microsoft.XLANGs.BaseTypes.DesignerPosition("5a20e877-c137-46fa-9d79-7fb5a223f1bd")]
                    errMsg = System.String.Format("Unable to find Order where Order ID = {0} and Sold To Name = {1}", InquiryMsg.Request.OrderGroupId, InquiryMsg.Request.SoldToName);
                    System.Diagnostics.EventLog.WriteEntry("Litware Scenario", errMsg, System.Diagnostics.EventLogEntryType.Warning);
                }
            }
            else 
            {
                [Microsoft.XLANGs.BaseTypes.DesignerPosition("99372bf0-f117-4e63-87db-b8dc227a55e7")]
                errMsg = System.String.Format("Sender ({0}) is not the same as Sold To Name ({1}).", partnerName, soldToName);
                System.Diagnostics.EventLog.WriteEntry("Litware Scenario", errMsg, System.Diagnostics.EventLogEntryType.Error);
            }
        }
    }
}

