<!-- Copyright (c) Microsoft Corporation. All rights reserved. -->
<!--  -->
<!-- THIS CODE AND INFORMATION IS PROVIDED "AS IS" WITHOUT WARRANTY OF ANY KIND, -->
<!-- WHETHER EXPRESSED OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE IMPLIED -->
<!-- WARRANTIES OF MERCHANTABILITY AND/OR FITNESS FOR A PARTICULAR PURPOSE. -->
<!-- THE ENTIRE RISK OF USE OR RESULTS IN CONNECTION WITH THE USE OF THIS CODE -->
<!-- AND INFORMATION REMAINS WITH THE USER. -->
<!--  -->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" >
<HTML>
	<HEAD>
		<link rel="Configuration" href="HATcfg.xml"/>
		<TITLE>
			Policy Execution Details: Condition Evaluations
		</TITLE>
		<META CONTENT="Microsoft Visual Studio 7.0" name="GENERATOR">
		<META CONTENT="C#" NAME="CODE_LANGUAGE">
		<META CONTENT="JavaScript" NAME="vs_defaultClientScript">
		<META CONTENT="http://schemas.microsoft.com/intellisense/ie5" NAME="vs_targetSchema">
		<LINK REL="stylesheet" TYPE="text/css" HREF="default.css" ID="brma_ss">
		<script language="jscript">
		var oRulesTrackingViewCtrl, SqlSrv, SqlDB, Group, AppType;
		var ErrMsg="";
		var ControlsInstalled = false;
		
		function PageLoad()
		{
			var oNavCtrl = document.CollapsibleCtrl;

			SqlSrv 	= oNavCtrl.GetViewParameter("sqlSrv"); 
			SqlDB 	= oNavCtrl.GetViewParameter("sqlDB"); 
			Group 	= oNavCtrl.GetViewParameter("group");
			AppType	= oNavCtrl.GetViewParameter("AppType");
			
			try
			{
				re_toa_PolicyExecutionDetails.innerText = oNavCtrl.GetWebPageResourceString("re_toa_PolicyExecutionDetails");
				re_toa_ScheduleInstanceID.innerText = oNavCtrl.GetWebPageResourceString("re_toa_ScheduleInstanceID");
				re_toa_ExecTimestamp.innerText = oNavCtrl.GetWebPageResourceString("re_toa_ExecTimestamp");
				re_toa_ExecTimestamp_2.innerText = oNavCtrl.GetWebPageResourceString("re_toa_ExecTimestamp");
				re_toa_PolicyID.innerText = oNavCtrl.GetWebPageResourceString("re_toa_PolicyID");
				re_toa_ConditionID.innerText = oNavCtrl.GetWebPageResourceString("re_toa_ConditionID");
				re_toa_TextExpression.innerText = oNavCtrl.GetWebPageResourceString("re_toa_TextExpression");
				re_toa_ConditionResult.innerText = oNavCtrl.GetWebPageResourceString("re_toa_ConditionResult");

				oRulesTrackingViewCtrl = document.all("Registered");
				oRulesTrackingViewCtrl.setAllValues(oNavCtrl.EncodeForUrl(SqlSrv),oNavCtrl.EncodeForUrl(SqlDB), "","", "","", oNavCtrl.EncodeForUrl(Group),oNavCtrl.EncodeForUrl(AppType), "","");
				re_toa_ServiceName.innerText = oNavCtrl.GetWebPageResourceString("re_toa_ServiceName");
				m_sResServiceName.innerText = oRulesTrackingViewCtrl.GetServiceNameByInstance(oNavCtrl.GetViewParameter("inst"));
			}
			catch(e)
			{
				var sErrMsg = oNavCtrl.GetWebPageResourceString("err_GenericError") + "\n";
				sErrMsg += e.description;
				alert(sErrMsg);
			}

			m_sResInstanceID.innerText = oRulesTrackingViewCtrl.DecodeForDisplay(oNavCtrl.GetViewParameter("inst"));
			m_sExecTimestamp.innerText = oRulesTrackingViewCtrl.DecodeForDisplay(oNavCtrl.GetViewParameter("ExecTime"));
			m_sPolicyID.innerText = oRulesTrackingViewCtrl.DecodeForDisplay(oNavCtrl.GetViewParameter("PolicyID"));
				
			m_sConditionsEvaluatedHeader.innerText = oNavCtrl.GetWebPageResourceString("re_toa_ConditionsEvaluated");
			oRulesTrackingViewCtrl.SetConditionsEvaluatedForPolicyEngineAssociation(oNavCtrl.GetViewParameter("AssocID"));
			var conditionsEvaluatedIDList = oRulesTrackingViewCtrl.ConditionsEvaluatedIDList;
			var textExpressionList = oRulesTrackingViewCtrl.TextExpressionList;
			var lhsClassNameList = oRulesTrackingViewCtrl.LhsClassNameList;
			var lhsClassInstanceIDList = oRulesTrackingViewCtrl.LhsClassInstanceIDList;
			var lhsLiteralValueList = oRulesTrackingViewCtrl.LhsLiteralValueList;
			var rhsClassNameList = oRulesTrackingViewCtrl.RhsClassNameList;
			var rhsClassInstanceIDList = oRulesTrackingViewCtrl.RhsClassInstanceIDList;
			var rhsLiteralValueList = oRulesTrackingViewCtrl.RhsLiteralValueList;
			var conditionResultList = oRulesTrackingViewCtrl.ConditionResultList;
			var conditionTimeList = oRulesTrackingViewCtrl.ConditionTimeList;

			for (j=0; j<conditionsEvaluatedIDList.Count; j++)
			{
			
				tBody.insertRow(tBody.childNodes.length);
				var oRow1 = tBody.childNodes(tBody.childNodes.length-1);
				
				for(i=0;i<4;i++){
					oRow1.insertCell();
					oRow1.childNodes(i).className = "toaMsgRow";
				}
				oRow1.childNodes(0).innerText 	= oRulesTrackingViewCtrl.DecodeForDisplay(conditionsEvaluatedIDList(j));
				oRow1.childNodes(1).innerText 	= oRulesTrackingViewCtrl.DecodeForDisplay(textExpressionList(j));
				oRow1.childNodes(2).innerText 	= oRulesTrackingViewCtrl.DecodeForDisplay(conditionResultList(j));
				oRow1.childNodes(3).innerText 	= oRulesTrackingViewCtrl.DecodeForDisplay(conditionTimeList(j));

				var strHTML = "<TABLE>";
				strHTML += "<TR><TD>" + oNavCtrl.GetWebPageResourceString("re_toa_LhsClassName") + "</TD><TD>";
				strHTML +=  oRulesTrackingViewCtrl.EncodeForDisplay(lhsClassNameList(j)) + "</TD></TR>"
				strHTML += "<TR><TD>" + oNavCtrl.GetWebPageResourceString("re_toa_LhsClassInstance") + "</TD><TD>";
				strHTML +=  oRulesTrackingViewCtrl.EncodeForDisplay(lhsClassInstanceIDList(j)) + "</TD></TR>"
				strHTML += "<TR><TD>" + oNavCtrl.GetWebPageResourceString("re_toa_LhsLiteralValue") + "</TD><TD>";
				strHTML +=  oRulesTrackingViewCtrl.EncodeForDisplay(lhsLiteralValueList(j)) + "</TD></TR>"
				strHTML += "<TR><TD>" + oNavCtrl.GetWebPageResourceString("re_toa_RhsClassName") + "</TD><TD>";
				strHTML +=  oRulesTrackingViewCtrl.EncodeForDisplay(rhsClassNameList(j)) + "</TD></TR>"
				strHTML += "<TR><TD>" + oNavCtrl.GetWebPageResourceString("re_toa_RhsClassInstance") + "</TD><TD>";
				strHTML +=  oRulesTrackingViewCtrl.EncodeForDisplay(rhsClassInstanceIDList(j)) + "</TD></TR>"
				strHTML += "<TR><TD>" + oNavCtrl.GetWebPageResourceString("re_toa_RhsLiteralValue") + "</TD><TD>";
				strHTML +=  oRulesTrackingViewCtrl.EncodeForDisplay(rhsLiteralValueList(j)) + "</TD></TR>"
				strHTML += "</TABLE>";
				tBody.insertRow(tBody.childNodes.length);
				var oRow2 = tBody.childNodes(tBody.childNodes.length-1);
				
				for(i=0;i<2;i++)
				{
					oRow2.insertCell();
					oRow2.childNodes(i).className = "toaConditionsEvaluatedRow";
				}
				oRow2.childNodes(1).colSpan 				= 4;
				oRow2.childNodes(1).style.paddingLeft 	= "5px";
				oRow2.childNodes(1).innerHTML			= strHTML;
				oRow2.style.display						= ""				
			}
		}
		
		</script>
	</HEAD>
	<body MS_POSITIONING="GridLayout" bgColor="#ffffff" onload="PageLoad();">
		<FORM ID="RulesTrackingTOA" METHOD="post" RUNAT="server">
			<!-- buttons for communication between Hat Application and IE. -->
			<INPUT type="button" ID="HelpBtn" style="DISPLAY:none;" onclick='ShowPageHelp();'>

			<TABLE STYLE="padding-left:5;margin-top:15;width:*;" CELLSPACING="0" CELLPADDING="0">
				<TR>
					<TD STYLE="width:*;"><B><A id="re_toa_PolicyExecutionDetails"/></B></TD>
				</TR>
			</TABLE>
			<TABLE STYLE="padding-left:5;margin-top:15;width:*;" CELLSPACING="0" CELLPADDING="0">
				<TR>
					<TD><A id="re_toa_ServiceName"/></TD>
					<TD><A ID="m_sResServiceName"></A>&nbsp;</TD>
				</TR>
				<TR>
					<TD><A id="re_toa_ScheduleInstanceID"/></TD>
					<TD><A ID="m_sResInstanceID"></A>&nbsp;</TD>
				</TR>
				<TR>
					<TD><A id="re_toa_ExecTimestamp"/></TD>
					<TD><A ID="m_sExecTimestamp"></A>&nbsp;</TD>
				</TR>
				<TR>
					<TD><A id="re_toa_PolicyID"/></TD>
					<TD><A ID="m_sPolicyID"></A>&nbsp;</TD>
				</TR>
			</TABLE>
			<TABLE STYLE="padding-left:5;margin-top:15;width:*;" CELLSPACING="0" CELLPADDING="0">
				<TR>
					<TD><B><A ID="m_sConditionsEvaluatedHeader"></A></B>&nbsp;</TD>
				</TR>
				<TR>
					<TD>&nbsp;</TD>
				</TR>
			</TABLE>	
			<TABLE CLASS="toaConditionsEvaluated" CELLSPACING="0">
				<TBODY ID="tBody">
					<TR>
						<TD CLASS="toaMsgHeader" WIDTH="20%"><A id="re_toa_ConditionID"/></TD>
						<TD CLASS="toaMsgHeader" WIDTH="40%"><A id="re_toa_TextExpression"/></TD>
						<TD CLASS="toaMsgHeader" WIDTH="15%"><A id="re_toa_ConditionResult"/></TD>
						<TD CLASS="toaMsgHeader" WIDTH="25%"><A id="re_toa_ExecTimestamp_2"/></TD>
					</TR>
				</TBODY>
			</TABLE>						
			<DIV id="RulesTrackingViewCtrl" style="DISPLAY:none">
				<OBJECT ID="Registered" CLASSID="clsid:DC615974-9A2E-4efe-B032-9AA9B172E0E9" VIEWASTEXT>
				</OBJECT>
				
				<OBJECT id="Help" classid="clsid:DAC40761-C9C8-4653-AB49-C4D4AE4FF042" VIEWASTEXT>
				</OBJECT>
				
				<OBJECT id="CollapsibleCtrl" CLASSID="clsid:12BBC156-5455-4a61-8DC8-82F56838CB99" VIEWASTEXT>
				</OBJECT>		
			</DIV>
		</FORM>
	</body>
</HTML>
