// (c) 2010 CodePlex Foundation
(function(){var b=null,d="ExtendedDropShadow",a=b;function c(){var c="px ",d="absolute";Type.registerNamespace("Sys.Extended.UI");Sys.Extended.UI.DropShadowBehavior=function(c){var a=this;Sys.Extended.UI.DropShadowBehavior.initializeBase(a,[c]);a._opacity=1;a._width=5;a._shadowDiv=b;a._trackPosition=b;a._trackPositionDelay=50;a._timer=b;a._tickHandler=b;a._roundedBehavior=b;a._shadowRoundedBehavior=b;a._rounded=false;a._radius=5;a._lastX=b;a._lastY=b;a._lastW=b;a._lastH=b};Sys.Extended.UI.DropShadowBehavior.prototype={initialize:function(){var b=this;Sys.Extended.UI.DropShadowBehavior.callBaseMethod(b,"initialize");a=b.get_element();if($common.getCurrentStyle(a,"position",a.style.position)!=d)a.style.position="relative";b._rounded&&b.setupRounded();if(a.style.boxShadow==undefined&&a.style.MozBoxShadow==undefined&&a.style.WebkitBoxShadow==undefined)b._trackPosition&&b.startTimer();b.setShadow()},dispose:function(){var b=this;if(!a)a=b.get_element();if(a.style.boxShadow==undefined&&a.style.MozBoxShadow==undefined&&a.style.WebkitBoxShadow==undefined){b.stopTimer();b.disposeShadowDiv();Sys.Extended.UI.DropShadowBehavior.callBaseMethod(b,"dispose")}},buildShadowDiv:function(){var c=this;a=c.get_element();if(!c.get_isInitialized()||!a||!c._width)return;if(a.style.boxShadow==undefined&&a.style.MozBoxShadow==undefined&&a.style.WebkitBoxShadow==undefined){var e=document.createElement("DIV");e.style.backgroundColor="black";e.style.position=d;if(a.id)e.id=a.id+"_DropShadow";c._shadowDiv=e;a.parentNode.appendChild(e);if(c._rounded){c._shadowDiv.style.height=Math.max(0,a.offsetHeight-2*c._radius)+"px";if(!c._shadowRoundedBehavior)c._shadowRoundedBehavior=$create(Sys.Extended.UI.RoundedCornersBehavior,{Radius:c._radius},b,b,c._shadowDiv);else c._shadowRoundedBehavior.set_Radius(c._radius)}else c._shadowRoundedBehavior&&c._shadowRoundedBehavior.set_Radius(0);c._opacity!=1&&c.setupOpacity();c.setShadow(false,true);c.updateZIndex()}},disposeShadowDiv:function(){var c=this;if(a.style.boxShadow==undefined&&a.style.MozBoxShadow==undefined&&a.style.WebkitBoxShadow==undefined){if(c._shadowDiv){c._shadowDiv.parentNode&&c._shadowDiv.parentNode.removeChild(c._shadowDiv);c._shadowDiv=b}if(c._shadowRoundedBehavior){c._shadowRoundedBehavior.dispose();c._shadowRoundedBehavior=b}}},onTimerTick:function(){this.setShadow()},startTimer:function(){var a=this;if(!a._timer){if(!a._tickHandler)a._tickHandler=Function.createDelegate(a,a.onTimerTick);a._timer=new Sys.Timer;a._timer.set_interval(a._trackPositionDelay);a._timer.add_tick(a._tickHandler);a._timer.set_enabled(true)}},stopTimer:function(){var a=this;if(a._timer){a._timer.remove_tick(a._tickHandler);a._timer.set_enabled(false);a._timer.dispose();a._timer=b}},setShadow:function(f,h){var b=this;a=b.get_element();if(!b.get_isInitialized()||!a||!b._width&&!f)return;if(a.style.boxShadow==undefined&&a.style.MozBoxShadow==undefined&&a.style.WebkitBoxShadow==undefined){var e=b._shadowDiv;!e&&b.buildShadowDiv();var c={x:a.offsetLeft,y:a.offsetTop};if(f||b._lastX!=c.x||b._lastY!=c.y||!e){b._lastX=c.x;b._lastY=c.y;var d=b.get_Width();c.x+=d;c.y+=d;$common.setLocation(b._shadowDiv,c)}var g=a.offsetHeight,d=a.offsetWidth;if(f||g!=b._lastH||d!=b._lastW||!e){b._lastW=d;b._lastH=g;if(!b._rounded||!e||h){b._shadowDiv.style.width=d+"px";b._shadowDiv.style.height=g+"px"}else{b.disposeShadowDiv();b.setShadow()}}if(b._shadowDiv)b._shadowDiv.style.visibility=$common.getCurrentStyle(a,"visibility")}},setupOpacity:function(){var a=this;a.get_isInitialized()&&a._shadowDiv&&$common.setElementOpacity(a._shadowDiv,a._opacity)},setupRounded:function(){var a=this;if(!a._roundedBehavior&&a._rounded)a._roundedBehavior=$create(Sys.Extended.UI.RoundedCornersBehavior,b,b,b,a.get_element());a._roundedBehavior&&a._roundedBehavior.set_Radius(a._rounded?a._radius:0)},updateZIndex:function(){var c=this;if(!c._shadowDiv)return;var d=c.get_element(),a=d.style.zIndex,b=c._shadowDiv.style.zIndex;if(b&&a&&a>b)return;else{a=Math.max(2,a);b=a-1}d.style.zIndex=a;c._shadowDiv.style.zIndex=b},updateRoundedCorners:function(){var a=this;if(a.get_isInitialized()){a.setupRounded();a.disposeShadowDiv();a.setShadow()}},get_Opacity:function(){return this._opacity},set_Opacity:function(e){var b=this;if(b._opacity!=e){b._opacity=e;if(!a)a=b.get_element();var d;if(b._opacity==".25")d=b._width+c+b._width+c+b._width+c+"#D3D3D3";else if(b._opacity==".5")d=b._width+c+b._width+c+b._width+c+"#778899";else if(b._opacity==".75")d=b._width+c+b._width+c+b._width+c+"#808080";else d=b._width+c+b._width+c+b._width+c+"#000";if(a.style.boxShadow!=undefined)a.style.boxShadow=d;else if(a.style.MozBoxShadow!=undefined)a.style.MozBoxShadow=d;else if(a.style.WebkitBoxShadow!=undefined)a.style.WebkitBoxShadow=d;else{b.setupOpacity();b.raisePropertyChanged("Opacity")}}},get_Rounded:function(){return this._rounded},set_Rounded:function(b){var a=this;if(b!=a._rounded){a._rounded=b;a.updateRoundedCorners();a.raisePropertyChanged("Rounded")}},get_Radius:function(){return this._radius},set_Radius:function(b){var a=this;if(b!=a._radius){a._radius=b;a.updateRoundedCorners();a.raisePropertyChanged("Radius")}},get_Width:function(){return this._width},set_Width:function(e){var b=this;if(e!=b._width){b._width=e;if(!a)a=b.get_element();var d;if(b._opacity==".25")d=b._width+c+b._width+c+b._width+c+"#D3D3D3";else if(b._opacity==".5")d=b._width+c+b._width+c+b._width+c+"#778899";else if(b._opacity==".75")d=b._width+c+b._width+c+b._width+c+"#808080";else d=b._width+c+b._width+c+b._width+c+"#000000";if(a.style.boxShadow!=undefined)a.style.boxShadow=d;else if(a.style.MozBoxShadow!=undefined)a.style.MozBoxShadow=d;else if(a.style.WebkitBoxShadow!=undefined)a.style.WebkitBoxShadow=d;else{b._shadowDiv&&$common.setVisible(b._shadowDiv,e>0);b.setShadow(true);b.raisePropertyChanged("Width")}}},get_TrackPositionDelay:function(){return this._trackPositionDelay},set_TrackPositionDelay:function(c){var b=this;if(c!=b._trackPositionDelay){b._trackPositionDelay=c;if(!a)a=b.get_element();if(a.style.boxShadow==undefined&&a.style.MozBoxShadow==undefined&&a.style.WebkitBoxShadow==undefined){if(b._trackPosition){b.stopTimer();b.startTimer()}b.raisePropertyChanged("TrackPositionDelay")}}},get_TrackPosition:function(){return this._trackPosition},set_TrackPosition:function(c){var b=this;if(c!=b._trackPosition){b._trackPosition=c;if(!a)a=b.get_element();if(a.style.boxShadow==undefined&&a.style.MozBoxShadow==undefined&&a.style.WebkitBoxShadow==undefined){if(b.get_element())if(c)b.startTimer();else b.stopTimer();b.raisePropertyChanged("TrackPosition")}}}};Sys.Extended.UI.DropShadowBehavior.registerClass("Sys.Extended.UI.DropShadowBehavior",Sys.Extended.UI.BehaviorBase);Sys.registerComponent(Sys.Extended.UI.DropShadowBehavior,{name:"dropShadow"})}if(window.Sys&&Sys.loader)Sys.loader.registerScript(d,["ExtendedBase","ExtendedCommon","ExtendedTimer","ExtendedRoundedCorners"],c);else c()})();